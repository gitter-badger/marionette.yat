{"version":3,"sources":["src/functions/view/compare-ab.js","src/functions/common/smart-get.js","src/functions/common/get-label.js","src/functions/common/common.js","src/functions/common/get-name.js","src/functions/common/get-value.js","src/functions/functions.js","src/functions/view/view.js","src/functions/view/view-comparator.js","src/helpers/isKnownCtor.js","src/YatError.js","src/helpers/mix.js","src/helpers/Helpers.js","src/mixins/get-name-label.js","src/mixins/get-option-property.js","src/mixins/radioable.js","src/mixins/stateable.js","src/mixins/startable.js","src/mixins/childrenable.js","src/singletons/template-context.js","src/mixins/global-template-context.js","src/mixins/Mixins.js","src/singletons/drag-and-drop.js","src/behaviors/behaviors.js","src/behaviors/draggable.js","src/behaviors/sort-by-drag.js","src/YatObject.js","src/singletons/identity.js","src/singletons/singletons.js","src/YatApp.js","src/YatRouter.js","src/models/model.js","src/models/link.js","src/YatPage.js","src/YatPageManager.js","src/YatView.js","src/YatCollectionView.js","src/marionette.yat.js"],"names":["getCompareABModel","arg","Bb","Model","Mn","View","model","getCompareABView","compareAB","a","b","func","call","normalizeValue","context","value","args","_","isFunction","apply","smartGet","opts","fields","fileds","length","Error","isModel","hasOptions","isObject","options","some","fieldName","get","default","common","arguments","undefined","concat","getName","getValue","Functions","view","viewComparator","Array","_len","_key","compareArray","result","every","singleCompare","knownCtors","Collection","Router","Object","isKnownCtor","isFn","ctor","prototype","YatError","extend","message","this","Http","status","error","name","Http404","Http401","Http403","mix","BaseClass","Mixed","tmp","reduce","memo","Src","Dst","smartExtend","Helpers","GetNameLabel","Base","_len2","_key2","getLabel","_len3","_key3","GetOptionProperty","key","_getOptionOrProperty","getOption","getProperty","deep","valueContext","fallback","force","fallbackOptions","RadioMixin","initRadioOnInitialize","_initRadio","skip","_channel","channel","channelName","getChannel","request","trigger","Stateable","Mixin","initializeStateable","_state","state","_this","each","propertyValue","propertyName","setState","_triggerStateChange","getState","broadcast","s","triggerMethod","toString","STATES","getPropertyPromise","rawPromises","promises","promiseArg","push","Promise","all","addPropertyPromise","promise","Startable","Middle","with","State","initializeStartable","constructor","_registerStartableLifecycleListeners","_setLifeState","canNotBeStarted","_ensureStartableCanBeStarted","resultPromise","catchMethod","_this2","reject","declineReason","isStartNotAllowed","currentState","_getLifeState","_tryMergeStartOptions","_getStartPromise","then","triggerStart","canNotBeStopped","_ensureStartableCanBeStopped","isStopNotAllowed","_tryMergeStopOptions","_getStopPromise","triggerStop","newstate","states","_this4","_isLifeState","_isLifeStateIn","on","_this5","mergeOptions","mergeoptions","throwError","destroyed","isNotIntact","_ensureStartableIsIntact","notIdle","_isInProcess","_ensureStartableIsIdle","allowStartWithoutStop","running","allowStopWithoutStart","_getStartPromises","_getStartUserPromise","_getStartParentPromise","parent","_getStopPromises","_getStopUserPromise","Childrenable","CHILDREN_FIELD","initializeChildrenable","_initializeParrent","_initializeChildren","getChildren","startable","filter","c","getParent","_children","children","child","childContext","_normalizeChildContext","initialized","_initializeChild","Child","_normalizeChildOptions","buildChild","_buildChildOptions","def","ChildClass","templateContextStore","compiledContext","hasChanges","GlobalTemplateContext","viewTemplateContext","global","compile","item","_len4","_key4","newcontext","cntx","pop","shift","unshift","target","templateContext","TemplateContext","Mixins","isEqualOrContains","node1","node2","jquery","$","contains","dragAndDrop","$el","beh","event","uniqueId","x","pageX","y","pageY","mouse","getOffset","ev","res","startAt","absX","Math","abs","absY","distance","round","sqrt","_documentHandlers","mousemove","bind","__documentMouseMoveHandler","mouseup","__documentMouseUpHandler","mouseleave","__documentMouseLeaveHandler","mouseenter","__documentMouseEnterHandler","_elementHandlers","dragover","__dragOverHandler","behavior","Behavior","$handler","selector","__triggerMouseDownHandler","preventDefault","stopPropagation","buildDraggableContext","document","one","_clearAllHandlers","startDistance","_initializeDragging","$entered","off","_createCustomDomEvent","merge","customEvent","jQuery","Event","prop","$doc","handler","_triggerHandlers","Behaviors","Draggable","part","wrongScope","_setup","getScope","scope","$g","$ghost","clone","css","width","addClass","$dragContext","appendTo","draggingContext","remove","removeClass","setupDraggable","getDragTrigger","SortByDrag","oldpos","dragOverPosition","m","getChildEl","position","i","_get$elInfo","hor","center","ver","warn","dragBy","apos","split","eventContext","indexOf","_insert","_tryInsertBetween","collection","detach","destroy","removeModelFromCollection","insertModelAt","insertAt","col","set","at","add","exist","ind","sort","el","closest","_$elInfo","height","offset","size","left","top","getOrder","order","childBeh","method","_updateInsert","YatObject","mixin","Radioable","identity","_initializeYatUser","isAnonym","id","hash","update","clearState","Singletons","Application","App","region","_initRegion","_region","pageManager","_pageManagers","prefix","listenTo","eventName","prefixedEventName","rebuild","_menuTree","managers","links","chain","map","manager","getLinks","flatten","hasPageManagers","find","mngr","getPage","AppRouter","appRoutes","controller","handlerContext","action","catch","_catchError","LinkModel","YatPage","initializeYatPage","_initializeModels","_initializeRoute","_proxyEvents","_tryCreateRouter","_registerIdentityHandlers","_layoutView","isDestroyed","buildLayout","Layout","buildLayoutOptions","page","rawOptions","fetch","addStartPromise","hashes","_routeHandler","getRouteHash","_toConsumableArray","level","_canHaveLinkModel","_linkModel","url","getRoute","label","_getSublinks","getLinkModel","link","sublinks","addModel","addCollection","route","asPattern","start","relative","_normalizeRoute","replace","router","_createAppRouter","proxyContexts","_getProxyContexts","_proxyEventsTo","rdy","radio","allowed","contexts","eventsHash","triggerArguments","_destroyLinkModel","YatPageManager","_initializeYatPageManager","_routesHash","setRouter","create","text","NotFound","execute","getRouter","navigate","console","found","pageContext","current","rootUrl","root","_registerPageHandlers","createRouter","_pageBeforeStart","_pageStart","_pageDecline","stop","_moveToRootIfCurrentPageNotAllowed","navigateToRoot","YatView","YatCollectionView","NextCollectionView","YatApp","YatRouter"],"mappings":"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","file":"marionette.yat.min.js","sourcesContent":["import Bb from 'backbone';\r\nimport Mn from 'backbone.marionette';\r\n\r\nlet getCompareABModel = (arg) => {\r\n\tif (arg instanceof Bb.Model)\r\n\t\treturn arg;\r\n\telse if (arg instanceof Mn.View)\r\n\t\treturn arg.model;\r\n\telse\r\n\t\treturn;\r\n}\r\nlet getCompareABView = (arg) => {\r\n\tif (arg instanceof Bb.View)\r\n\t\treturn arg;\r\n\telse\r\n\t\treturn;\r\n}\r\n\r\nlet compareAB = (a, b, func) => {\r\n\tif (typeof func === 'function') {\r\n\t\ta = func.call(a, getCompareABModel(a), getCompareABView(a));\r\n\t\tb = func.call(b, getCompareABModel(b), getCompareABView(b));\r\n\t}\r\n\treturn a < b ? -1\r\n\t\t: a > b ? 1\r\n\t\t\t: 0;\r\n};\r\n\r\nexport default compareAB;\r\n","import _ from 'underscore';\r\nimport Bb from 'backbone';\r\n\r\nfunction normalizeValue(context, value, args){\r\n\tif(_.isFunction(value))\r\n\t\tvalue = value.apply(context, args || []);\r\n\treturn value;\r\n}\r\n\r\nfunction smartGet(context, opts){\r\n\tif(!opts.fields || !opts.fileds.length)\r\n\t\tthrow new Error('fields option missing');\r\n\r\n\tif(context == null) return;\r\n\r\n\tlet value;\r\n\tlet isModel = context instanceof Bb.Model;\r\n\tlet hasOptions = _.isObject(context.options);\r\n\t\r\n\t_(opts.fields).some((fieldName) => {\r\n\r\n\t\tif(isModel && value == null)\r\n\t\t\tvalue = normalizeValue(context, context.get(fieldName), opts.args);\r\n\r\n\t\tif(value == null)\r\n\t\t\tvalue = normalizeValue(context, context[fieldName], opts.args);\r\n\r\n\t\tif(value == null && hasOptions)\r\n\t\t\tvalue = normalizeValue(context, context.options[fieldName], opts.args);\r\n\r\n\t\treturn value != null;\r\n\t});\r\n\r\n\treturn value == null ? opts.default : value;\r\n\r\n}\r\n\r\n\r\nexport default smartGet;\r\n","import get from './smart-get';\r\nexport default (context, opts = {}) => {\r\n\tlet fields = ['getLabel', 'label', 'getName', 'name', 'getValue', 'value'];\r\n\topts.fields = fields.concat(opts.fields || []);\r\n\treturn get(context, opts);\r\n}\r\n","import getLabel from './get-label';\r\nimport getName from './get-name';\r\nimport getValue from './get-value';\r\nexport default {\r\n\tgetLabel, getName, getValue\r\n}\r\n","import get from './smart-get';\r\nexport default (context, opts = {}) => {\r\n\tlet fields = ['getName', 'name', 'getLabel', 'label', 'getValue', 'value'];\r\n\topts.fields = fields.concat(opts.fields || []);\r\n\treturn get(context, opts);\r\n}\r\n","import get from './smart-get';\r\nexport default (context, opts = {}) => {\r\n\tlet fields = ['getValue', 'value', 'getId', 'id', 'getName', 'name', 'getLabel', 'label', 'cid'];\r\n\topts.fields = fields.concat(opts.fields || []);\r\n\treturn get(context, opts);\r\n}\r\n","import view from './view/view';\r\nimport common from './common/common';\r\nexport default { view, common };\r\n","import compareAB from './compare-ab';\r\nimport viewComparator from './view-comparator';\r\nexport default { compareAB, viewComparator };\r\n","import _ from 'underscore';\r\nimport compareAB from './compare-ab';\r\n\r\n/*\r\n*\taccepts:\r\n*\t\tvariant #1: a, b, function\r\n*\t\tvariant #2: [[a,b,function], [a,b,function]]\r\n*\t\tfunction can be undefined\r\n*\t\texample:\r\n*\t\t\tascending\t:\t\treturn viewComparator(viewA, viewB, function(model, view){ return model && model.get('someTextField') });\r\n*\t\t\tdescending\t:\t\treturn viewComparator(viewB, viewA, function(model, view){ return model && model.get('someTextField') });\r\n\t\t\tmultiple compares: \treturn viewComparator([[viewB, viewA, func], [viewB, viewA, func]])\r\n*/\r\nlet viewComparator = (...args) => {\r\n\tvar compareArray = [];\r\n\tvar result = 0;\r\n\r\n\tif (args.length >= 2)\t// single compare\r\n\t\treturn compareAB.apply(null, args);\r\n\telse if (args.length === 1 && args[0] instanceof Array)\t// array of compare\r\n\t\tcompareArray = args[0];\r\n\r\n\t_(compareArray).every(function (singleCompare) {\r\n\t\tresult = compareAB.apply(null, singleCompare);\r\n\t\treturn result === 0;\r\n\t});\r\n\t\r\n\treturn result;\r\n}\r\n\r\nexport default viewComparator;\r\n","import _ from 'underscore';\r\nimport Bb from 'backbone';\r\nimport Mn from 'backbone.marionette';\r\n\r\nconst knownCtors = [\r\n\tBb.Model,\r\n\tBb.Collection,\r\n\tBb.View,\r\n\tBb.Router,\r\n\tMn.Object\r\n];\r\n\r\nfunction isKnownCtor(arg) {\r\n\tlet isFn = _.isFunction(arg);\r\n\tlet result = _(knownCtors).some((ctor) => arg === ctor || arg.prototype instanceof ctor);\r\n\treturn isFn && result;\r\n}\r\n\r\nexport default isKnownCtor;\r\n","import Mn from 'backbone.marionette';\r\nimport mix from './helpers/mix';\r\n\r\n\r\nlet YatError = Mn.Error.extend({},{\r\n\tHttp400(message){\r\n\t\treturn this.Http(400,message);\r\n\t},\r\n\tHttp401(message){\r\n\t\treturn this.Http(401,message);\r\n\t},\r\n\tHttp403(message){\r\n\t\treturn this.Http(403,message);\r\n\t},\r\n\tHttp404(message){\r\n\t\treturn this.Http(404, message);\r\n\t},\r\n\tHttp500(message){\r\n\t\treturn this.Http(500, message);\r\n\t},\r\n\tHttp(status, message){\r\n\t\tlet error = new this({message:message, name:\"HttpError\"});\r\n\t\terror.status = status;\r\n\t\treturn error;\r\n\t},\r\n\tHttpRedirect(message){\r\n\t\treturn this.Http(301, message);\r\n\t},\r\n\tNotFound(message){\r\n\t\treturn this.Http404(message);\r\n\t},\r\n\tNotAuthorized(message){\r\n\t\treturn this.Http401(message);\r\n\t},\r\n\tForbidden(message){\r\n\t\treturn this.Http403(message);\r\n\t},\r\n});\r\n\r\nexport default YatError;\r\n","import _ from 'underscore'\r\nimport Mn from 'backbone.marionette';\r\nimport YatError from '../YatError';\r\n\r\nfunction smartExtend(Src, Dst){\r\n\tif(_.isFunction(Dst)){\r\n\t\treturn Dst(Src);\r\n\t}\r\n\telse if(_.isObject(Dst)){\r\n\t\treturn Src.extend(Dst);\r\n\t}\r\n\telse throw new YatError('Mixin fail, argument should be an object hash or mixin function')\r\n}\r\n\r\nfunction mix(BaseClass){\r\n\tlet Mixed = null;\r\n\tif(_.isFunction(BaseClass)){\r\n\t\tMixed = BaseClass;\r\n\t}\r\n\telse if(_.isObject(BaseClass) && BaseClass !== null){\r\n\t\tlet tmp = function(){};\r\n\t\ttmp.extend = Mn.extend;\r\n\t\tMixed = tmp.extend(BaseClass);\r\n\t}\r\n\telse {\r\n\t\tthrow new Error('argument should be an object or class definition')\r\n\t}\r\n\tif(!Mixed.extend) {\r\n\t\tMixed = Mn.extend.call(BaseClass, {});\r\n\t\tMixed.extend = Mn.extend;\r\n\t}\r\n\tlet fake = {\r\n\t\twith: (...args) => _.reduce(args, (memo, arg) => smartExtend(memo, arg), Mixed),\r\n\t\tclass: Mixed,\t\r\n\t}\r\n\treturn fake;\r\n}\r\n\r\nexport default mix;\r\n","import isKnownCtor from './isKnownCtor';\r\nimport mix from './mix';\r\nexport default {\r\n\tisKnownCtor,\r\n\tmix,\r\n}\r\n","import common from '../functions/common/common';\r\nexport default function (Base) {\r\n\treturn Base.extend({\r\n\t\tgetName(...args){\r\n\t\t\treturn common.getName(this, ...args);\r\n\t\t},\r\n\t\tgetLabel(...args){\r\n\t\t\treturn common.getLabel(this, ...args);\r\n\t\t},\r\n\t\tgetValue(...args){\r\n\t\t\treturn common.getValue(this, ...args);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n","import _ from 'underscore';\r\nimport isKnownCtor from '../helpers/isKnownCtor.js';\r\n\r\n\r\nexport default (Base) => {\r\n\tlet Mixin = Base.extend({\r\n\t\t//property first approach\r\n\t\tgetProperty(key, options){\r\n\t\t\treturn this._getOptionOrProperty(this, key, options, this.getOption);\r\n\t\t},\r\n\t\t//options first approach\r\n\t\tgetOption(key, options){\r\n\t\t\treturn this._getOptionOrProperty(this.getProperty('options',{deep:false}), key, options, this.getProperty);\r\n\t\t},\r\n\t\t_getOptionOrProperty(valueContext, key, options = {}, fallback)\r\n\t\t{\r\n\t\t\toptions.deep !== undefined || (options.deep = true);\r\n\t\t\toptions.force !== undefined || (options.force = true);\r\n\t\t\toptions.args || (options.args = []);\r\n\r\n\t\t\t//key and valueContext should be passed\r\n\t\t\tif(key == null || valueContext == null) return;\r\n\t\t\t\r\n\t\t\t//getting raw value\r\n\t\t\tlet value = valueContext[key];\r\n\r\n\t\t\t//if there is no raw value and deep option is true then getting value from fallback\r\n\t\t\tif(value === undefined && options.deep && _.isFunction(fallback)){\r\n\t\t\t\tlet fallbackOptions = _.extend({}, options, {deep:false, force: false});\r\n\t\t\t\tvalue = fallback.call(this, key, fallbackOptions); \r\n\t\t\t}\r\n\r\n\t\t\t//if returned value is function and is not any of known constructors and options property force set to true \r\n\t\t\t//we should return value of that function\r\n\t\t\t//options.args will be passed as arguments\r\n\t\t\tif(_.isFunction(value) && options.force && !isKnownCtor(value))\r\n\t\t\t\tvalue = value.apply(this, options.args || []);\r\n\r\n\t\t\t//console.log('key', key, value);\r\n\t\t\t\r\n\t\t\t//if value is still undefined we will return default option value\r\n\t\t\treturn value === undefined ? options.default : value;\r\n\t\t}\r\n\t});\r\n\treturn Mixin;\r\n}\r\n","import Mn from 'backbone.marionette';\r\n\r\nexport default (Base) => {\r\n\tlet Mixin = Base.extend({\r\n\t\tconstructor(...args){\r\n\t\t\tBase.apply(this, args);\r\n\t\t\tlet initRadioOnInitialize = !(this.getProperty('initRadioOnInitialize') === true);\r\n\t\t\tthis._initRadio({skip: initRadioOnInitialize});\r\n\t\t},\r\n\t\tgetChannel () {\r\n\t\t\tif(!this._channel) this._initRadio({skip:false});\r\n\t\t\treturn this._channel;\r\n\t\t},\r\n\t\t_initRadio(opts = {skip:true}){\r\n\t\t\tif(opts.skip == true) return;\r\n\r\n\t\t\tlet channelName = this.getProperty('channelName');\r\n\t\t\tif(!channelName){\r\n\t\t\t\tlet channel = this.getProperty('channel');\r\n\t\t\t\tif(channel)\r\n\t\t\t\t\tthis.channelName = channel.channelName;\r\n\t\t\t}\r\n\t\t\tMn.Object.prototype._initRadio.call(this);\r\n\t\t},\r\n\t\tradioRequest(...args){\r\n\t\t\tlet channel = this.getChannel();\r\n\t\t\tif(channel) channel.request(...args);\r\n\t\t},\r\n\t\tradioTrigger(...args){\r\n\t\t\tlet channel = this.getChannel();\r\n\t\t\tif(channel) channel.trigger(...args);\r\n\t\t},\r\n\t});\r\n\r\n\treturn Mixin;\r\n}\r\n","import _ from 'underscore';\r\n\r\nexport default (BaseClass) => {\r\n\tlet Mixin = BaseClass.extend({\r\n\t\tconstructor(...args){\r\n\t\t\tBaseClass.apply(this, args);\r\n\t\t\tthis.initializeStateable();\r\n\t\t},\r\n\t\tinitializeStateable(){\r\n\t\t\tthis._state = {};\r\n\t\t},\r\n\r\n\t\tgetState(key){\r\n\t\t\tconst state = this._state;\r\n\t\t\tif(!key) return state\r\n\t\t\telse return state[key];\r\n\t\t},\r\n\t\tsetState(key, value, options){\r\n\t\t\t\r\n\t\t\tif(key == null) return;\r\n\r\n\t\t\tif(_.isObject(key)){\r\n\t\t\t\tconst _this = this;\r\n\t\t\t\toptions = value;\r\n\t\t\t\tvalue = key;\r\n\t\t\t\t_(value).each((propertyValue, propertyName) => _this.setState(propertyName, propertyValue, options));\r\n\t\t\t\tthis._triggerStateChange(value, options);\r\n\t\t\t}else{\r\n\t\t\t\tconst state = this.getState();\r\n\t\t\t\tstate[key] = value;\r\n\t\t\t\tthis._triggerStateChange(key, value, options);\r\n\t\t\t}\r\n\t\t},\r\n\t\tclearState(opts = {}){\r\n\t\t\tlet state = this.getState();\r\n\t\t\tlet broadcast = _.extend({}, state);\r\n\t\t\t_(state).each((s,key) => {\r\n\t\t\t\tbroadcast[key] = undefined;\r\n\t\t\t\tdelete state[key];\r\n\t\t\t});\r\n\t\t\tthis._triggerStateChange(broadcast);\r\n\t\t},\r\n\t\t_triggerStateChange(key, value, options){\r\n\r\n\t\t\tif(!_.isFunction(this.triggerMethod)) return;\r\n\r\n\t\t\tif(!_.isObject(key)){\r\n\t\t\t\tthis.triggerMethod('state:' + key, value, options);\r\n\t\t\t\tif(value === true || value === false)\r\n\t\t\t\t\tthis.triggerMethod('state:' + key + ':' + value.toString(), options);\r\n\t\t\t}else{\r\n\t\t\t\t//key is a hash of states\r\n\t\t\t\t//value is options\r\n\t\t\t\toptions = value;\r\n\t\t\t\tvalue = key;\r\n\t\t\t\tthis.triggerMethod('state', value, options);\r\n\t\t\t}\r\n\t\t},\t\t\r\n\t});\r\n\tMixin.Stateable = true;\r\n\r\n\treturn Mixin;\r\n\r\n}\r\n","import _ from 'underscore';\r\nimport mix from '../helpers/mix.js';\r\nimport State from './stateable.js';\r\nimport YatError from '../YatError.js';\r\n\r\nconst STATES = {\r\n\tINITIALIZED: 'initialized',\r\n\tSTARTING: 'starting',\r\n\tRUNNING: 'running',\r\n\tSTOPPING: 'stopping',\r\n\tWAITING: 'waiting',\r\n\tDESTROYED: 'destroyed'\r\n}\r\n\r\nconst STATE_KEY = 'life';\r\n\r\n\r\nfunction getPropertyPromise(context, propertyName){\r\n\tlet rawPromises = context[propertyName] || [];\r\n\tlet promises = [];\r\n\t_(rawPromises).each((promiseArg) => {\r\n\t\tif(_.isFunction(promiseArg))\r\n\t\t\tpromises.push(promiseArg.call(this));\r\n\t\telse\r\n\t\t\tpromises.push(promiseArg);\r\n\t});\r\n\treturn Promise.all(promises);\r\n}\r\n\r\nfunction addPropertyPromise(context, propertyName, promise){\r\n\tcontext[propertyName] || (context[propertyName] = []);\r\n\tlet promises = context[propertyName];\r\n\tpromises.push(promise);\r\n}\r\n\r\n\r\n\r\nexport default (Base) => {\r\n\tlet Middle = mix(Base).with(State);\r\n\tlet Mixin = Middle.extend({\r\n\t\tconstructor(...args){\r\n\t\t\tMiddle.apply(this,args);\r\n\t\t\tthis.initializeStartable();\r\n\t\t},\r\n\r\n\t\tinitializeStartable(){\r\n\t\t\t\r\n\t\t\tif(!(this.constructor.Startable && this.constructor.Stateable)) return;\r\n\r\n\t\t\tthis._registerStartableLifecycleListeners();\r\n\t\t\tthis._setLifeState(STATES.INITIALIZED);\r\n\t\t},\t\r\n\r\n\t\tstart(...args){\r\n\t\t\tlet options = args[0];\r\n\t\t\tlet canNotBeStarted = this._ensureStartableCanBeStarted();\r\n\t\t\tlet resultPromise = null;\r\n\t\t\tlet catchMethod = null;\r\n\r\n\t\t\tif(canNotBeStarted){\r\n\t\t\t\tcatchMethod = () => this.triggerMethod('start:decline',canNotBeStarted);\r\n\t\t\t\tresultPromise = Promise.reject(canNotBeStarted);\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tif(resultPromise == null){\r\n\t\t\t\tlet declineReason = this.isStartNotAllowed(options);\r\n\t\t\t\tif(declineReason) {\r\n\t\t\t\t\tcatchMethod = () => this.triggerMethod('start:decline',declineReason);\r\n\t\t\t\t\tresultPromise = Promise.reject(declineReason);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(resultPromise == null){\r\n\t\t\t\tvar currentState = this._getLifeState();\r\n\t\t\t\tthis._tryMergeStartOptions(options);\t\t\r\n\t\t\t\tthis.triggerMethod('before:start', ...args);\r\n\t\t\t\tresultPromise = this._getStartPromise();\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\treturn resultPromise.then(() => {\r\n\t\t\t\tthis.triggerStart(options)\r\n\t\t\t}, (error) => {\r\n\t\t\t\tthis._setLifeState(currentState);\r\n\t\t\t\tif(catchMethod) catchMethod();\r\n\t\t\t\treturn Promise.reject(error);\r\n\t\t\t});\t\r\n\r\n\t\t},\r\n\r\n\t\ttriggerStart(options) {\r\n\t\t\tthis.triggerMethod('start', options);\r\n\t\t},\r\n\r\n\t\tstop(options){\r\n\t\t\tlet canNotBeStopped = this._ensureStartableCanBeStopped();\r\n\t\t\tif(canNotBeStopped){\r\n\t\t\t\tthis.triggerMethod('stop:decline',canNotBeStopped);\r\n\t\t\t\treturn Promise.reject(canNotBeStopped);\t\t\t\t\r\n\t\t\t}\r\n\t\t\tlet declineReason = this.isStopNotAllowed(options);\r\n\t\t\tif(declineReason){\r\n\t\t\t\tthis.triggerMethod('stop:decline', declineReason);\r\n\t\t\t\treturn Promise.reject(declineReason);\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\t\t\tvar currentState = this._getLifeState();\r\n\r\n\t\t\tthis._tryMergeStopOptions(options);\r\n\t\t\tthis.triggerMethod('before:stop', this, options);\r\n\r\n\t\t\tlet promise = this._getStopPromise();\r\n\r\n\t\t\treturn promise.then(() => {\r\n\t\t\t\tthis.triggerStop(options)\r\n\t\t\t}, () => {\r\n\t\t\t\tthis._setLifeState(currentState);\r\n\t\t\t});\t\r\n\r\n\t\t},\r\n\r\n\t\ttriggerStop(options) {\r\n\t\t\tthis.triggerMethod('stop', options);\r\n\t\t},\r\n\r\n\t\tisStartNotAllowed(){ },\r\n\t\tisStopNotAllowed(){ },\r\n\r\n\t\taddStartPromise(promise){\r\n\t\t\taddPropertyPromise(this,'startPromises', promise);\r\n\t\t},\r\n\r\n\t\taddStopPromise(promise){\r\n\t\t\taddPropertyPromise(this,'stopPromises', promise);\r\n\t\t},\r\n\r\n\t\t//lifecycle state helpers\r\n\t\t_setLifeState(newstate){\r\n\t\t\tthis.setState(STATE_KEY, newstate);\r\n\t\t},\r\n\r\n\t\t_getLifeState(){\r\n\t\t\treturn this.getState(STATE_KEY);\r\n\t\t},\r\n\r\n\t\t_isLifeState(state){\r\n\t\t\treturn this._getLifeState() === state;\r\n\t\t},\r\n\r\n\t\t_isLifeStateIn(...states){\r\n\t\t\treturn _(states).some((state) => this._isLifeState(state));\r\n\t\t},\r\n\r\n\t\t_isInProcess(){\r\n\t\t\treturn this._isLifeStateIn(STATES.STARTING, STATES.STOPPING);\r\n\t\t},\r\n\r\n\r\n\t\t_registerStartableLifecycleListeners(){\r\n\t\t\tthis.on('before:start', () => this._setLifeState(STATES.STARTING));\r\n\t\t\tthis.on('start', () => this._setLifeState(STATES.RUNNING));\r\n\t\t\tthis.on('before:stop',() => this._setLifeState(STATES.STOPPING));\r\n\t\t\tthis.on('stop',() => this._setLifeState(STATES.WAITING));\r\n\t\t\tthis.on('destroy',() => this._setLifeState(STATES.DESTROYED))\r\n\t\t},\t\r\n\r\n\t\t_tryMergeStartOptions(options){\r\n\t\t\tif(!this.mergeOptions) return;\r\n\t\t\tvar mergeoptions = this.getProperty('mergeStartOptions') || [];\r\n\t\t\tthis.mergeOptions(options, mergeoptions);\r\n\t\t},\r\n\r\n\t\t_tryMergeStopOptions(options){\r\n\t\t\tif(!this.mergeOptions) return;\r\n\t\t\tvar mergeoptions = this.getProperty('mergeStopOptions') || [];\r\n\t\t\tthis.mergeOptions(options, mergeoptions);\r\n\t\t},\r\n\r\n\t\t_ensureStartableIsIntact(opts = {throwError: false}) {\r\n\t\t\tlet message = 'Startable has already been destroyed and cannot be used.';\r\n\t\t\tlet error = new YatError({\r\n\t\t\t\tname: 'StartableLifecycleError',\r\n\t\t\t\tmessage: message\r\n\t\t\t});\r\n\t\t\tlet destroyed = this._isLifeState(STATES.DESTROYED);\r\n\t\t\tif(opts.throwError && destroyed){\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t\telse if(destroyed){\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_ensureStartableIsIdle(opts = {throwError:false}){\r\n\t\t\tlet message = 'Startable is not idle. current state: ' + this._getLifeState();\r\n\t\t\tlet error = new YatError({\r\n\t\t\t\tname: 'StartableLifecycleError',\r\n\t\t\t\tmessage: message\r\n\t\t\t});\t\t\t\r\n\t\t\tlet isNotIntact = this._ensureStartableIsIntact(opts);\r\n\t\t\tlet notIdle = this._isInProcess();\r\n\t\t\tif(opts.throwError && notIdle){\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t\telse if(isNotIntact){\r\n\t\t\t\treturn isNotIntact;\r\n\t\t\t}\r\n\t\t\telse if(notIdle){\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_ensureStartableCanBeStarted(opts = {throwError:false}){\r\n\t\t\t\r\n\t\t\tlet message = 'Startable has already been started.';\r\n\t\t\tlet error = new YatError({\r\n\t\t\t\tname: 'StartableLifecycleError',\r\n\t\t\t\tmessage: message\r\n\t\t\t});\t\t\t\r\n\t\t\tlet notIdle = this._ensureStartableIsIdle(opts);\r\n\t\t\tlet allowStartWithoutStop = this.getProperty('allowStartWithoutStop') === true;\r\n\r\n\t\t\tif(!notIdle && allowStartWithoutStop) return;\r\n\r\n\t\t\tlet running = this._isLifeState(STATES.RUNNING);\r\n\t\t\tif(opts.throwError && running){\r\n\t\t\t\tthrow error;\r\n\t\t\t}else if(notIdle){\r\n\t\t\t\treturn notIdle;\r\n\t\t\t}else if(running){\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t\r\n\t\t_ensureStartableCanBeStopped(opts = {throwError:false}){\r\n\t\t\t\r\n\t\t\tlet message = 'Startable should be in `running` state.';\r\n\t\t\tlet error = new YatError({\r\n\t\t\t\tname: 'StartableLifecycleError',\r\n\t\t\t\tmessage: message\r\n\t\t\t});\t\t\t\t\r\n\t\t\tlet notIdle = this._ensureStartableIsIdle(opts);\r\n\r\n\t\t\tlet allowStopWithoutStart = this.getProperty('allowStopWithoutStart') === true;\r\n\t\t\tif(!notIdle && allowStopWithoutStart) return;\r\n\r\n\t\t\tlet running = this._isLifeState(STATES.RUNNING);\r\n\r\n\t\t\tif(opts.throwError && !running){\r\n\t\t\t\tthrow error;\r\n\t\t\t}else if(notIdle){\r\n\t\t\t\treturn notIdle;\r\n\t\t\t}else if(!running){\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\r\n\t\t},\t\r\n\t\t\r\n\t\t_getStartPromise(){\r\n\t\t\treturn Promise.all(this._getStartPromises());\r\n\t\t},\r\n\r\n\t\t_getStartPromises(){\r\n\t\t\tlet promises = [];\r\n\t\t\tpromises.push(this._getStartUserPromise());\r\n\t\t\tpromises.push(this._getStartParentPromise());\r\n\t\t\treturn promises;\r\n\t\t},\r\n\r\n\t\t_getStartUserPromise(){\r\n\t\t\treturn getPropertyPromise(this,'startPromises');\r\n\t\t},\r\n\r\n\t\t_getStartParentPromise(){\r\n\t\t\tvar parent = _.result(this, 'getParent');\r\n\t\t\tif(_.isObject(parent) && _.isFunction(parent._getStartPromise))\r\n\t\t\t\treturn parent._getStartPromise();\r\n\t\t},\r\n\r\n\t\t_getStopPromise(){\r\n\t\t\treturn Promise.all(this._getStopPromises());\r\n\t\t},\r\n\t\t\r\n\t\t_getStopPromises(){\r\n\t\t\tlet promises = [];\r\n\t\t\tpromises.push(this._getStopUserPromise());\r\n\t\t\treturn promises;\r\n\t\t},\r\n\r\n\t\t_getStopUserPromise(){\r\n\t\t\treturn getPropertyPromise(this,'stopPromises');\r\n\t\t},\r\n\r\n\t\t_getStopParentPromise(){\r\n\t\t\tvar parent = _.result(this, 'getParent');\r\n\t\t\tif(_.isObject(parent) && _.isFunction(parent._getStopPromise))\r\n\t\t\t\treturn parent._getStartPromise();\r\n\t\t},\r\n\r\n\r\n\t});\r\n\r\n\tMixin.Startable = true;\r\n\r\n\treturn Mixin;\r\n}\r\n","import _ from 'underscore';\r\n\r\nexport default (Base) => {\r\n\t\r\n\tconst CHILDREN_FIELD = '_children';\r\n\r\n\tlet Mixin = Base.extend({\r\n\t\tconstructor(...args) {\r\n\t\t\tBase.apply(this, args);\r\n\t\t\tthis.initializeChildrenable(...args);\r\n\t\t},\r\n\r\n\t\tinitializeChildrenable(options = {}){\r\n\t\t\tthis._initializeParrent(options);\r\n\t\t\tthis._initializeChildren(options);\r\n\t\t},\r\n\r\n\t\thasChildren(){\r\n\t\t\tlet children = this.getChildren();\r\n\t\t\treturn this[CHILDREN_FIELD].length > 0;\r\n\t\t},\r\n\r\n\t\tgetChildren(opts = {startable:true}){\r\n\t\t\tlet all = this[CHILDREN_FIELD] || [];\r\n\t\t\tif(!opts.startable){\r\n\t\t\t\treturn all;\r\n\t\t\t}else{\r\n\t\t\t\treturn all.filter((c) => !c.getProperty('isStartNotAllowed'));\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\thasParent(){\r\n\t\t\tlet parent = this.getParent();\r\n\t\t\treturn _.isObject(parent);\r\n\t\t},\r\n\r\n\t\tgetParent(){\r\n\t\t\treturn this.getProperty('parent', {deep:false});\r\n\t\t},\r\n\r\n\t\t_initializeChildren(){\r\n\t\t\tlet _children = this.getProperty('children');\r\n\t\t\tlet children = [];\r\n\t\t\t_(_children).each((child) => {\r\n\r\n\t\t\t\tlet childContext = this._normalizeChildContext(child);\r\n\t\t\t\tlet initialized = this._initializeChild(childContext);\r\n\t\t\t\tif(initialized) children.push(initialized);\r\n\r\n\t\t\t});\r\n\t\t\tthis[CHILDREN_FIELD] = children;\r\n\t\t},\r\n\t\t_initializeChild(childContext)\r\n\t\t{\r\n\t\t\tif(childContext == null || !_.isFunction(childContext.Child)) return;\r\n\r\n\t\t\tlet Child = childContext.Child;\r\n\t\t\tlet opts = this._normalizeChildOptions(childContext);\r\n\t\t\treturn this.buildChild(Child, opts);\r\n\t\t},\r\n\r\n\t\t_normalizeChildContext(child){\r\n\t\t\tlet childContext = {};\r\n\r\n\t\t\tif(_.isFunction(child) && child.Childrenable){\r\n\t\t\t\t_.extend(childContext, { Child: child });\r\n\t\t\t}else if(_.isFunction(child)){\r\n\t\t\t\tchildContext = this._normalizeChildContext(child.call(this));\r\n\t\t\t}\r\n\t\t\telse if(_.isObject(child)){\r\n\t\t\t\tchildContext = child;\r\n\t\t\t}\r\n\t\t\treturn childContext;\r\n\t\t},\r\n\r\n\t\t_normalizeChildOptions(options){\r\n\t\t\tlet opts = _.extend({}, options);\r\n\t\t\tif(this.getOption('passToChildren') === true){\r\n\t\t\t\t_.extend(opts, this.options);\r\n\t\t\t}\r\n\t\t\topts.parent = this;\r\n\t\t\tdelete opts.Child;\r\n\t\t\treturn this._buildChildOptions(opts);\r\n\t\t},\r\n\r\n\t\t_buildChildOptions: function(def){\r\n\t\t\treturn _.extend(def, this.getProperty('childOptions'));\r\n\t\t},\r\n\r\n\t\tbuildChild(ChildClass, options){\r\n\t\t\treturn new ChildClass(options);\r\n\t\t},\r\n\r\n\t\t_initializeParrent(opts){\r\n\t\t\tif(this.parent == null && opts.parent != null)\r\n\t\t\t\tthis.parent = opts.parent;\r\n\t\t},\r\n\r\n\t});\r\n\r\n\tMixin.Childrenable = true;\r\n\r\n\treturn Mixin;\r\n}\r\n","import _ from 'underscore';\r\n\r\nlet templateContextStore = [(view) => {\r\n\treturn {\r\n\t\t_v: view,\r\n\t\t_m: view.model || {}\r\n\t}\r\n}];\r\nlet compiledContext = {}; //rethink how it can be used\r\nlet hasChanges = false;\r\n\r\nfunction normalizeValue(value, ...args){\r\n\tif(_.isFunction(value))\r\n\t\treturn value(...args);\r\n\telse if(_.isObject(value))\r\n\t\treturn value;\r\n\telse\r\n\t\treturn {};\r\n}\r\n\r\nconst GlobalTemplateContext = {\r\n\tmix(viewTemplateContext, ...args){\r\n\t\tlet global = this.get(...args);\r\n\t\treturn _.extend(global, viewTemplateContext);\r\n\t},\r\n\tget(...args){\r\n\t\treturn this.compile(...args);\r\n\t},\t\r\n\tadd(...args){\r\n\t\t_(args).each((item) => this.push(item));\r\n\t},\r\n\r\n\tcompile(...args){ \r\n\r\n\t\tif(hasChanges)\r\n\t\t\tcompiledContext = {};\r\n\r\n\t\tlet newcontext = {};\r\n\r\n\t\t_(templateContextStore).each((cntx) => {\r\n\t\t\tif(_.isFunction(cntx))\r\n\t\t\t\t_.extend(newcontext, normalizeValue(cntx, ...args));\r\n\t\t\telse if(hasChanges){\r\n\t\t\t\t_.extend(compiledContext, cntx);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(!hasChanges)\r\n\t\t\t_.extend(newcontext, compiledContext);\r\n\t\t\r\n\t\thasChanges = false;\r\n\t\treturn newcontext;\r\n\t},\r\n\tpop(){\r\n\t\thasChanges = true;\r\n\t\treturn templateContextStore.pop();\r\n\t},\r\n\tshift(){\r\n\t\thasChanges = true;\r\n\t\treturn templateContextStore.shift();\r\n\t},\r\n\tpush(item){ \r\n\t\thasChanges = true;\r\n\t\ttemplateContextStore.push(item); \r\n\t},\r\n\tunshift(item){\r\n\t\thasChanges = true;\r\n\t\ttemplateContextStore.unshift(item);\r\n\t},\r\n\tclear(){\r\n\t\thasChanges = false;\r\n\t\tcompiledContext = {};\r\n\t\ttemplateContextStore = [];\r\n\t},\r\n}\r\n\r\nexport default GlobalTemplateContext;\r\n","import _ from 'underscore';\r\nimport TemplateContext from '../singletons/template-context';\r\n\r\nexport default (Base) => Base.extend({\r\n\tmixinTemplateContext(target = {}) {\r\n\t\t\r\n\t\tvar templateContext = TemplateContext.mix(_.result(this, 'templateContext'), this);\r\n\t\t\r\n\t\treturn _.extend(target, templateContext);\r\n\t},\r\n})\r\n","import GetNameLabel from './get-name-label';\r\nimport GetOptionProperty from './get-option-property';\r\nimport Radioable from './radioable.js';\r\nimport Stateable from './stateable';\r\nimport Startable from './startable';\r\nimport Childrenable from './childrenable';\r\nimport GlobalTemplateContext from './global-template-context';\r\n\r\nexport default {\r\n\tGetNameLabel,\r\n\tGetOptionProperty,\r\n\tRadioable,\r\n\tStateable,\r\n\tStartable,\r\n\tChildrenable,\r\n\tGlobalTemplateContext,\r\n}\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\n\r\n\r\nlet isEqualOrContains = function(node1, node2){\r\n\tif(node1.jquery)\r\n\t\tnode1 = node1.get(0);\r\n\tif(node2.jquery)\r\n\t\tnode2 = node2.get(0);\r\n\t\r\n\treturn node1 === node2 || $.contains(node1, node2);\r\n}\r\n\r\nvar DragAndDropSingleton = Mn.Object.extend({\r\n\tname:'draggable manager',\r\n\tbuildDraggableContext: function ($el, beh, event) {\r\n\t\tvar context = {\r\n\t\t\tid: _.uniqueId('draggable'),\r\n\t\t\tstate:'pending',\r\n\t\t\t$trigger: $el,\r\n\t\t\tscope: beh.getOption(\"scope\") || \"default\",\r\n\t\t\tbehavior: beh,\r\n\t\t\tview: beh.view,\r\n\t\t\tmodel: beh.view.model,\r\n\t\t\tmouse: {\r\n\t\t\t\tstartAt: {x: event.pageX, y: event.pageY}\r\n\t\t\t},\r\n\t\t\t_documentHandlers: {},\r\n\t\t\t_triggerHandlers: {},\r\n\t\t\t_elementHandlers: {},\r\n\t\t}\r\n\r\n\t\tcontext.mouse.getOffset = function (ev) {\r\n\t\t\tvar res = {\r\n\t\t\t\tx: ev.pageX - this.startAt.x,\r\n\t\t\t\ty: ev.pageY - this.startAt.y\r\n\t\t\t}\r\n\t\t\tres.absX = Math.abs(res.x);\r\n\t\t\tres.absY = Math.abs(res.y);\r\n\t\t\tres.distance = Math.round(Math.sqrt(res.absX * res.absX + res.absY * res.absY));\r\n\t\t\treturn res;\r\n\t\t}\r\n\r\n\t\tcontext._documentHandlers.mousemove = _.bind(this.__documentMouseMoveHandler, this, $el, context);\r\n\t\tcontext._documentHandlers.mouseup = _.bind(this.__documentMouseUpHandler, this, $el, context);\r\n\t\tcontext._documentHandlers.mouseleave = _.bind(this.__documentMouseLeaveHandler, this, $el, context);\r\n\t\tcontext._documentHandlers.mouseenter = _.bind(this.__documentMouseEnterHandler, this, $el, context);\r\n\r\n\t\tcontext._elementHandlers.dragover = _.bind(this.__dragOverHandler, this, $el, context);\r\n\r\n\t\treturn context;\r\n\t},\r\n\tsetupDraggable: function ($el, behavior) {\r\n\t\tif (!$el.jquery && !(typeof $el === 'string'))\r\n\t\t\tthrow new Error('first argument should be jquery element or string selector');\r\n\t\tif (!(behavior instanceof Mn.Behavior))\r\n\t\t\tthrow new Error('second argument should be marionette behavior instance');\r\n\r\n\t\tvar $handler = $el.jquery ? $el : behavior.$el;\r\n\t\tvar selector = typeof $el === 'string' ? $el : null;\r\n\t\t\r\n\t\t$handler.on('mousedown', selector, null, _.bind(this.__triggerMouseDownHandler, this, $handler, behavior));\r\n\r\n\t},\r\n\t__triggerMouseDownHandler: function ($el, behavior, ev) {\r\n\t\t\r\n\t\tev.preventDefault();\r\n\t\tev.stopPropagation();\r\n\r\n\t\tvar context = this.buildDraggableContext($el, behavior, ev);\r\n\r\n\t\t$(document).on('mousemove', null, null, context._documentHandlers.mousemove)\r\n\t\t$(document).one('mouseup', null, null, context._documentHandlers.mouseup);\r\n\r\n\t\treturn false;\r\n\t},\r\n\t__documentMouseUpHandler: function ($el, context, ev) {\r\n\t\tif (context.state === 'pending') {\r\n\t\t\t//dragging do not occurs\r\n\t\t} else if (context.state === \"dragging\") {\r\n\t\t\tcontext.state = 'dropped';\r\n\t\t\tcontext.view.triggerMethod('drag:end', context);\r\n\t\t\t$(ev.target).trigger('drag:drop', context);\r\n\t\t}\r\n\r\n\t\tthis._clearAllHandlers($el, context);\r\n\t},\r\n\r\n\t__documentMouseMoveHandler: function ($el, context, ev) {\r\n\t\tif (context.state === 'pending') {\r\n\t\t\tvar startDistance = context.behavior.getOption('startDragOnDistance') || 1;\r\n\t\t\tvar distance = context.mouse.getOffset(ev).distance;\r\n\t\t\tif (distance < startDistance) return;\r\n\r\n\t\t\tthis._initializeDragging($el, context, ev);\r\n\t\t}\r\n\r\n\t\tif (context.state === 'dragging')\r\n\t\t\tcontext.view.triggerMethod('drag', ev, context);\r\n\r\n\t},\r\n\r\n\t_initializeDragging: function ($el, context, ev) {\r\n\t\tif (context.state === 'dragging') return;\r\n\r\n\t\tcontext.state = 'dragging';\r\n\t\tcontext.view.triggerMethod('drag:start', ev, context);\r\n\r\n\t\t$(document).on('mouseleave', '*', null, context._documentHandlers.mouseleave);\r\n\t\t$(document).on('mouseenter', '*', null, context._documentHandlers.mouseenter);\r\n\t},\r\n\r\n\t__documentMouseLeaveHandler: function ($el, context, ev) {\r\n\t\tif(isEqualOrContains(context.behavior.$el, ev.target)) return;\r\n\t\t\r\n\t\t$(ev.target).trigger('drag:leave', context);\r\n\t},\r\n\t__documentMouseEnterHandler: function ($el, context, ev) {\r\n\t\tif (context.$entered) {\r\n\t\t\tcontext.$entered.off('mousemove', null, context._elementHandlers.dragover)\r\n\t\t}\r\n\r\n\t\tif(isEqualOrContains(context.behavior.$el, ev.target)) return;\r\n\r\n\t\tvar event = this._createCustomDomEvent(\"drag:enter\", ev);\r\n\t\tcontext.$entered = $(ev.target);\r\n\t\tcontext.$entered.trigger(event, context);\r\n\r\n\t\tcontext.$entered.on('mousemove', null, null, context._elementHandlers.dragover);\r\n\t},\r\n\r\n\t__dragOverHandler: function ($el, context, ev) {\r\n\t\tvar event = this._createCustomDomEvent(\"drag:over\", ev);\r\n\t\t$(ev.target).trigger(event, context);\r\n\t},\r\n\r\n\t_createCustomDomEvent: function (name, event, merge) {\r\n\t\tif (!merge)\r\n\t\t\tmerge = [\"pageX\", \"pageY\", \"clientX\", \"clientY\", \"offsetX\", \"offsetY\"];\r\n\r\n\t\tvar customEvent = jQuery.Event(name);\r\n\t\t_(merge).each(function (prop) {\r\n\t\t\tcustomEvent[prop] = event[prop];\r\n\t\t});\r\n\r\n\t\treturn customEvent;\r\n\t},\r\n\r\n\t_clearAllHandlers: function ($el, context) {\r\n\t\tlet $doc = $(document);\r\n\t\t_(context._documentHandlers).each(function (handler, name) {\r\n\t\t\t$doc.off(name, null, handler);\r\n\t\t});\r\n\t\t_(context._triggerHandlers).each(function (handler, name) {\r\n\t\t\t$el.off(name, null, handler);\r\n\t\t});\r\n\r\n\t\tif (context.$entered) {\r\n\t\t\tcontext.$entered.off('mousemove', null, context._elementHandlers.dragover)\r\n\t\t}\r\n\r\n\t}\r\n});\r\n\r\nlet dragAndDrop = new DragAndDropSingleton();\r\n\r\nexport default dragAndDrop;\r\n ","import Draggable from './draggable';\r\nimport SortByDrag from './sort-by-drag';\r\nexport default { Draggable, SortByDrag };\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\nimport dragAndDrop from '../singletons/drag-and-drop';\r\n\r\nvar DraggableBehavior = Mn.Behavior.extend({\r\n\r\n\tstartDragOnDistance: 50,\r\n\r\n\tevents: {\r\n\t\t'dragged:over': '_dragOver'\r\n\t},\r\n\t_dragOver(event, part, context){\r\n\t\tevent.stopPropagation();\r\n\t\tevent.preventDefault();\r\n\r\n\t\tif (this.wrongScope(context)) return;\r\n\t\tthis.view.triggerMethod('dragged:over', part, context, this);\r\n\t\tthis.view.triggerMethod('dragged:over:' + part, context, this);\r\n\t},\r\n\tonInitialize() {\r\n\t\tthis._setup();\r\n\t},\r\n\tgetScope () {\r\n\t\treturn this.getOption(\"scope\") || \"default\";\r\n\t},\r\n\twrongScope (context) {\r\n\t\treturn this.getScope() !== context.scope;\r\n\t},\r\n\tonDragStart (ev, context) {\r\n\r\n\t\tvar ghost = this.getOption('ghost') || \"clone\";\r\n\r\n\t\tif (ghost == 'clone') {\r\n\t\t\tvar $g = this.$ghost = this.$el.clone();\r\n\t\t\t$g.css({\r\n\t\t\t\ttop: ev.pageY + 'px',\r\n\t\t\t\tleft: ev.pageX + 'px',\r\n\t\t\t\twidth: this.$el.width(),\r\n\t\t\t});\r\n\r\n\t\t\tif (this.getOption('elementClass'))\r\n\t\t\t\tthis.$el.addClass(this.getOption('elementClass'));\r\n\t\t\tif (this.getOption('ghostClass'))\r\n\t\t\t\t$g.addClass(this.getOption('ghostClass'));\r\n\r\n\t\t\tvar $dragContext = $('body');\r\n\t\t\t// var ghostContext = this.getOption('ghostContext');\r\n\t\t\t// var $dragContext = ghostContext == null ? $('body')\r\n\t\t\t// \t: ghostContext == \"parent\" ? this.$el.parent()\r\n\t\t\t// \t\t: $(ghostContext);\r\n\t\t\t$g.appendTo($dragContext);\r\n\t\t\tcontext.draggingContext = $dragContext;\r\n\t\t}\r\n\r\n\t},\r\n\tonDrag (ev) {\r\n\t\tif (!this.$ghost) return;\r\n\t\t\r\n\t\tthis.$ghost.css({\r\n\t\t\ttop: ev.pageY + 'px',\r\n\t\t\tleft: ev.pageX + 'px',\r\n\t\t});\r\n\t},\r\n\tonDragEnd () {\r\n\r\n\t\tif (this.$ghost)\r\n\t\t\tthis.$ghost.remove();\r\n\r\n\t\tif (this.getOption('elementClass'))\r\n\t\t\tthis.$el.removeClass(this.getOption('elementClass'));\r\n\t},\r\n\r\n\tgetDragTrigger() {\r\n\t\tif (this.getOption('dragTrigger'))\r\n\t\t\treturn this.getOption('dragTrigger');\r\n\r\n\t\treturn this.$el;\r\n\t},\r\n\t_setup() {\r\n\t\tdragAndDrop.setupDraggable(this.getDragTrigger(), this);\r\n\t},\r\n});\r\n\r\nexport default DraggableBehavior;\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\n\r\nlet SortByDrag = Mn.Behavior.extend({\r\n\tevents: {\t\t\t\t\r\n\t\t'drag:drop': '_dragDrop',\r\n\t\t'drag:over': '_dragOver',\r\n\t},\r\n\t_dragOver(ev, context) {\r\n\t\tif (this.wrongScope(context)) return;\r\n\t\tev.stopPropagation();\r\n\t\tev.preventDefault();\r\n\r\n\t\tif (ev.target === this.$el.get(0)) {\r\n\t\t\tthis._insert(context)\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar oldpos = this.dragOverPosition || '';\r\n\t\tvar m = { y: ev.pageY, x: ev.pageX };\r\n\t\tvar $el = this.getChildEl(ev.target);\r\n\t\tvar position = \"top:left\";\r\n\t\tif ($el.length) {\r\n\t\t\tvar i = this._get$elInfo($el);\r\n\t\t\tvar hor = m.x < i.center.x ? 'left' : 'right';\r\n\t\t\tvar ver = m.y < i.center.y ? 'top' : 'bottom';\r\n\t\t\tposition = ver + \":\" + hor;\r\n\t\t} else {\r\n\t\t\tconsole.warn(ev.target);\r\n\t\t}\r\n\r\n\t\tvar dragBy = this.getOption(\"dragBy\") || \"both\";\r\n\t\tif (oldpos != position) {\r\n\t\t\tvar apos = oldpos.split(':');\r\n\r\n\t\t\tvar eventContext = $el;\r\n\t\t\tvar _this = this;\r\n\t\t\tif (dragBy == \"both\") {\r\n\t\t\t\teventContext.trigger('dragged:over', [position, context]);\r\n\t\t\t}\r\n\t\t\tif (apos.indexOf(hor) === -1 && (dragBy === \"horizontal\" || dragBy === \"both\")) {\r\n\t\t\t\teventContext.trigger('dragged:over', [hor, context]);\r\n\t\t\t}\r\n\t\t\tif (apos.indexOf(ver) == -1 && (dragBy === \"vertical\" || dragBy === \"both\")) {\t\t\t\t\t\r\n\t\t\t\teventContext.trigger('dragged:over', [ver, context]);\r\n\t\t\t} \r\n\t\t\tthis.dragOverPosition = position;\r\n\t\t}\r\n\t},\r\n\t_dragDrop(ev, context) {\r\n\t\tif (this.wrongScope(context)) return;\r\n\t\tev.stopPropagation();\r\n\t\tev.preventDefault();\r\n\t\t\r\n\t\tthis._tryInsertBetween(context);\r\n\t\treturn false;\r\n\t},\r\n\t_tryInsertBetween (context) {\r\n\r\n\t\tvar model = context.model;\r\n\t\tvar view = context.view;\r\n\r\n\t\tif (!this.view.collection) {\r\n\t\t\tconsole.warn('collection not defined');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tview.$el.detach();\r\n\t\tview.destroy();\r\n\r\n\r\n\t\tthis.removeModelFromCollection(model);\r\n\t\tthis.insertModelAt(model, context.insertAt);\r\n\r\n\t},\r\n\tremoveModelFromCollection (model) {\r\n\t\tvar col = model.collection;\r\n\t\tif (!col) return;\r\n\t\tcol.remove(model);\r\n\t\tdelete model.collection;\r\n\t\tcol.each(function (m, i) { m.set(\"order\", i) });\r\n\t},\r\n\tinsertModelAt (model, at) {\r\n\t\tvar col = this.view.collection;\r\n\t\tif (!col) return;\r\n\t\t\r\n\t\tif(at <= 0) at = 0;\r\n\r\n\t\tif (at >= col.length) {\r\n\t\t\tmodel.set('order', col.length);\r\n\t\t\tmodel.collection = col;\r\n\t\t\tcol.push(model);\r\n\t\t} else {\r\n\t\t\tmodel.set('order', at);\r\n\t\t\t\r\n\t\t\tif(at > 0)\r\n\t\t\t\tcol.add(model, { at: at });\r\n\t\t\telse\r\n\t\t\t\tcol.unshift(model);\r\n\r\n\t\t\tcol.each(function (exist, ind) {\r\n\t\t\t\texist.set('order', ind);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.view.sort();\r\n\t},\r\n\r\n\tgetScope () {\r\n\t\treturn this.getOption(\"scope\") || \"default\";\r\n\t},\r\n\twrongScope (context) {\r\n\t\treturn this.getScope() !== context.scope;\r\n\t},\r\n\tgetChildEl (el) {\r\n\t\tvar selector = this.getOption('childSelector');\r\n\t\treturn $(el).closest(selector);\r\n\t},\r\n\t_get$elInfo ($el, force) {\r\n\t\tvar i = this._$elInfo = {\r\n\t\t\tsize: { width: $el.width(), height: $el.height() },\t\t\t\t\r\n\t\t\toffset: $el.offset()\r\n\t\t};\r\n\t\ti.center = { x: i.size.width / 2 + i.offset.left, y: i.size.height / 2 + i.offset.top };\r\n\t\treturn i;\r\n\t},\r\n\tgetOrder (beh) {\r\n\t\treturn beh.view.model.getOrder() || 0;\r\n\t},\r\n\t_updateInsert (context, order) {\r\n\t\tcontext.insertAt = order ;\r\n\t},\r\n\r\n\r\n\tonChildviewDraggedOverLeft (context, childBeh) {\r\n\t\tthis._insert(context, \"insertBefore\", childBeh.$el, this.getOrder(childBeh));\r\n\t},\r\n\tonChildviewDraggedOverTop (context, childBeh) {\r\n\t\tthis._insert(context, \"insertBefore\", childBeh.$el, this.getOrder(childBeh));\r\n\t},\r\n\tonChildviewDraggedOverRight (context, childBeh) {\r\n\t\tthis._insert(context, \"insertAfter\", childBeh.$el, this.getOrder(childBeh)+1);\r\n\t},\r\n\tonChildviewDraggedOverBottom (context, childBeh) {\r\n\t\tthis._insert(context, \"insertAfter\", childBeh.$el, this.getOrder(childBeh)+1);\r\n\t},\r\n\t_insert (context, method, $el, order) {\r\n\t\torder || (order = 0);\r\n\r\n\t\tif (method)\r\n\t\t\tcontext.view.$el[method]($el);\r\n\t\telse\r\n\t\t\tcontext.view.$el.appendTo(this.$el);\r\n\r\n\t\tthis._updateInsert(context, order);\r\n\t},\r\n});\r\n\r\n\r\nexport default SortByDrag;\r\n","import Mn from 'backbone.marionette';\r\nimport mixin from './helpers/mix.js';\r\nimport GetOptionProperty from './mixins/get-option-property.js';\r\nimport Radioable from './mixins/radioable.js';\r\n\r\nexport default mixin(Mn.Object).with(GetOptionProperty, Radioable);\r\n","import mix from '../helpers/mix';\r\nimport Stateable from '../mixins/stateable';\r\nimport YatObject from '../YatObject';\r\n\r\nconst IDENTITY_CHANNEL = 'identity';\r\n\r\nlet Base = mix(YatObject).with(Stateable);\r\nlet Identity = Base.extend({\t\r\n\tconstructor(...args){\r\n\t\tBase.apply(this, args);\r\n\t\tthis._initializeYatUser();\r\n\t},\r\n\t_initializeYatUser(){},\t\r\n\tchannelName: IDENTITY_CHANNEL,\r\n\tisAnonym(){\r\n\t\treturn !this.getState('id');\r\n\t},\r\n\tisUser(){\r\n\t\treturn !this.isAnonym();\r\n\t},\r\n\tisMe(id){\r\n\t\treturn id && this.getState('id') === id;\r\n\t},\r\n\tupdate(hash){\r\n\t\tthis.setState(hash);\r\n\t\tthis.trigger('change');\r\n\t},\r\n\tlogIn(hash){\r\n\t\tif(!hash.id) return;\r\n\t\tthis.update(hash);\r\n\t\tthis.trigger('log:in');\r\n\t},\r\n\tlogOut(){\r\n\t\tthis.clearState();\r\n\t\tthis.trigger('change');\r\n\t\tthis.trigger('log:out');\r\n\t}\r\n});\r\nlet identity = new Identity();\r\nexport default identity;\r\n","import dragAndDrop from './drag-and-drop';\r\nimport TemplateContext from './template-context';\r\nimport identity from './identity';\r\nexport default { dragAndDrop, TemplateContext, identity };\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\nimport Bb from 'backbone';\r\nimport mixin from './helpers/mix.js';\r\n\r\nimport GetOptionProperty from './mixins/get-option-property.js';\r\nimport RadioMixin from './mixins/radioable.js';\r\nimport Startable from './mixins/startable.js';\r\nimport Childrenable from './mixins/childrenable.js';\r\n\r\nlet Base = mixin(Mn.Application).with(GetOptionProperty, RadioMixin, Childrenable, Startable);\r\n\r\nexport default Base.extend({\r\n\r\n\tinitRadioOnInitialize: true,\r\n\t_initRegion(opts = {skip:true}){\r\n\t\tif(opts.skip) return;\r\n\t\tvar region = this.getProperty('region');\r\n\t\tthis.region = region;\r\n\t\tBase.prototype._initRegion();\r\n\t}, \r\n\r\n\tgetRegion() {\r\n\t\tif(!this._region) this._initRegion({skip:false});\r\n\t\treturn this._region;\r\n\t},\r\n\r\n\taddPageManager(pageManager){\r\n\t\tthis._pageManagers || (this._pageManagers = []);\r\n\t\tthis._pageManagers.push(pageManager);\r\n\r\n\t\tlet prefix = pageManager.getName();\r\n\t\tif(!prefix){\r\n\t\t\tconsole.warn('pageManager prefix not defined');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.listenTo(pageManager, 'all', (eventName, ...args) => {\r\n\t\t\tlet prefixedEventName = prefix + ':' + eventName;\r\n\t\t\tthis.triggerMethod(prefixedEventName, ...args);\r\n\t\t});\r\n\r\n\t},\r\n\r\n\thasPageManagers(){\r\n\t\treturn this._pageManagers && this._pageManagers.length > 0;\r\n\t},\r\n\r\n\tgetMenuTree(opts = {rebuild:false}){\r\n\t\tif(this._menuTree && !opts.rebuild) return this._menuTree;\r\n\t\tlet managers = this._pageManagers || [];\r\n\t\tlet links = _(managers).chain().map((manager) => manager.getLinks()).flatten().value();\r\n\t\tthis._menuTree = new Bb.Collection(links);\r\n\t\treturn this._menuTree;\r\n\t},\r\n\r\n\tgetPage(key){\r\n\t\tif(!this.hasPageManagers()) return;\r\n\t\treturn _(this._pageManagers).find((mngr) => mngr.getPage(key));\r\n\t},\r\n\r\n});\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\nexport default Mn.AppRouter.extend({},{\r\n\tcreate(hash, context){\r\n\t\tlet appRoutes = {};\r\n\t\tlet controller = {};\r\n\t\tlet _this = this;\r\n\t\t_(hash).each((handlerContext, key) => {\r\n\t\t\tappRoutes[key] = key;\r\n\t\t\tcontroller[key] = (...args) => {\r\n\t\t\t\thandlerContext\r\n\t\t\t\t.action(...args)\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\t_this._catchError(error, context);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn new this({controller, appRoutes});\r\n\t},\r\n\t_catchError(error, context){\r\n\t\tif(!context || context.getProperty('throwChildErrors') === true){\r\n\t\t\tthrow error;\r\n\t\t}else{\r\n\t\t\tlet postfix = error.status ? \":\" + error.status.toString() : '';\r\n\t\t\tlet commonEvent = 'error';\r\n\t\t\tlet event = commonEvent + postfix;\r\n\r\n\t\t\tcontext.triggerMethod(commonEvent, error, this);\r\n\r\n\t\t\tif(event != commonEvent) \r\n\t\t\t\tcontext.triggerMethod(event, error, this);\r\n\r\n\t\t}\r\n\r\n\t}\r\n});\r\n","import Bb from 'backbone';\r\nexport default Bb.Model.extend({});\r\n\r\n","import Model from './model'\r\nexport default Model.extend({\r\n\tdefaults:{\r\n\t\turl: undefined,\r\n\t\tlabel: undefined,\r\n\t\ttarget: '_self',\r\n\t\tlevel: 0,\r\n\t},\r\n\tdestroy(){\r\n\t\tthis.id = null;\r\n\t\tModel.prototype.destroy.apply(this, arguments);\r\n\t}\r\n});\r\n","import _ from 'underscore';\r\nimport App from './YatApp.js';\r\nimport mixin from './helpers/mix';\r\nimport Startable from './mixins/startable';\r\nimport GetNameLabel from './mixins/get-name-label';\r\nimport Router from './YatRouter.js';\r\nimport LinkModel from './models/link';\r\nimport Bb from 'backbone';\r\nimport identity from './singletons/identity';\r\n\r\n/* \r\n\tYatPage\r\n*/\r\n\r\nlet Base = mixin(App).with(GetNameLabel);\r\n\r\nexport default Base.extend({\r\n\r\n\tconstructor(...args){\r\n\t\tBase.apply(this,args);\r\n\t\tthis.initializeYatPage();\r\n\t},\r\n\r\n\tallowStopWithoutStart: true,\r\n\tallowStartWithoutStop: true,\r\n\r\n\tinitializeYatPage(opts){\r\n\t\tthis.mergeOptions(opts, [\"manager\"]);\r\n\t\tthis._initializeModels(opts);\r\n\t\tthis._initializeRoute(opts);\r\n\t\tthis._proxyEvents();\r\n\t\tthis._tryCreateRouter();\r\n\t\tthis._registerIdentityHandlers();\t\t\r\n\t},\r\n\r\n\tgetLayout(opts = {rebuild: false}){\r\n\t\tif(!this._layoutView || opts.rebuild || (this._layoutView && this._layoutView.isDestroyed && this._layoutView.isDestroyed())){\r\n\t\t\tthis.buildLayout();\r\n\t\t}\r\n\t\treturn this._layoutView;\r\n\t},\r\n\r\n\tbuildLayout(){\r\n\t\tlet Layout = this.getProperty('Layout');\r\n\t\tif(Layout == null) return;\r\n\t\tlet opts = _.extend({},this.getProperty('layoutOptions'));\r\n\r\n\t\tif(this.model && !opts.model)\r\n\t\t\t_.extend(opts,{model: this.model});\r\n\r\n\t\tif(this.collection && !opts.collection)\r\n\t\t\t_.extend(opts,{collection: this.collection});\r\n\t\t\t\r\n\t\tlet options = this.buildLayoutOptions(opts);\r\n\t\toptions.page = this;\r\n\t\tthis._layoutView = new Layout(options);\r\n\t\treturn this._layoutView;\r\n\t},\r\n\r\n\tbuildLayoutOptions(rawOptions){\r\n\t\treturn rawOptions;\r\n\t},\r\n\r\n\taddModel(model, opts = {}){\t\t\t\t\r\n\t\tif(!model) return;\r\n\t\tthis.model = model;\r\n\t\tlet fetch = opts.fetch || this.getOption('fetchModelOnAdd');\r\n\t\tif(fetch === undefined){\r\n\t\t\tfetch = this.getProperty('fetchDataOnAdd');\r\n\t\t}\r\n\t\tif(fetch === true){\r\n\t\t\tthis.addStartPromise(model.fetch(opts));\r\n\t\t}\r\n\t},\r\n\r\n\taddCollection(collection, opts = {}){\r\n\t\tif(!collection) return;\r\n\t\tthis.collection = collection;\r\n\t\tlet fetch = opts.fetch || this.getOption('fetchCollectionOnAdd');\r\n\t\tif(fetch === undefined){\r\n\t\t\tfetch = this.getProperty('fetchDataOnAdd');\r\n\t\t}\r\n\t\tif(fetch === true){\r\n\t\t\tthis.addStartPromise(collection.fetch(opts));\r\n\t\t}\r\n\t},\r\n\r\n\tgetRouteHash(){\r\n\r\n\t\tlet hashes = [{},this._routeHandler].concat(this.getChildren({startable:false}).map((children) => children.getRouteHash()))\r\n\t\treturn _.extend(...hashes);\r\n\r\n\t},\r\n\r\n\thasRouteHash(){\r\n\t\treturn _.isObject(this.getRouteHash())\r\n\t},\r\n\r\n\tgetLinkModel(level = 0){\r\n\t\tif(!this._canHaveLinkModel()) return;\t\t\r\n\t\tif(this._linkModel) return this._linkModel;\r\n\r\n\t\tlet url = this.getRoute();\r\n\t\tlet label = this.getLabel();\r\n\t\tlet children = this._getSublinks(level);\r\n\t\tthis._linkModel = new LinkModel({ url, label, level, children });\r\n\r\n\t\treturn this._linkModel;\r\n\t},\r\n\t_canHaveLinkModel(){\r\n\t\treturn !((this.getProperty('skipMenu') === true) || (!!this.getProperty('isStartNotAllowed')));\r\n\t},\r\n\t_destroyLinkModel(){\r\n\t\tif(!this._linkModel) return;\r\n\t\tthis._linkModel.destroy();\r\n\t\tdelete this._linkModel;\r\n\t},\r\n\r\n\tgetParentLinkModel(){\r\n\t\tlet parent = this.getParent();\r\n\t\tif(!parent || !parent.getLinkModel) return;\r\n\t\tlet model = parent.getLinkModel();\r\n\t\treturn model;\r\n\t},\r\n\r\n\tgetNeighbourLinks(){\r\n\t\tlet link = this.getLinkModel();\r\n\t\tif(link && link.collection) return link.collection;\r\n\t},\r\n\r\n\tgetChildrenLinks(){\r\n\t\tlet model = this.getLinkModel();\r\n\t\tif(!model) return;\r\n\t\treturn model.get('children');\r\n\t},\r\n\r\n\t_getSublinks(level){\r\n\t\tlet children = this.getChildren();\r\n\t\tif(!children || !children.length) return;\r\n\t\tlet sublinks = _(children).chain()\r\n\t\t\t.filter((child) => child.getProperty(\"skipMenu\") !== true)\r\n\t\t\t.map((child) => child.getLinkModel(level + 1))\r\n\t\t\t.value();\r\n\t\tif(!sublinks.length) return;\r\n\t\tlet col = new Bb.Collection(sublinks);\r\n\t\treturn col;\r\n\t},\r\n\r\n\t_initializeModels(opts = {}){\r\n\t\tthis.addModel(opts.model, opts);\r\n\t\tthis.addCollection(opts.collection, opts);\r\n\t},\r\n\r\n\t_initializeRoute(){\r\n\t\tlet route = this.getRoute({asPattern:true});\r\n\t\tif(route == null) return;\r\n\t\tlet page = this;\r\n\t\tthis._routeHandler = {\r\n\t\t\t[route]:{context: page, action: (...args) => page.start(...args) }\r\n\t\t};\r\n\t},\r\n\r\n\tgetRoute(opts = {asPattern:false}){\r\n\t\tlet relative = this.getProperty('relativeRoute');\r\n\t\tlet route = this.getProperty('route');\r\n\t\tlet parent = this.getParent();\r\n\t\tif(route == null) return;\r\n\t\t\r\n\t\tlet result = route;\r\n\r\n\t\tif(relative && parent && parent.getRoute){\r\n\t\t\tlet parentRoute = parent.getRoute();\r\n\t\t\tresult = parentRoute + '/' + route;\t\t\t\r\n\t\t}\r\n\r\n\t\treturn this._normalizeRoute(result, opts);\r\n\t},\r\n\t_normalizeRoute(route, opts){\t\t\r\n\t\troute = route.replace(/\\/+/gmi,'/').replace(/^\\//,'');\r\n\t\tif(opts.asPattern){\r\n\t\t\treturn route;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tlet res = route.replace(/\\(\\/\\)/gmi,'/').replace(/\\/+/gmi,'/');\r\n\t\t\treturn res;\r\n\t\t}\r\n\t},\r\n\t_tryCreateRouter(){\r\n\t\tlet create = this.getProperty('createRouter') === true;\r\n\t\tif(create){\r\n\t\t\tthis.router = this._createAppRouter();\r\n\t\t}\r\n\t},\r\n\r\n\t_createAppRouter(){\r\n\t\tlet hash = this.getRouteHash();\r\n\t\tif(!_.size(hash)) return;\r\n\t\treturn new Router(hash);\r\n\t},\r\n\r\n\t_proxyEvents(){\r\n\t\tlet proxyContexts = this._getProxyContexts();\r\n\t\tthis._proxyEventsTo(proxyContexts);\r\n\t},\r\n\t_getProxyContexts(){\r\n\t\tlet rdy = [];\r\n\t\tlet manager = this.getProperty('manager');\r\n\t\tif(manager){\r\n\t\t\trdy.push({context:manager})\r\n\t\t}\r\n\t\tlet radio = this.getChannel();\r\n\t\tif(radio){\r\n\t\t\tlet allowed = this.getProperty('proxyEventsToRadio');\r\n\t\t\trdy.push({context:radio, allowed });\r\n\t\t}\r\n\t\treturn rdy;\r\n\t},\r\n\t_proxyEventsTo(contexts){\r\n\t\tlet all = [];\r\n\t\tlet eventsHash = {};\r\n\r\n\t\t_(contexts).each((context) => {\r\n\t\t\tlet events = [];\r\n\t\t\tif(!context.allowed)\r\n\t\t\t\tall.push(context.context);\r\n\t\t\telse {\r\n\t\t\t\t_(context.allowed).each(function(allowed){\r\n\t\t\t\t\teventsHash[allowed] || (eventsHash[allowed] = []);\r\n\t\t\t\t\teventsHash[allowed].push(context.context)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tlet page = this;\r\n\t\tpage.on('all', (eventName, ...args) => {\r\n\t\t\tlet contexts = (eventName in eventsHash) ? eventsHash[eventName] : all;\r\n\t\t\tlet triggerArguments = [page].concat(args);\r\n\t\t\t_(contexts).each((context) => context.triggerMethod(`page:${eventName}`, ...triggerArguments))\r\n\t\t});\r\n\r\n\t},\r\n\r\n\t_buildChildOptions: function(def){\r\n\t\tlet add = {};\r\n\t\tlet manager = this.getProperty('manager');\r\n\t\tif(manager) add.manager = manager;\r\n\t\treturn _.extend(def, this.getProperty('childOptions'), add);\r\n\t},\t\r\n\r\n\t_registerIdentityHandlers(){\r\n\t\tthis.listenTo(identity, 'change', (...args) => {\r\n\t\t\tthis._destroyLinkModel();\r\n\t\t\tthis.triggerMethod('identity:change', ...args);\r\n\t\t});\r\n\t}\r\n\r\n});\r\n","import _ from 'underscore';\r\nimport App from './YatApp';\r\nimport GetNameLabel from './mixins/get-name-label';\r\nimport Router from './YatRouter';\r\nimport mixin from './helpers/mix';\r\nimport identity from './singletons/identity';\r\nimport YatError from './YatError';\r\n\r\nlet Base = mixin(App).with(GetNameLabel);\r\n\r\nlet YatPageManager = Base.extend({\r\n\tconstructor(...args){\r\n\t\tBase.apply(this, args);\r\n\t\tthis._initializeYatPageManager(...args);\r\n\t},\r\n\tthrowChildErrors:true,\r\n\tcreateRouter(){\r\n\t\tlet children = this.getChildren({startable:false});\r\n\t\tlet hash = {};\r\n\t\t_(children).each(function(page){\r\n\t\t\tif(_.isFunction(page.getRouteHash)){\r\n\t\t\t\t_.extend(hash, page.getRouteHash());\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._routesHash = hash;\t\t\r\n\t\tthis.setRouter(Router.create(hash, this));\r\n\t},\r\n\tsetRouter(router){\r\n\t\tthis.router = router;\r\n\t},\r\n\tgetRouter(){\r\n\t\treturn this.router;\r\n\t},\r\n\tgetLinks(){\r\n\t\tlet children = this.getChildren();\r\n\t\tif(!children) return;\r\n\t\treturn _(children).chain()\t\t\t\r\n\t\t\t.map((child) => child.getLinkModel())\r\n\t\t\t.filter((child) => !!child)\r\n\t\t\t.value();\r\n\t},\r\n\texecute(route){\r\n\t\tlet page = this.getPage(route);\r\n\t\tif(!!page) \r\n\t\t\tpage.start({text: error.message});\r\n\t\telse if(route === '*NotFound')\r\n\t\t\tthrow new YatError.NotFound('*NotFound handler is missing');\r\n\t\telse\r\n\t\t\tthis.execute('*NotFound');\r\n\t},\r\n\tnavigate(url, opts = {trigger:true}){\r\n\r\n\t\tlet router = this.getRouter();\r\n\t\tif(router)\r\n\t\t\trouter.navigate(url, opts);\r\n\t\telse\r\n\t\t\tconsole.warn('router not found');\r\n\t},\r\n\r\n\tgetPage(key){\r\n\r\n\t\tlet found = _(this._routesHash)\r\n\t\t\t.find((pageContext, route) => {\r\n\t\t\t\tif(route === key) return true;\r\n\t\t\t\tif(pageContext.context.getName() === key) return true;\r\n\t\t\t});\r\n\t\treturn found && found.context;\r\n\r\n\t},\r\n\r\n\r\n\tnavigateToRoot(){\r\n\t\tlet current = this.getState('currentPage');\r\n\t\tlet rootUrl = this.getProperty('rootUrl');\r\n\t\tif(!rootUrl){\r\n\t\t\tlet children = this.getChildren();\r\n\t\t\tif(children && children.length) {\r\n\t\t\t\tlet root = children.find((child) => child != current);\r\n\t\t\t\trootUrl = root && root.getRoute()\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(rootUrl != null)\r\n\t\t\tthis.navigate(rootUrl);\r\n\t\telse\r\n\t\t\tconsole.warn('root page not found');\r\n\t},\r\n\r\n\t_initializeYatPageManager(opts = {}){\r\n\t\tthis.mergeOptions(opts, ['id','name','label']);\r\n\t\tthis._registerPageHandlers(opts);\r\n\t\tthis._registerIdentityHandlers();\r\n\t\tthis.createRouter();\r\n\t},\r\n\r\n\t_buildChildOptions: function(def){\r\n\t\treturn _.extend(def, this.getProperty('childOptions'), {\r\n\t\t\tmanager: this\r\n\t\t});\r\n\t},\t\r\n\r\n\t_registerPageHandlers(){\r\n\t\tthis.on('page:before:start', this._pageBeforeStart);\r\n\t\tthis.on('page:start', this._pageStart);\r\n\t\tthis.on('page:start:decline', this._pageDecline);\r\n\t},\r\n\r\n\t_pageBeforeStart(page){\r\n\t\tlet current = this.getState('currentPage');\r\n\t\tif(current && current != page){\r\n\t\t\tcurrent.stop();\r\n\t\t}\r\n\t},\r\n\r\n\t_pageStart(page){\r\n\t\tthis.setState('currentPage', page);\r\n\t},\r\n\r\n\t_pageDecline(...args){\r\n\t\t//console.log(\"decline\", args)\r\n\t},\r\n\r\n\t_registerIdentityHandlers(){\r\n\t\tthis.listenTo(identity, 'change', (...args) => {\r\n\t\t\tthis.triggerMethod('identity:change', ...args);\r\n\t\t\tthis._moveToRootIfCurrentPageNotAllowed();\r\n\t\t});\r\n\t},\r\n\t\r\n\t_moveToRootIfCurrentPageNotAllowed(){\r\n\t\tlet current = this.getState('currentPage');\r\n\t\tif(!current || !current.isStartNotAllowed()) return;\r\n\t\t\r\n\t\tthis.navigateToRoot();\r\n\t}\r\n\r\n});\r\n\r\nexport default YatPageManager;\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\nimport mix from './helpers/mix';\r\nimport GlobalTemplateContext from './mixins/global-template-context';\r\nexport default mix(Mn.View).with(GlobalTemplateContext);\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\nimport mix from './helpers/mix';\r\nimport GlobalTemplateContext from './mixins/global-template-context';\r\nexport default mix(Mn.NextCollectionView).with(GlobalTemplateContext);\r\n","import {version} from '../package.json';\nimport Functions from './functions/functions';\nimport Helpers from './helpers/Helpers';\nimport Mixins from './mixins/Mixins';\nimport Behaviors from './behaviors/behaviors';\nimport Singletons from './singletons/singletons';\nimport TemplateContext from './singletons/template-context';\nimport identity from './singletons/identity';\nimport YatObject from './YatObject';\nimport YatError from './YatError';\nimport YatApp from './YatApp';\nimport YatRouter from './YatRouter';\nimport YatPage from './YatPage';\nimport YatPageManager from './YatPageManager';\nimport YatView from './YatView';\nimport YatCollectionView from './YatCollectionView';\n\nconst marionetteYat = {\n\tVERSION: version,\n\tFunctions: Functions,\n\tHelpers: Helpers,\n\tMixins: Mixins,\n\tBehaviors: Behaviors,\n\tSingletons: Singletons,\n\tTemplateContext: TemplateContext,\n\tidentity: identity,\n\tObject: YatObject,\n\tError: YatError,\n\tApp: YatApp,\n\tPage : YatPage,\n\tRouter: YatRouter,\n\tPageManager: YatPageManager,\n\tView: YatView,\n\tCollectionView: YatCollectionView\n};\n\nexport default marionetteYat;\n"]}