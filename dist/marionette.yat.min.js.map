{"version":3,"sources":["src/functions/view/compare-ab.js","src/functions/common/smart-get.js","src/functions/common/get-label.js","src/functions/common/common.js","src/functions/common/get-name.js","src/functions/common/get-value.js","src/functions/functions.js","src/functions/view/view.js","src/functions/view/view-comparator.js","src/helpers/isKnownCtor.js","src/YatError.js","src/helpers/mix.js","src/helpers/Helpers.js","src/mixins/get-name-label.js","src/mixins/get-option-property.js","src/mixins/radioable.js","src/mixins/stateable.js","src/mixins/startable.js","src/mixins/childrenable.js","src/singletons/template-context.js","src/mixins/global-template-context.js","src/mixins/Mixins.js","src/singletons/drag-and-drop.js","src/behaviors/behaviors.js","src/behaviors/draggable.js","src/behaviors/sort-by-drag.js","src/YatObject.js","src/singletons/identity.js","src/singletons/singletons.js","src/YatApp.js","src/YatRouter.js","src/models/model.js","src/models/link.js","src/YatPage.js","src/YatPageManager.js","src/YatView.js","src/YatCollectionView.js","src/marionette.yat.js"],"names":["getCompareABModel","arg","Bb","Model","Mn","View","model","getCompareABView","compareAB","a","b","func","call","normalizeValue","context","value","args","_","isFunction","apply","smartGet","opts","arguments","length","undefined","fields","fileds","Error","checked","isModel","hasOptions","isObject","options","exclude","Array","some","fieldName","indexOf","get","default","common","concat","getName","getValue","Functions","view","viewComparator","_len","_key","compareArray","result","every","singleCompare","knownCtors","Collection","Router","Object","isKnownCtor","isFn","ctor","prototype","YatError","extend","message","this","Http","status","error","name","Http404","Http401","Http403","mix","BaseClass","Mixed","tmp","reduce","memo","Src","Dst","smartExtend","Helpers","GetNameLabel","Base","getLabel","GetOptionProperty","key","_getOptionOrProperty","getOption","getProperty","deep","valueContext","fallback","force","fallbackOptions","RadioMixin","initRadioOnInitialize","_initRadio","skip","_channel","channel","channelName","getChannel","request","trigger","Stateable","Mixin","initializeStateable","_state","state","_this","each","propertyValue","propertyName","setState","_triggerStateChange","getState","broadcast","s","triggerMethod","toString","STATES","getPropertyPromise","rawPromises","promises","promiseArg","push","Promise","all","addPropertyPromise","promise","Startable","Middle","with","State","initializeStartable","constructor","_registerStartableLifecycleListeners","_setLifeState","_len2","_key2","canNotBeStarted","_ensureStartableCanBeStarted","resultPromise","catchMethod","_this2","reject","declineReason","isStartNotAllowed","currentState","_getLifeState","_tryMergeStartOptions","_getStartPromise","then","triggerStart","canNotBeStopped","_ensureStartableCanBeStopped","isStopNotAllowed","_tryMergeStopOptions","_getStopPromise","triggerStop","newstate","states","_len3","_key3","_this4","_isLifeState","_isLifeStateIn","on","_this5","mergeOptions","mergeoptions","throwError","destroyed","isNotIntact","_ensureStartableIsIntact","notIdle","_isInProcess","_ensureStartableIsIdle","allowStartWithoutStop","running","allowStopWithoutStart","_getStartPromises","_getStartUserPromise","_getStartParentPromise","parent","_getStopPromises","_getStopUserPromise","Childrenable","CHILDREN_FIELD","initializeChildrenable","_initializeParrent","_initializeChildren","getChildren","startable","filter","c","getParent","_children","children","child","childContext","_normalizeChildContext","initialized","_initializeChild","Child","_normalizeChildOptions","buildChild","_buildChildOptions","def","ChildClass","templateContextStore","compiledContext","hasChanges","GlobalTemplateContext","viewTemplateContext","global","compile","item","_len4","_key4","newcontext","cntx","pop","shift","unshift","target","templateContext","TemplateContext","Mixins","isEqualOrContains","node1","node2","jquery","$","contains","dragAndDrop","$el","beh","event","uniqueId","x","pageX","y","pageY","mouse","getOffset","ev","res","startAt","absX","Math","abs","absY","distance","round","sqrt","_documentHandlers","mousemove","bind","__documentMouseMoveHandler","mouseup","__documentMouseUpHandler","mouseleave","__documentMouseLeaveHandler","mouseenter","__documentMouseEnterHandler","_elementHandlers","dragover","__dragOverHandler","behavior","Behavior","$handler","selector","__triggerMouseDownHandler","preventDefault","stopPropagation","buildDraggableContext","document","one","_clearAllHandlers","startDistance","_initializeDragging","$entered","off","_createCustomDomEvent","merge","customEvent","jQuery","Event","prop","$doc","handler","_triggerHandlers","Behaviors","Draggable","part","wrongScope","_setup","getScope","scope","$g","$ghost","clone","css","width","addClass","$dragContext","appendTo","draggingContext","remove","removeClass","setupDraggable","getDragTrigger","SortByDrag","oldpos","dragOverPosition","m","getChildEl","position","i","_get$elInfo","hor","center","ver","warn","dragBy","apos","split","eventContext","_insert","_tryInsertBetween","collection","detach","destroy","removeModelFromCollection","insertModelAt","insertAt","col","set","at","add","exist","ind","sort","el","closest","_$elInfo","height","offset","size","left","top","getOrder","order","childBeh","method","_updateInsert","YatObject","mixin","Radioable","identity","_initializeYatUser","isAnonym","id","hash","update","clearState","Singletons","Application","App","region","_initRegion","_region","pageManager","_pageManagers","prefix","listenTo","eventName","prefixedEventName","rebuild","_menuTree","managers","links","chain","map","manager","getLinks","flatten","hasPageManagers","find","mngr","getPage","AppRouter","appRoutes","controller","handlerContext","action","catch","_catchError","LinkModel","YatPage","initializeYatPage","_initializeModels","_initializeRoute","_proxyEvents","_tryCreateRouter","_registerIdentityHandlers","_layoutView","isDestroyed","buildLayout","Layout","buildLayoutOptions","page","rawOptions","fetch","addStartPromise","hashes","_routeHandler","getRouteHash","_toConsumableArray","level","_canHaveLinkModel","_linkModel","url","getRoute","label","_getSublinks","getLinkModel","link","sublinks","addModel","addCollection","route","asPattern","start","relative","_normalizeRoute","replace","router","_createAppRouter","proxyContexts","_getProxyContexts","_proxyEventsTo","rdy","radio","allowed","contexts","eventsHash","triggerArguments","_destroyLinkModel","YatPageManager","_initializeYatPageManager","_routesHash","setRouter","create","text","NotFound","execute","getRouter","navigate","console","found","pageContext","current","rootUrl","root","_registerPageHandlers","createRouter","_pageBeforeStart","_pageStart","_pageDecline","stop","_moveToRootIfCurrentPageNotAllowed","navigateToRoot","YatView","YatCollectionView","NextCollectionView","YatApp","YatRouter"],"mappings":"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","file":"marionette.yat.min.js","sourcesContent":["import Bb from 'backbone';\r\nimport Mn from 'backbone.marionette';\r\n\r\nlet getCompareABModel = (arg) => {\r\n\tif (arg instanceof Bb.Model)\r\n\t\treturn arg;\r\n\telse if (arg instanceof Mn.View)\r\n\t\treturn arg.model;\r\n\telse\r\n\t\treturn;\r\n}\r\nlet getCompareABView = (arg) => {\r\n\tif (arg instanceof Bb.View)\r\n\t\treturn arg;\r\n\telse\r\n\t\treturn;\r\n}\r\n\r\nlet compareAB = (a, b, func) => {\r\n\tif (typeof func === 'function') {\r\n\t\ta = func.call(a, getCompareABModel(a), getCompareABView(a));\r\n\t\tb = func.call(b, getCompareABModel(b), getCompareABView(b));\r\n\t}\r\n\treturn a < b ? -1\r\n\t\t: a > b ? 1\r\n\t\t\t: 0;\r\n};\r\n\r\nexport default compareAB;\r\n","import _ from 'underscore';\r\nimport Bb from 'backbone';\r\n\r\nfunction normalizeValue(context, value, args){\r\n\tif(_.isFunction(value))\r\n\t\tvalue = value.apply(context, args || []);\r\n\treturn value;\r\n}\r\n\r\nfunction smartGet(context, opts = {}){\r\n\tif(opts.fields == null || (opts.fileds && !opts.fileds.length))\r\n\t\tthrow new Error('fields option missing');\r\n\r\n\topts.checked || (opts.checked = {});\r\n\t\r\n\tif(context == null) return;\r\n\r\n\tlet value;\r\n\tlet isModel = context instanceof Bb.Model;\r\n\tlet hasOptions = _.isObject(context.options);\r\n\tlet exclude = opts.exclude instanceof Array ? opts.exclude \r\n\t\t\t\t: typeof opts.exclude === 'string' ? [opts.exclude]\r\n\t\t\t\t: [];\r\n\r\n\r\n\t_(opts.fields).some((fieldName) => {\r\n\t\tif(fieldName in opts.checked) return;\r\n\t\topts.checked[fieldName] = true;\r\n\t\t\r\n\t\tif(exclude.indexOf(fieldName)>=0){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(isModel && value == null)\r\n\t\t\tvalue = normalizeValue(context, context.get(fieldName), opts.args);\r\n\r\n\t\tif(value == null)\r\n\t\t\tvalue = normalizeValue(context, context[fieldName], opts.args);\r\n\r\n\t\tif(value == null && hasOptions)\r\n\t\t\tvalue = normalizeValue(context, context.options[fieldName], opts.args);\r\n\r\n\t\treturn value != null;\r\n\t});\r\n\r\n\treturn value == null ? opts.default : value;\r\n\r\n}\r\n\r\n\r\nexport default smartGet;\r\n","import get from './smart-get';\r\nexport default (context, opts = {}) => {\r\n\tlet fields = ['getLabel', 'label', 'getName', 'name', 'getValue', 'value'];\r\n\topts.fields = fields.concat(opts.fields || []);\r\n\treturn get(context, opts);\r\n}\r\n","import getLabel from './get-label';\r\nimport getName from './get-name';\r\nimport getValue from './get-value';\r\nexport default {\r\n\tgetLabel, getName, getValue\r\n}\r\n","import get from './smart-get';\r\nexport default (context, opts = {}) => {\r\n\tlet fields = ['getName', 'name', 'getLabel', 'label', 'getValue', 'value'];\r\n\topts.fields = fields.concat(opts.fields || []);\r\n\treturn get(context, opts);\r\n}\r\n","import get from './smart-get';\r\nexport default (context, opts = {}) => {\r\n\tlet fields = ['getValue', 'value', 'getId', 'id', 'getName', 'name', 'getLabel', 'label', 'cid'];\r\n\topts.fields = fields.concat(opts.fields || []);\r\n\treturn get(context, opts);\r\n}\r\n","import view from './view/view';\r\nimport common from './common/common';\r\nexport default { view, common };\r\n","import compareAB from './compare-ab';\r\nimport viewComparator from './view-comparator';\r\nexport default { compareAB, viewComparator };\r\n","import _ from 'underscore';\r\nimport compareAB from './compare-ab';\r\n\r\n/*\r\n*\taccepts:\r\n*\t\tvariant #1: a, b, function\r\n*\t\tvariant #2: [[a,b,function], [a,b,function]]\r\n*\t\tfunction can be undefined\r\n*\t\texample:\r\n*\t\t\tascending\t:\t\treturn viewComparator(viewA, viewB, function(model, view){ return model && model.get('someTextField') });\r\n*\t\t\tdescending\t:\t\treturn viewComparator(viewB, viewA, function(model, view){ return model && model.get('someTextField') });\r\n\t\t\tmultiple compares: \treturn viewComparator([[viewB, viewA, func], [viewB, viewA, func]])\r\n*/\r\nlet viewComparator = (...args) => {\r\n\tvar compareArray = [];\r\n\tvar result = 0;\r\n\r\n\tif (args.length >= 2)\t// single compare\r\n\t\treturn compareAB.apply(null, args);\r\n\telse if (args.length === 1 && args[0] instanceof Array)\t// array of compare\r\n\t\tcompareArray = args[0];\r\n\r\n\t_(compareArray).every(function (singleCompare) {\r\n\t\tresult = compareAB.apply(null, singleCompare);\r\n\t\treturn result === 0;\r\n\t});\r\n\t\r\n\treturn result;\r\n}\r\n\r\nexport default viewComparator;\r\n","import _ from 'underscore';\r\nimport Bb from 'backbone';\r\nimport Mn from 'backbone.marionette';\r\n\r\nconst knownCtors = [\r\n\tBb.Model,\r\n\tBb.Collection,\r\n\tBb.View,\r\n\tBb.Router,\r\n\tMn.Object\r\n];\r\n\r\nfunction isKnownCtor(arg) {\r\n\tlet isFn = _.isFunction(arg);\r\n\tlet result = _(knownCtors).some((ctor) => arg === ctor || arg.prototype instanceof ctor);\r\n\treturn isFn && result;\r\n}\r\n\r\nexport default isKnownCtor;\r\n","import Mn from 'backbone.marionette';\r\nimport mix from './helpers/mix';\r\n\r\n\r\nlet YatError = Mn.Error.extend({},{\r\n\tHttp400(message){\r\n\t\treturn this.Http(400,message);\r\n\t},\r\n\tHttp401(message){\r\n\t\treturn this.Http(401,message);\r\n\t},\r\n\tHttp403(message){\r\n\t\treturn this.Http(403,message);\r\n\t},\r\n\tHttp404(message){\r\n\t\treturn this.Http(404, message);\r\n\t},\r\n\tHttp500(message){\r\n\t\treturn this.Http(500, message);\r\n\t},\r\n\tHttp(status, message){\r\n\t\tlet error = new this({message:message, name:\"HttpError\"});\r\n\t\terror.status = status;\r\n\t\treturn error;\r\n\t},\r\n\tHttpRedirect(message){\r\n\t\treturn this.Http(301, message);\r\n\t},\r\n\tNotFound(message){\r\n\t\treturn this.Http404(message);\r\n\t},\r\n\tNotAuthorized(message){\r\n\t\treturn this.Http401(message);\r\n\t},\r\n\tForbidden(message){\r\n\t\treturn this.Http403(message);\r\n\t},\r\n});\r\n\r\nexport default YatError;\r\n","import _ from 'underscore'\r\nimport Mn from 'backbone.marionette';\r\nimport YatError from '../YatError';\r\n\r\nfunction smartExtend(Src, Dst){\r\n\tif(_.isFunction(Dst)){\r\n\t\treturn Dst(Src);\r\n\t}\r\n\telse if(_.isObject(Dst)){\r\n\t\treturn Src.extend(Dst);\r\n\t}\r\n\telse throw new YatError('Mixin fail, argument should be an object hash or mixin function')\r\n}\r\n\r\nfunction mix(BaseClass){\r\n\tlet Mixed = null;\r\n\tif(_.isFunction(BaseClass)){\r\n\t\tMixed = BaseClass;\r\n\t}\r\n\telse if(_.isObject(BaseClass) && BaseClass !== null){\r\n\t\tlet tmp = function(){};\r\n\t\ttmp.extend = Mn.extend;\r\n\t\tMixed = tmp.extend(BaseClass);\r\n\t}\r\n\telse {\r\n\t\tthrow new Error('argument should be an object or class definition')\r\n\t}\r\n\tif(!Mixed.extend) {\r\n\t\tMixed = Mn.extend.call(BaseClass, {});\r\n\t\tMixed.extend = Mn.extend;\r\n\t}\r\n\tlet fake = {\r\n\t\twith: (...args) => _.reduce(args, (memo, arg) => smartExtend(memo, arg), Mixed),\r\n\t\tclass: Mixed,\t\r\n\t}\r\n\treturn fake;\r\n}\r\n\r\nexport default mix;\r\n","import isKnownCtor from './isKnownCtor';\r\nimport mix from './mix';\r\nexport default {\r\n\tisKnownCtor,\r\n\tmix,\r\n}\r\n","import _ from 'underscore';\r\nimport common from '../functions/common/common';\r\nexport default function (Base) {\r\n\treturn Base.extend({\r\n\t\tgetName(opts = {}){\r\n\t\t\tlet options = _.extend({}, opts);\r\n\t\t\toptions.exclude = 'getName';\r\n\t\t\toptions.args = [options];\r\n\t\t\treturn common.getName(this, options);\r\n\t\t},\r\n\t\tgetLabel(opts = {}){\r\n\t\t\tlet options = _.extend({}, opts);\r\n\t\t\toptions.exclude = 'getLabel';\r\n\t\t\toptions.args = [options];\r\n\t\t\treturn common.getLabel(this, options);\r\n\t\t},\r\n\t\tgetValue(opts = {}){\r\n\t\t\tlet options = _.extend({}, opts);\r\n\t\t\toptions.exclude = 'getValue';\r\n\t\t\toptions.args = [options];\r\n\t\t\treturn common.getValue(this, options);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n","import _ from 'underscore';\r\nimport isKnownCtor from '../helpers/isKnownCtor.js';\r\n\r\n\r\nexport default (Base) => {\r\n\tlet Mixin = Base.extend({\r\n\t\t//property first approach\r\n\t\tgetProperty(key, options){\r\n\t\t\treturn this._getOptionOrProperty(this, key, options, this.getOption);\r\n\t\t},\r\n\t\t//options first approach\r\n\t\tgetOption(key, options){\r\n\t\t\treturn this._getOptionOrProperty(this.getProperty('options',{deep:false}), key, options, this.getProperty);\r\n\t\t},\r\n\t\t_getOptionOrProperty(valueContext, key, options = {}, fallback)\r\n\t\t{\r\n\t\t\toptions.deep !== undefined || (options.deep = true);\r\n\t\t\toptions.force !== undefined || (options.force = true);\r\n\t\t\toptions.args || (options.args = []);\r\n\r\n\t\t\t//key and valueContext should be passed\r\n\t\t\tif(key == null || valueContext == null) return;\r\n\t\t\t\r\n\t\t\t//getting raw value\r\n\t\t\tlet value = valueContext[key];\r\n\r\n\t\t\t//if there is no raw value and deep option is true then getting value from fallback\r\n\t\t\tif(value === undefined && options.deep && _.isFunction(fallback)){\r\n\t\t\t\tlet fallbackOptions = _.extend({}, options, {deep:false, force: false});\r\n\t\t\t\tvalue = fallback.call(this, key, fallbackOptions); \r\n\t\t\t}\r\n\r\n\t\t\t//if returned value is function and is not any of known constructors and options property force set to true \r\n\t\t\t//we should return value of that function\r\n\t\t\t//options.args will be passed as arguments\r\n\t\t\tif(_.isFunction(value) && options.force && !isKnownCtor(value))\r\n\t\t\t\tvalue = value.apply(this, options.args || []);\r\n\r\n\t\t\t//console.log('key', key, value);\r\n\t\t\t\r\n\t\t\t//if value is still undefined we will return default option value\r\n\t\t\treturn value === undefined ? options.default : value;\r\n\t\t}\r\n\t});\r\n\treturn Mixin;\r\n}\r\n","import Mn from 'backbone.marionette';\r\n\r\nexport default (Base) => {\r\n\tlet Mixin = Base.extend({\r\n\t\tconstructor(...args){\r\n\t\t\tBase.apply(this, args);\r\n\t\t\tlet initRadioOnInitialize = !(this.getProperty('initRadioOnInitialize') === true);\r\n\t\t\tthis._initRadio({skip: initRadioOnInitialize});\r\n\t\t},\r\n\t\tgetChannel () {\r\n\t\t\tif(!this._channel) this._initRadio({skip:false});\r\n\t\t\treturn this._channel;\r\n\t\t},\r\n\t\t_initRadio(opts = {skip:true}){\r\n\t\t\tif(opts.skip == true) return;\r\n\r\n\t\t\tlet channelName = this.getProperty('channelName');\r\n\t\t\tif(!channelName){\r\n\t\t\t\tlet channel = this.getProperty('channel');\r\n\t\t\t\tif(channel)\r\n\t\t\t\t\tthis.channelName = channel.channelName;\r\n\t\t\t}\r\n\t\t\tMn.Object.prototype._initRadio.call(this);\r\n\t\t},\r\n\t\tradioRequest(...args){\r\n\t\t\tlet channel = this.getChannel();\r\n\t\t\tif(channel) channel.request(...args);\r\n\t\t},\r\n\t\tradioTrigger(...args){\r\n\t\t\tlet channel = this.getChannel();\r\n\t\t\tif(channel) channel.trigger(...args);\r\n\t\t},\r\n\t});\r\n\r\n\treturn Mixin;\r\n}\r\n","import _ from 'underscore';\r\n\r\nexport default (BaseClass) => {\r\n\tlet Mixin = BaseClass.extend({\r\n\t\tconstructor(...args){\r\n\t\t\tBaseClass.apply(this, args);\r\n\t\t\tthis.initializeStateable();\r\n\t\t},\r\n\t\tinitializeStateable(){\r\n\t\t\tthis._state = {};\r\n\t\t},\r\n\r\n\t\tgetState(key){\r\n\t\t\tconst state = this._state;\r\n\t\t\tif(!key) return state\r\n\t\t\telse return state[key];\r\n\t\t},\r\n\t\tsetState(key, value, options){\r\n\t\t\t\r\n\t\t\tif(key == null) return;\r\n\r\n\t\t\tif(_.isObject(key)){\r\n\t\t\t\tconst _this = this;\r\n\t\t\t\toptions = value;\r\n\t\t\t\tvalue = key;\r\n\t\t\t\t_(value).each((propertyValue, propertyName) => _this.setState(propertyName, propertyValue, options));\r\n\t\t\t\tthis._triggerStateChange(value, options);\r\n\t\t\t}else{\r\n\t\t\t\tconst state = this.getState();\r\n\t\t\t\tstate[key] = value;\r\n\t\t\t\tthis._triggerStateChange(key, value, options);\r\n\t\t\t}\r\n\t\t},\r\n\t\tclearState(opts = {}){\r\n\t\t\tlet state = this.getState();\r\n\t\t\tlet broadcast = _.extend({}, state);\r\n\t\t\t_(state).each((s,key) => {\r\n\t\t\t\tbroadcast[key] = undefined;\r\n\t\t\t\tdelete state[key];\r\n\t\t\t});\r\n\t\t\tthis._triggerStateChange(broadcast);\r\n\t\t},\r\n\t\t_triggerStateChange(key, value, options){\r\n\r\n\t\t\tif(!_.isFunction(this.triggerMethod)) return;\r\n\r\n\t\t\tif(!_.isObject(key)){\r\n\t\t\t\tthis.triggerMethod('state:' + key, value, options);\r\n\t\t\t\tif(value === true || value === false)\r\n\t\t\t\t\tthis.triggerMethod('state:' + key + ':' + value.toString(), options);\r\n\t\t\t}else{\r\n\t\t\t\t//key is a hash of states\r\n\t\t\t\t//value is options\r\n\t\t\t\toptions = value;\r\n\t\t\t\tvalue = key;\r\n\t\t\t\tthis.triggerMethod('state', value, options);\r\n\t\t\t}\r\n\t\t},\t\t\r\n\t});\r\n\tMixin.Stateable = true;\r\n\r\n\treturn Mixin;\r\n\r\n}\r\n","import _ from 'underscore';\r\nimport mix from '../helpers/mix.js';\r\nimport State from './stateable.js';\r\nimport YatError from '../YatError.js';\r\n\r\nconst STATES = {\r\n\tINITIALIZED: 'initialized',\r\n\tSTARTING: 'starting',\r\n\tRUNNING: 'running',\r\n\tSTOPPING: 'stopping',\r\n\tWAITING: 'waiting',\r\n\tDESTROYED: 'destroyed'\r\n}\r\n\r\nconst STATE_KEY = 'life';\r\n\r\n\r\nfunction getPropertyPromise(context, propertyName){\r\n\tlet rawPromises = context[propertyName] || [];\r\n\tlet promises = [];\r\n\t_(rawPromises).each((promiseArg) => {\r\n\t\tif(_.isFunction(promiseArg))\r\n\t\t\tpromises.push(promiseArg.call(this));\r\n\t\telse\r\n\t\t\tpromises.push(promiseArg);\r\n\t});\r\n\treturn Promise.all(promises);\r\n}\r\n\r\nfunction addPropertyPromise(context, propertyName, promise){\r\n\tcontext[propertyName] || (context[propertyName] = []);\r\n\tlet promises = context[propertyName];\r\n\tpromises.push(promise);\r\n}\r\n\r\n\r\n\r\nexport default (Base) => {\r\n\tlet Middle = mix(Base).with(State);\r\n\tlet Mixin = Middle.extend({\r\n\t\tconstructor(...args){\r\n\t\t\tMiddle.apply(this,args);\r\n\t\t\tthis.initializeStartable();\r\n\t\t},\r\n\r\n\t\tinitializeStartable(){\r\n\t\t\t\r\n\t\t\tif(!(this.constructor.Startable && this.constructor.Stateable)) return;\r\n\r\n\t\t\tthis._registerStartableLifecycleListeners();\r\n\t\t\tthis._setLifeState(STATES.INITIALIZED);\r\n\t\t},\t\r\n\r\n\t\tstart(...args){\r\n\t\t\tlet options = args[0];\r\n\t\t\tlet canNotBeStarted = this._ensureStartableCanBeStarted();\r\n\t\t\tlet resultPromise = null;\r\n\t\t\tlet catchMethod = null;\r\n\r\n\t\t\tif(canNotBeStarted){\r\n\t\t\t\tcatchMethod = () => this.triggerMethod('start:decline',canNotBeStarted);\r\n\t\t\t\tresultPromise = Promise.reject(canNotBeStarted);\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tif(resultPromise == null){\r\n\t\t\t\tlet declineReason = this.isStartNotAllowed(options);\r\n\t\t\t\tif(declineReason) {\r\n\t\t\t\t\tcatchMethod = () => this.triggerMethod('start:decline',declineReason);\r\n\t\t\t\t\tresultPromise = Promise.reject(declineReason);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(resultPromise == null){\r\n\t\t\t\tvar currentState = this._getLifeState();\r\n\t\t\t\tthis._tryMergeStartOptions(options);\t\t\r\n\t\t\t\tthis.triggerMethod('before:start', ...args);\r\n\t\t\t\tresultPromise = this._getStartPromise();\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\treturn resultPromise.then(() => {\r\n\t\t\t\tthis.triggerStart(options)\r\n\t\t\t}, (error) => {\r\n\t\t\t\tthis._setLifeState(currentState);\r\n\t\t\t\tif(catchMethod) catchMethod();\r\n\t\t\t\treturn Promise.reject(error);\r\n\t\t\t});\t\r\n\r\n\t\t},\r\n\r\n\t\ttriggerStart(options) {\r\n\t\t\tthis.triggerMethod('start', options);\r\n\t\t},\r\n\r\n\t\tstop(options){\r\n\t\t\tlet canNotBeStopped = this._ensureStartableCanBeStopped();\r\n\t\t\tif(canNotBeStopped){\r\n\t\t\t\tthis.triggerMethod('stop:decline',canNotBeStopped);\r\n\t\t\t\treturn Promise.reject(canNotBeStopped);\t\t\t\t\r\n\t\t\t}\r\n\t\t\tlet declineReason = this.isStopNotAllowed(options);\r\n\t\t\tif(declineReason){\r\n\t\t\t\tthis.triggerMethod('stop:decline', declineReason);\r\n\t\t\t\treturn Promise.reject(declineReason);\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\t\t\tvar currentState = this._getLifeState();\r\n\r\n\t\t\tthis._tryMergeStopOptions(options);\r\n\t\t\tthis.triggerMethod('before:stop', this, options);\r\n\r\n\t\t\tlet promise = this._getStopPromise();\r\n\r\n\t\t\treturn promise.then(() => {\r\n\t\t\t\tthis.triggerStop(options)\r\n\t\t\t}, () => {\r\n\t\t\t\tthis._setLifeState(currentState);\r\n\t\t\t});\t\r\n\r\n\t\t},\r\n\r\n\t\ttriggerStop(options) {\r\n\t\t\tthis.triggerMethod('stop', options);\r\n\t\t},\r\n\r\n\t\tisStartNotAllowed(){ },\r\n\t\tisStopNotAllowed(){ },\r\n\r\n\t\taddStartPromise(promise){\r\n\t\t\taddPropertyPromise(this,'startPromises', promise);\r\n\t\t},\r\n\r\n\t\taddStopPromise(promise){\r\n\t\t\taddPropertyPromise(this,'stopPromises', promise);\r\n\t\t},\r\n\r\n\t\t//lifecycle state helpers\r\n\t\t_setLifeState(newstate){\r\n\t\t\tthis.setState(STATE_KEY, newstate);\r\n\t\t},\r\n\r\n\t\t_getLifeState(){\r\n\t\t\treturn this.getState(STATE_KEY);\r\n\t\t},\r\n\r\n\t\t_isLifeState(state){\r\n\t\t\treturn this._getLifeState() === state;\r\n\t\t},\r\n\r\n\t\t_isLifeStateIn(...states){\r\n\t\t\treturn _(states).some((state) => this._isLifeState(state));\r\n\t\t},\r\n\r\n\t\t_isInProcess(){\r\n\t\t\treturn this._isLifeStateIn(STATES.STARTING, STATES.STOPPING);\r\n\t\t},\r\n\r\n\r\n\t\t_registerStartableLifecycleListeners(){\r\n\t\t\tthis.on('before:start', () => this._setLifeState(STATES.STARTING));\r\n\t\t\tthis.on('start', () => this._setLifeState(STATES.RUNNING));\r\n\t\t\tthis.on('before:stop',() => this._setLifeState(STATES.STOPPING));\r\n\t\t\tthis.on('stop',() => this._setLifeState(STATES.WAITING));\r\n\t\t\tthis.on('destroy',() => this._setLifeState(STATES.DESTROYED))\r\n\t\t},\t\r\n\r\n\t\t_tryMergeStartOptions(options){\r\n\t\t\tif(!this.mergeOptions) return;\r\n\t\t\tvar mergeoptions = this.getProperty('mergeStartOptions') || [];\r\n\t\t\tthis.mergeOptions(options, mergeoptions);\r\n\t\t},\r\n\r\n\t\t_tryMergeStopOptions(options){\r\n\t\t\tif(!this.mergeOptions) return;\r\n\t\t\tvar mergeoptions = this.getProperty('mergeStopOptions') || [];\r\n\t\t\tthis.mergeOptions(options, mergeoptions);\r\n\t\t},\r\n\r\n\t\t_ensureStartableIsIntact(opts = {throwError: false}) {\r\n\t\t\tlet message = 'Startable has already been destroyed and cannot be used.';\r\n\t\t\tlet error = new YatError({\r\n\t\t\t\tname: 'StartableLifecycleError',\r\n\t\t\t\tmessage: message\r\n\t\t\t});\r\n\t\t\tlet destroyed = this._isLifeState(STATES.DESTROYED);\r\n\t\t\tif(opts.throwError && destroyed){\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t\telse if(destroyed){\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_ensureStartableIsIdle(opts = {throwError:false}){\r\n\t\t\tlet message = 'Startable is not idle. current state: ' + this._getLifeState();\r\n\t\t\tlet error = new YatError({\r\n\t\t\t\tname: 'StartableLifecycleError',\r\n\t\t\t\tmessage: message\r\n\t\t\t});\t\t\t\r\n\t\t\tlet isNotIntact = this._ensureStartableIsIntact(opts);\r\n\t\t\tlet notIdle = this._isInProcess();\r\n\t\t\tif(opts.throwError && notIdle){\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t\telse if(isNotIntact){\r\n\t\t\t\treturn isNotIntact;\r\n\t\t\t}\r\n\t\t\telse if(notIdle){\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_ensureStartableCanBeStarted(opts = {throwError:false}){\r\n\t\t\t\r\n\t\t\tlet message = 'Startable has already been started.';\r\n\t\t\tlet error = new YatError({\r\n\t\t\t\tname: 'StartableLifecycleError',\r\n\t\t\t\tmessage: message\r\n\t\t\t});\t\t\t\r\n\t\t\tlet notIdle = this._ensureStartableIsIdle(opts);\r\n\t\t\tlet allowStartWithoutStop = this.getProperty('allowStartWithoutStop') === true;\r\n\r\n\t\t\tif(!notIdle && allowStartWithoutStop) return;\r\n\r\n\t\t\tlet running = this._isLifeState(STATES.RUNNING);\r\n\t\t\tif(opts.throwError && running){\r\n\t\t\t\tthrow error;\r\n\t\t\t}else if(notIdle){\r\n\t\t\t\treturn notIdle;\r\n\t\t\t}else if(running){\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t\r\n\t\t_ensureStartableCanBeStopped(opts = {throwError:false}){\r\n\t\t\t\r\n\t\t\tlet message = 'Startable should be in `running` state.';\r\n\t\t\tlet error = new YatError({\r\n\t\t\t\tname: 'StartableLifecycleError',\r\n\t\t\t\tmessage: message\r\n\t\t\t});\t\t\t\t\r\n\t\t\tlet notIdle = this._ensureStartableIsIdle(opts);\r\n\r\n\t\t\tlet allowStopWithoutStart = this.getProperty('allowStopWithoutStart') === true;\r\n\t\t\tif(!notIdle && allowStopWithoutStart) return;\r\n\r\n\t\t\tlet running = this._isLifeState(STATES.RUNNING);\r\n\r\n\t\t\tif(opts.throwError && !running){\r\n\t\t\t\tthrow error;\r\n\t\t\t}else if(notIdle){\r\n\t\t\t\treturn notIdle;\r\n\t\t\t}else if(!running){\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\r\n\t\t},\t\r\n\t\t\r\n\t\t_getStartPromise(){\r\n\t\t\treturn Promise.all(this._getStartPromises());\r\n\t\t},\r\n\r\n\t\t_getStartPromises(){\r\n\t\t\tlet promises = [];\r\n\t\t\tpromises.push(this._getStartUserPromise());\r\n\t\t\tpromises.push(this._getStartParentPromise());\r\n\t\t\treturn promises;\r\n\t\t},\r\n\r\n\t\t_getStartUserPromise(){\r\n\t\t\treturn getPropertyPromise(this,'startPromises');\r\n\t\t},\r\n\r\n\t\t_getStartParentPromise(){\r\n\t\t\tvar parent = _.result(this, 'getParent');\r\n\t\t\tif(_.isObject(parent) && _.isFunction(parent._getStartPromise))\r\n\t\t\t\treturn parent._getStartPromise();\r\n\t\t},\r\n\r\n\t\t_getStopPromise(){\r\n\t\t\treturn Promise.all(this._getStopPromises());\r\n\t\t},\r\n\t\t\r\n\t\t_getStopPromises(){\r\n\t\t\tlet promises = [];\r\n\t\t\tpromises.push(this._getStopUserPromise());\r\n\t\t\treturn promises;\r\n\t\t},\r\n\r\n\t\t_getStopUserPromise(){\r\n\t\t\treturn getPropertyPromise(this,'stopPromises');\r\n\t\t},\r\n\r\n\t\t_getStopParentPromise(){\r\n\t\t\tvar parent = _.result(this, 'getParent');\r\n\t\t\tif(_.isObject(parent) && _.isFunction(parent._getStopPromise))\r\n\t\t\t\treturn parent._getStartPromise();\r\n\t\t},\r\n\r\n\r\n\t});\r\n\r\n\tMixin.Startable = true;\r\n\r\n\treturn Mixin;\r\n}\r\n","import _ from 'underscore';\r\n\r\nexport default (Base) => {\r\n\t\r\n\tconst CHILDREN_FIELD = '_children';\r\n\r\n\tlet Mixin = Base.extend({\r\n\t\tconstructor(...args) {\r\n\t\t\tBase.apply(this, args);\r\n\t\t\tthis.initializeChildrenable(...args);\r\n\t\t},\r\n\r\n\t\tinitializeChildrenable(options = {}){\r\n\t\t\tthis._initializeParrent(options);\r\n\t\t\tthis._initializeChildren(options);\r\n\t\t},\r\n\r\n\t\thasChildren(){\r\n\t\t\tlet children = this.getChildren();\r\n\t\t\treturn this[CHILDREN_FIELD].length > 0;\r\n\t\t},\r\n\r\n\t\tgetChildren(opts = {startable:true}){\r\n\t\t\tlet all = this[CHILDREN_FIELD] || [];\r\n\t\t\tif(!opts.startable){\r\n\t\t\t\treturn all;\r\n\t\t\t}else{\r\n\t\t\t\treturn all.filter((c) => !c.getProperty('isStartNotAllowed'));\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\thasParent(){\r\n\t\t\tlet parent = this.getParent();\r\n\t\t\treturn _.isObject(parent);\r\n\t\t},\r\n\r\n\t\tgetParent(){\r\n\t\t\treturn this.getProperty('parent', {deep:false});\r\n\t\t},\r\n\r\n\t\t_initializeChildren(){\r\n\t\t\tlet _children = this.getProperty('children');\r\n\t\t\tlet children = [];\r\n\t\t\t_(_children).each((child) => {\r\n\r\n\t\t\t\tlet childContext = this._normalizeChildContext(child);\r\n\t\t\t\tlet initialized = this._initializeChild(childContext);\r\n\t\t\t\tif(initialized) children.push(initialized);\r\n\r\n\t\t\t});\r\n\t\t\tthis[CHILDREN_FIELD] = children;\r\n\t\t},\r\n\t\t_initializeChild(childContext)\r\n\t\t{\r\n\t\t\tif(childContext == null || !_.isFunction(childContext.Child)) return;\r\n\r\n\t\t\tlet Child = childContext.Child;\r\n\t\t\tlet opts = this._normalizeChildOptions(childContext);\r\n\t\t\treturn this.buildChild(Child, opts);\r\n\t\t},\r\n\r\n\t\t_normalizeChildContext(child){\r\n\t\t\tlet childContext = {};\r\n\r\n\t\t\tif(_.isFunction(child) && child.Childrenable){\r\n\t\t\t\t_.extend(childContext, { Child: child });\r\n\t\t\t}else if(_.isFunction(child)){\r\n\t\t\t\tchildContext = this._normalizeChildContext(child.call(this));\r\n\t\t\t}\r\n\t\t\telse if(_.isObject(child)){\r\n\t\t\t\tchildContext = child;\r\n\t\t\t}\r\n\t\t\treturn childContext;\r\n\t\t},\r\n\r\n\t\t_normalizeChildOptions(options){\r\n\t\t\tlet opts = _.extend({}, options);\r\n\t\t\tif(this.getOption('passToChildren') === true){\r\n\t\t\t\t_.extend(opts, this.options);\r\n\t\t\t}\r\n\t\t\topts.parent = this;\r\n\t\t\tdelete opts.Child;\r\n\t\t\treturn this._buildChildOptions(opts);\r\n\t\t},\r\n\r\n\t\t_buildChildOptions: function(def){\r\n\t\t\treturn _.extend(def, this.getProperty('childOptions'));\r\n\t\t},\r\n\r\n\t\tbuildChild(ChildClass, options){\r\n\t\t\treturn new ChildClass(options);\r\n\t\t},\r\n\r\n\t\t_initializeParrent(opts){\r\n\t\t\tif(this.parent == null && opts.parent != null)\r\n\t\t\t\tthis.parent = opts.parent;\r\n\t\t},\r\n\r\n\t});\r\n\r\n\tMixin.Childrenable = true;\r\n\r\n\treturn Mixin;\r\n}\r\n","import _ from 'underscore';\r\n\r\nlet templateContextStore = [(view) => {\r\n\treturn {\r\n\t\t_v: view,\r\n\t\t_m: view.model || {}\r\n\t}\r\n}];\r\nlet compiledContext = {}; //rethink how it can be used\r\nlet hasChanges = false;\r\n\r\nfunction normalizeValue(value, ...args){\r\n\tif(_.isFunction(value))\r\n\t\treturn value(...args);\r\n\telse if(_.isObject(value))\r\n\t\treturn value;\r\n\telse\r\n\t\treturn {};\r\n}\r\n\r\nconst GlobalTemplateContext = {\r\n\tmix(viewTemplateContext, ...args){\r\n\t\tlet global = this.get(...args);\r\n\t\treturn _.extend(global, viewTemplateContext);\r\n\t},\r\n\tget(...args){\r\n\t\treturn this.compile(...args);\r\n\t},\t\r\n\tadd(...args){\r\n\t\t_(args).each((item) => this.push(item));\r\n\t},\r\n\r\n\tcompile(...args){ \r\n\r\n\t\tif(hasChanges)\r\n\t\t\tcompiledContext = {};\r\n\r\n\t\tlet newcontext = {};\r\n\r\n\t\t_(templateContextStore).each((cntx) => {\r\n\t\t\tif(_.isFunction(cntx))\r\n\t\t\t\t_.extend(newcontext, normalizeValue(cntx, ...args));\r\n\t\t\telse if(hasChanges){\r\n\t\t\t\t_.extend(compiledContext, cntx);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(!hasChanges)\r\n\t\t\t_.extend(newcontext, compiledContext);\r\n\t\t\r\n\t\thasChanges = false;\r\n\t\treturn newcontext;\r\n\t},\r\n\tpop(){\r\n\t\thasChanges = true;\r\n\t\treturn templateContextStore.pop();\r\n\t},\r\n\tshift(){\r\n\t\thasChanges = true;\r\n\t\treturn templateContextStore.shift();\r\n\t},\r\n\tpush(item){ \r\n\t\thasChanges = true;\r\n\t\ttemplateContextStore.push(item); \r\n\t},\r\n\tunshift(item){\r\n\t\thasChanges = true;\r\n\t\ttemplateContextStore.unshift(item);\r\n\t},\r\n\tclear(){\r\n\t\thasChanges = false;\r\n\t\tcompiledContext = {};\r\n\t\ttemplateContextStore = [];\r\n\t},\r\n}\r\n\r\nexport default GlobalTemplateContext;\r\n","import _ from 'underscore';\r\nimport TemplateContext from '../singletons/template-context';\r\n\r\nexport default (Base) => Base.extend({\r\n\tmixinTemplateContext(target = {}) {\r\n\t\t\r\n\t\tvar templateContext = TemplateContext.mix(_.result(this, 'templateContext'), this);\r\n\t\t\r\n\t\treturn _.extend(target, templateContext);\r\n\t},\r\n})\r\n","import GetNameLabel from './get-name-label';\r\nimport GetOptionProperty from './get-option-property';\r\nimport Radioable from './radioable.js';\r\nimport Stateable from './stateable';\r\nimport Startable from './startable';\r\nimport Childrenable from './childrenable';\r\nimport GlobalTemplateContext from './global-template-context';\r\n\r\nexport default {\r\n\tGetNameLabel,\r\n\tGetOptionProperty,\r\n\tRadioable,\r\n\tStateable,\r\n\tStartable,\r\n\tChildrenable,\r\n\tGlobalTemplateContext,\r\n}\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\n\r\n\r\nlet isEqualOrContains = function(node1, node2){\r\n\tif(node1.jquery)\r\n\t\tnode1 = node1.get(0);\r\n\tif(node2.jquery)\r\n\t\tnode2 = node2.get(0);\r\n\t\r\n\treturn node1 === node2 || $.contains(node1, node2);\r\n}\r\n\r\nvar DragAndDropSingleton = Mn.Object.extend({\r\n\tname:'draggable manager',\r\n\tbuildDraggableContext: function ($el, beh, event) {\r\n\t\tvar context = {\r\n\t\t\tid: _.uniqueId('draggable'),\r\n\t\t\tstate:'pending',\r\n\t\t\t$trigger: $el,\r\n\t\t\tscope: beh.getOption(\"scope\") || \"default\",\r\n\t\t\tbehavior: beh,\r\n\t\t\tview: beh.view,\r\n\t\t\tmodel: beh.view.model,\r\n\t\t\tmouse: {\r\n\t\t\t\tstartAt: {x: event.pageX, y: event.pageY}\r\n\t\t\t},\r\n\t\t\t_documentHandlers: {},\r\n\t\t\t_triggerHandlers: {},\r\n\t\t\t_elementHandlers: {},\r\n\t\t}\r\n\r\n\t\tcontext.mouse.getOffset = function (ev) {\r\n\t\t\tvar res = {\r\n\t\t\t\tx: ev.pageX - this.startAt.x,\r\n\t\t\t\ty: ev.pageY - this.startAt.y\r\n\t\t\t}\r\n\t\t\tres.absX = Math.abs(res.x);\r\n\t\t\tres.absY = Math.abs(res.y);\r\n\t\t\tres.distance = Math.round(Math.sqrt(res.absX * res.absX + res.absY * res.absY));\r\n\t\t\treturn res;\r\n\t\t}\r\n\r\n\t\tcontext._documentHandlers.mousemove = _.bind(this.__documentMouseMoveHandler, this, $el, context);\r\n\t\tcontext._documentHandlers.mouseup = _.bind(this.__documentMouseUpHandler, this, $el, context);\r\n\t\tcontext._documentHandlers.mouseleave = _.bind(this.__documentMouseLeaveHandler, this, $el, context);\r\n\t\tcontext._documentHandlers.mouseenter = _.bind(this.__documentMouseEnterHandler, this, $el, context);\r\n\r\n\t\tcontext._elementHandlers.dragover = _.bind(this.__dragOverHandler, this, $el, context);\r\n\r\n\t\treturn context;\r\n\t},\r\n\tsetupDraggable: function ($el, behavior) {\r\n\t\tif (!$el.jquery && !(typeof $el === 'string'))\r\n\t\t\tthrow new Error('first argument should be jquery element or string selector');\r\n\t\tif (!(behavior instanceof Mn.Behavior))\r\n\t\t\tthrow new Error('second argument should be marionette behavior instance');\r\n\r\n\t\tvar $handler = $el.jquery ? $el : behavior.$el;\r\n\t\tvar selector = typeof $el === 'string' ? $el : null;\r\n\t\t\r\n\t\t$handler.on('mousedown', selector, null, _.bind(this.__triggerMouseDownHandler, this, $handler, behavior));\r\n\r\n\t},\r\n\t__triggerMouseDownHandler: function ($el, behavior, ev) {\r\n\t\t\r\n\t\tev.preventDefault();\r\n\t\tev.stopPropagation();\r\n\r\n\t\tvar context = this.buildDraggableContext($el, behavior, ev);\r\n\r\n\t\t$(document).on('mousemove', null, null, context._documentHandlers.mousemove)\r\n\t\t$(document).one('mouseup', null, null, context._documentHandlers.mouseup);\r\n\r\n\t\treturn false;\r\n\t},\r\n\t__documentMouseUpHandler: function ($el, context, ev) {\r\n\t\tif (context.state === 'pending') {\r\n\t\t\t//dragging do not occurs\r\n\t\t} else if (context.state === \"dragging\") {\r\n\t\t\tcontext.state = 'dropped';\r\n\t\t\tcontext.view.triggerMethod('drag:end', context);\r\n\t\t\t$(ev.target).trigger('drag:drop', context);\r\n\t\t}\r\n\r\n\t\tthis._clearAllHandlers($el, context);\r\n\t},\r\n\r\n\t__documentMouseMoveHandler: function ($el, context, ev) {\r\n\t\tif (context.state === 'pending') {\r\n\t\t\tvar startDistance = context.behavior.getOption('startDragOnDistance') || 1;\r\n\t\t\tvar distance = context.mouse.getOffset(ev).distance;\r\n\t\t\tif (distance < startDistance) return;\r\n\r\n\t\t\tthis._initializeDragging($el, context, ev);\r\n\t\t}\r\n\r\n\t\tif (context.state === 'dragging')\r\n\t\t\tcontext.view.triggerMethod('drag', ev, context);\r\n\r\n\t},\r\n\r\n\t_initializeDragging: function ($el, context, ev) {\r\n\t\tif (context.state === 'dragging') return;\r\n\r\n\t\tcontext.state = 'dragging';\r\n\t\tcontext.view.triggerMethod('drag:start', ev, context);\r\n\r\n\t\t$(document).on('mouseleave', '*', null, context._documentHandlers.mouseleave);\r\n\t\t$(document).on('mouseenter', '*', null, context._documentHandlers.mouseenter);\r\n\t},\r\n\r\n\t__documentMouseLeaveHandler: function ($el, context, ev) {\r\n\t\tif(isEqualOrContains(context.behavior.$el, ev.target)) return;\r\n\t\t\r\n\t\t$(ev.target).trigger('drag:leave', context);\r\n\t},\r\n\t__documentMouseEnterHandler: function ($el, context, ev) {\r\n\t\tif (context.$entered) {\r\n\t\t\tcontext.$entered.off('mousemove', null, context._elementHandlers.dragover)\r\n\t\t}\r\n\r\n\t\tif(isEqualOrContains(context.behavior.$el, ev.target)) return;\r\n\r\n\t\tvar event = this._createCustomDomEvent(\"drag:enter\", ev);\r\n\t\tcontext.$entered = $(ev.target);\r\n\t\tcontext.$entered.trigger(event, context);\r\n\r\n\t\tcontext.$entered.on('mousemove', null, null, context._elementHandlers.dragover);\r\n\t},\r\n\r\n\t__dragOverHandler: function ($el, context, ev) {\r\n\t\tvar event = this._createCustomDomEvent(\"drag:over\", ev);\r\n\t\t$(ev.target).trigger(event, context);\r\n\t},\r\n\r\n\t_createCustomDomEvent: function (name, event, merge) {\r\n\t\tif (!merge)\r\n\t\t\tmerge = [\"pageX\", \"pageY\", \"clientX\", \"clientY\", \"offsetX\", \"offsetY\"];\r\n\r\n\t\tvar customEvent = jQuery.Event(name);\r\n\t\t_(merge).each(function (prop) {\r\n\t\t\tcustomEvent[prop] = event[prop];\r\n\t\t});\r\n\r\n\t\treturn customEvent;\r\n\t},\r\n\r\n\t_clearAllHandlers: function ($el, context) {\r\n\t\tlet $doc = $(document);\r\n\t\t_(context._documentHandlers).each(function (handler, name) {\r\n\t\t\t$doc.off(name, null, handler);\r\n\t\t});\r\n\t\t_(context._triggerHandlers).each(function (handler, name) {\r\n\t\t\t$el.off(name, null, handler);\r\n\t\t});\r\n\r\n\t\tif (context.$entered) {\r\n\t\t\tcontext.$entered.off('mousemove', null, context._elementHandlers.dragover)\r\n\t\t}\r\n\r\n\t}\r\n});\r\n\r\nlet dragAndDrop = new DragAndDropSingleton();\r\n\r\nexport default dragAndDrop;\r\n ","import Draggable from './draggable';\r\nimport SortByDrag from './sort-by-drag';\r\nexport default { Draggable, SortByDrag };\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\nimport dragAndDrop from '../singletons/drag-and-drop';\r\n\r\nvar DraggableBehavior = Mn.Behavior.extend({\r\n\r\n\tstartDragOnDistance: 50,\r\n\r\n\tevents: {\r\n\t\t'dragged:over': '_dragOver'\r\n\t},\r\n\t_dragOver(event, part, context){\r\n\t\tevent.stopPropagation();\r\n\t\tevent.preventDefault();\r\n\r\n\t\tif (this.wrongScope(context)) return;\r\n\t\tthis.view.triggerMethod('dragged:over', part, context, this);\r\n\t\tthis.view.triggerMethod('dragged:over:' + part, context, this);\r\n\t},\r\n\tonInitialize() {\r\n\t\tthis._setup();\r\n\t},\r\n\tgetScope () {\r\n\t\treturn this.getOption(\"scope\") || \"default\";\r\n\t},\r\n\twrongScope (context) {\r\n\t\treturn this.getScope() !== context.scope;\r\n\t},\r\n\tonDragStart (ev, context) {\r\n\r\n\t\tvar ghost = this.getOption('ghost') || \"clone\";\r\n\r\n\t\tif (ghost == 'clone') {\r\n\t\t\tvar $g = this.$ghost = this.$el.clone();\r\n\t\t\t$g.css({\r\n\t\t\t\ttop: ev.pageY + 'px',\r\n\t\t\t\tleft: ev.pageX + 'px',\r\n\t\t\t\twidth: this.$el.width(),\r\n\t\t\t});\r\n\r\n\t\t\tif (this.getOption('elementClass'))\r\n\t\t\t\tthis.$el.addClass(this.getOption('elementClass'));\r\n\t\t\tif (this.getOption('ghostClass'))\r\n\t\t\t\t$g.addClass(this.getOption('ghostClass'));\r\n\r\n\t\t\tvar $dragContext = $('body');\r\n\t\t\t// var ghostContext = this.getOption('ghostContext');\r\n\t\t\t// var $dragContext = ghostContext == null ? $('body')\r\n\t\t\t// \t: ghostContext == \"parent\" ? this.$el.parent()\r\n\t\t\t// \t\t: $(ghostContext);\r\n\t\t\t$g.appendTo($dragContext);\r\n\t\t\tcontext.draggingContext = $dragContext;\r\n\t\t}\r\n\r\n\t},\r\n\tonDrag (ev) {\r\n\t\tif (!this.$ghost) return;\r\n\t\t\r\n\t\tthis.$ghost.css({\r\n\t\t\ttop: ev.pageY + 'px',\r\n\t\t\tleft: ev.pageX + 'px',\r\n\t\t});\r\n\t},\r\n\tonDragEnd () {\r\n\r\n\t\tif (this.$ghost)\r\n\t\t\tthis.$ghost.remove();\r\n\r\n\t\tif (this.getOption('elementClass'))\r\n\t\t\tthis.$el.removeClass(this.getOption('elementClass'));\r\n\t},\r\n\r\n\tgetDragTrigger() {\r\n\t\tif (this.getOption('dragTrigger'))\r\n\t\t\treturn this.getOption('dragTrigger');\r\n\r\n\t\treturn this.$el;\r\n\t},\r\n\t_setup() {\r\n\t\tdragAndDrop.setupDraggable(this.getDragTrigger(), this);\r\n\t},\r\n});\r\n\r\nexport default DraggableBehavior;\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\n\r\nlet SortByDrag = Mn.Behavior.extend({\r\n\tevents: {\t\t\t\t\r\n\t\t'drag:drop': '_dragDrop',\r\n\t\t'drag:over': '_dragOver',\r\n\t},\r\n\t_dragOver(ev, context) {\r\n\t\tif (this.wrongScope(context)) return;\r\n\t\tev.stopPropagation();\r\n\t\tev.preventDefault();\r\n\r\n\t\tif (ev.target === this.$el.get(0)) {\r\n\t\t\tthis._insert(context)\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar oldpos = this.dragOverPosition || '';\r\n\t\tvar m = { y: ev.pageY, x: ev.pageX };\r\n\t\tvar $el = this.getChildEl(ev.target);\r\n\t\tvar position = \"top:left\";\r\n\t\tif ($el.length) {\r\n\t\t\tvar i = this._get$elInfo($el);\r\n\t\t\tvar hor = m.x < i.center.x ? 'left' : 'right';\r\n\t\t\tvar ver = m.y < i.center.y ? 'top' : 'bottom';\r\n\t\t\tposition = ver + \":\" + hor;\r\n\t\t} else {\r\n\t\t\tconsole.warn(ev.target);\r\n\t\t}\r\n\r\n\t\tvar dragBy = this.getOption(\"dragBy\") || \"both\";\r\n\t\tif (oldpos != position) {\r\n\t\t\tvar apos = oldpos.split(':');\r\n\r\n\t\t\tvar eventContext = $el;\r\n\t\t\tvar _this = this;\r\n\t\t\tif (dragBy == \"both\") {\r\n\t\t\t\teventContext.trigger('dragged:over', [position, context]);\r\n\t\t\t}\r\n\t\t\tif (apos.indexOf(hor) === -1 && (dragBy === \"horizontal\" || dragBy === \"both\")) {\r\n\t\t\t\teventContext.trigger('dragged:over', [hor, context]);\r\n\t\t\t}\r\n\t\t\tif (apos.indexOf(ver) == -1 && (dragBy === \"vertical\" || dragBy === \"both\")) {\t\t\t\t\t\r\n\t\t\t\teventContext.trigger('dragged:over', [ver, context]);\r\n\t\t\t} \r\n\t\t\tthis.dragOverPosition = position;\r\n\t\t}\r\n\t},\r\n\t_dragDrop(ev, context) {\r\n\t\tif (this.wrongScope(context)) return;\r\n\t\tev.stopPropagation();\r\n\t\tev.preventDefault();\r\n\t\t\r\n\t\tthis._tryInsertBetween(context);\r\n\t\treturn false;\r\n\t},\r\n\t_tryInsertBetween (context) {\r\n\r\n\t\tvar model = context.model;\r\n\t\tvar view = context.view;\r\n\r\n\t\tif (!this.view.collection) {\r\n\t\t\tconsole.warn('collection not defined');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tview.$el.detach();\r\n\t\tview.destroy();\r\n\r\n\r\n\t\tthis.removeModelFromCollection(model);\r\n\t\tthis.insertModelAt(model, context.insertAt);\r\n\r\n\t},\r\n\tremoveModelFromCollection (model) {\r\n\t\tvar col = model.collection;\r\n\t\tif (!col) return;\r\n\t\tcol.remove(model);\r\n\t\tdelete model.collection;\r\n\t\tcol.each(function (m, i) { m.set(\"order\", i) });\r\n\t},\r\n\tinsertModelAt (model, at) {\r\n\t\tvar col = this.view.collection;\r\n\t\tif (!col) return;\r\n\t\t\r\n\t\tif(at <= 0) at = 0;\r\n\r\n\t\tif (at >= col.length) {\r\n\t\t\tmodel.set('order', col.length);\r\n\t\t\tmodel.collection = col;\r\n\t\t\tcol.push(model);\r\n\t\t} else {\r\n\t\t\tmodel.set('order', at);\r\n\t\t\t\r\n\t\t\tif(at > 0)\r\n\t\t\t\tcol.add(model, { at: at });\r\n\t\t\telse\r\n\t\t\t\tcol.unshift(model);\r\n\r\n\t\t\tcol.each(function (exist, ind) {\r\n\t\t\t\texist.set('order', ind);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.view.sort();\r\n\t},\r\n\r\n\tgetScope () {\r\n\t\treturn this.getOption(\"scope\") || \"default\";\r\n\t},\r\n\twrongScope (context) {\r\n\t\treturn this.getScope() !== context.scope;\r\n\t},\r\n\tgetChildEl (el) {\r\n\t\tvar selector = this.getOption('childSelector');\r\n\t\treturn $(el).closest(selector);\r\n\t},\r\n\t_get$elInfo ($el, force) {\r\n\t\tvar i = this._$elInfo = {\r\n\t\t\tsize: { width: $el.width(), height: $el.height() },\t\t\t\t\r\n\t\t\toffset: $el.offset()\r\n\t\t};\r\n\t\ti.center = { x: i.size.width / 2 + i.offset.left, y: i.size.height / 2 + i.offset.top };\r\n\t\treturn i;\r\n\t},\r\n\tgetOrder (beh) {\r\n\t\treturn beh.view.model.getOrder() || 0;\r\n\t},\r\n\t_updateInsert (context, order) {\r\n\t\tcontext.insertAt = order ;\r\n\t},\r\n\r\n\r\n\tonChildviewDraggedOverLeft (context, childBeh) {\r\n\t\tthis._insert(context, \"insertBefore\", childBeh.$el, this.getOrder(childBeh));\r\n\t},\r\n\tonChildviewDraggedOverTop (context, childBeh) {\r\n\t\tthis._insert(context, \"insertBefore\", childBeh.$el, this.getOrder(childBeh));\r\n\t},\r\n\tonChildviewDraggedOverRight (context, childBeh) {\r\n\t\tthis._insert(context, \"insertAfter\", childBeh.$el, this.getOrder(childBeh)+1);\r\n\t},\r\n\tonChildviewDraggedOverBottom (context, childBeh) {\r\n\t\tthis._insert(context, \"insertAfter\", childBeh.$el, this.getOrder(childBeh)+1);\r\n\t},\r\n\t_insert (context, method, $el, order) {\r\n\t\torder || (order = 0);\r\n\r\n\t\tif (method)\r\n\t\t\tcontext.view.$el[method]($el);\r\n\t\telse\r\n\t\t\tcontext.view.$el.appendTo(this.$el);\r\n\r\n\t\tthis._updateInsert(context, order);\r\n\t},\r\n});\r\n\r\n\r\nexport default SortByDrag;\r\n","import Mn from 'backbone.marionette';\r\nimport mixin from './helpers/mix.js';\r\nimport GetOptionProperty from './mixins/get-option-property.js';\r\nimport Radioable from './mixins/radioable.js';\r\n\r\nexport default mixin(Mn.Object).with(GetOptionProperty, Radioable);\r\n","import mix from '../helpers/mix';\r\nimport Stateable from '../mixins/stateable';\r\nimport YatObject from '../YatObject';\r\n\r\nconst IDENTITY_CHANNEL = 'identity';\r\n\r\nlet Base = mix(YatObject).with(Stateable);\r\nlet Identity = Base.extend({\t\r\n\tconstructor(...args){\r\n\t\tBase.apply(this, args);\r\n\t\tthis._initializeYatUser();\r\n\t},\r\n\t_initializeYatUser(){},\t\r\n\tchannelName: IDENTITY_CHANNEL,\r\n\tisAnonym(){\r\n\t\treturn !this.getState('id');\r\n\t},\r\n\tisUser(){\r\n\t\treturn !this.isAnonym();\r\n\t},\r\n\tisMe(id){\r\n\t\treturn id && this.getState('id') === id;\r\n\t},\r\n\tupdate(hash){\r\n\t\tthis.setState(hash);\r\n\t\tthis.trigger('change');\r\n\t},\r\n\tlogIn(hash){\r\n\t\tif(!hash.id) return;\r\n\t\tthis.update(hash);\r\n\t\tthis.trigger('log:in');\r\n\t},\r\n\tlogOut(){\r\n\t\tthis.clearState();\r\n\t\tthis.trigger('change');\r\n\t\tthis.trigger('log:out');\r\n\t}\r\n});\r\nlet identity = new Identity();\r\nexport default identity;\r\n","import dragAndDrop from './drag-and-drop';\r\nimport TemplateContext from './template-context';\r\nimport identity from './identity';\r\nexport default { dragAndDrop, TemplateContext, identity };\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\nimport Bb from 'backbone';\r\nimport mixin from './helpers/mix.js';\r\n\r\nimport GetOptionProperty from './mixins/get-option-property.js';\r\nimport RadioMixin from './mixins/radioable.js';\r\nimport Startable from './mixins/startable.js';\r\nimport Childrenable from './mixins/childrenable.js';\r\n\r\nlet Base = mixin(Mn.Application).with(GetOptionProperty, RadioMixin, Childrenable, Startable);\r\n\r\nexport default Base.extend({\r\n\r\n\tinitRadioOnInitialize: true,\r\n\t_initRegion(opts = {skip:true}){\r\n\t\tif(opts.skip) return;\r\n\t\tvar region = this.getProperty('region');\r\n\t\tthis.region = region;\r\n\t\tBase.prototype._initRegion();\r\n\t}, \r\n\r\n\tgetRegion() {\r\n\t\tif(!this._region) this._initRegion({skip:false});\r\n\t\treturn this._region;\r\n\t},\r\n\r\n\taddPageManager(pageManager){\r\n\t\tthis._pageManagers || (this._pageManagers = []);\r\n\t\tthis._pageManagers.push(pageManager);\r\n\r\n\t\tlet prefix = pageManager.getName();\r\n\t\tif(!prefix){\r\n\t\t\tconsole.warn('pageManager prefix not defined');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.listenTo(pageManager, 'all', (eventName, ...args) => {\r\n\t\t\tlet prefixedEventName = prefix + ':' + eventName;\r\n\t\t\tthis.triggerMethod(prefixedEventName, ...args);\r\n\t\t});\r\n\t\tthis.listenTo(pageManager, 'state:currentPage',(...args) => this.triggerMethod('page:swapped',...args));\r\n\t\t\r\n\t},\r\n\r\n\thasPageManagers(){\r\n\t\treturn this._pageManagers && this._pageManagers.length > 0;\r\n\t},\r\n\r\n\tgetMenuTree(opts = {rebuild:false}){\r\n\t\tif(this._menuTree && !opts.rebuild) return this._menuTree;\r\n\t\tlet managers = this._pageManagers || [];\r\n\t\tlet links = _(managers).chain().map((manager) => manager.getLinks()).flatten().value();\r\n\t\tthis._menuTree = new Bb.Collection(links);\r\n\t\treturn this._menuTree;\r\n\t},\r\n\r\n\tgetPage(key){\r\n\t\tif(!this.hasPageManagers()) return;\r\n\t\treturn _(this._pageManagers).find((mngr) => mngr.getPage(key));\r\n\t},\r\n\r\n});\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\nexport default Mn.AppRouter.extend({},{\r\n\tcreate(hash, context){\r\n\t\tlet appRoutes = {};\r\n\t\tlet controller = {};\r\n\t\tlet _this = this;\r\n\t\t_(hash).each((handlerContext, key) => {\r\n\t\t\tappRoutes[key] = key;\r\n\t\t\tcontroller[key] = (...args) => {\r\n\t\t\t\thandlerContext\r\n\t\t\t\t.action(...args)\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\t_this._catchError(error, context);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn new this({controller, appRoutes});\r\n\t},\r\n\t_catchError(error, context){\r\n\t\tif(!context || context.getProperty('throwChildErrors') === true){\r\n\t\t\tthrow error;\r\n\t\t}else{\r\n\t\t\tlet postfix = error.status ? \":\" + error.status.toString() : '';\r\n\t\t\tlet commonEvent = 'error';\r\n\t\t\tlet event = commonEvent + postfix;\r\n\r\n\t\t\tcontext.triggerMethod(commonEvent, error, this);\r\n\r\n\t\t\tif(event != commonEvent) \r\n\t\t\t\tcontext.triggerMethod(event, error, this);\r\n\r\n\t\t}\r\n\r\n\t}\r\n});\r\n","import Bb from 'backbone';\r\nexport default Bb.Model.extend({});\r\n\r\n","import Model from './model'\r\nexport default Model.extend({\r\n\tdefaults:{\r\n\t\turl: undefined,\r\n\t\tlabel: undefined,\r\n\t\ttarget: '_self',\r\n\t\tlevel: 0,\r\n\t},\r\n\tdestroy(){\r\n\t\tthis.id = null;\r\n\t\tModel.prototype.destroy.apply(this, arguments);\r\n\t}\r\n});\r\n","import _ from 'underscore';\r\nimport App from './YatApp.js';\r\nimport mixin from './helpers/mix';\r\nimport Startable from './mixins/startable';\r\nimport GetNameLabel from './mixins/get-name-label';\r\nimport Router from './YatRouter.js';\r\nimport LinkModel from './models/link';\r\nimport Bb from 'backbone';\r\nimport identity from './singletons/identity';\r\n\r\n/* \r\n\tYatPage\r\n*/\r\n\r\nlet Base = mixin(App).with(GetNameLabel);\r\n\r\nexport default Base.extend({\r\n\r\n\tconstructor(...args){\r\n\t\tBase.apply(this,args);\r\n\t\tthis.initializeYatPage();\r\n\t},\r\n\r\n\tallowStopWithoutStart: true,\r\n\tallowStartWithoutStop: true,\r\n\r\n\tinitializeYatPage(opts){\r\n\t\tthis.mergeOptions(opts, [\"manager\"]);\r\n\t\tthis._initializeModels(opts);\r\n\t\tthis._initializeRoute(opts);\r\n\t\tthis._proxyEvents();\r\n\t\tthis._tryCreateRouter();\r\n\t\tthis._registerIdentityHandlers();\t\t\r\n\t},\r\n\r\n\tgetLayout(opts = {rebuild: false}){\r\n\t\tif(!this._layoutView || opts.rebuild || (this._layoutView && this._layoutView.isDestroyed && this._layoutView.isDestroyed())){\r\n\t\t\tthis.buildLayout();\r\n\t\t}\r\n\t\treturn this._layoutView;\r\n\t},\r\n\r\n\tbuildLayout(){\r\n\t\tlet Layout = this.getProperty('Layout');\r\n\t\tif(Layout == null) return;\r\n\t\tlet opts = _.extend({},this.getProperty('layoutOptions'));\r\n\r\n\t\tif(this.model && !opts.model)\r\n\t\t\t_.extend(opts,{model: this.model});\r\n\r\n\t\tif(this.collection && !opts.collection)\r\n\t\t\t_.extend(opts,{collection: this.collection});\r\n\t\t\t\r\n\t\tlet options = this.buildLayoutOptions(opts);\r\n\t\toptions.page = this;\r\n\t\tthis._layoutView = new Layout(options);\r\n\t\treturn this._layoutView;\r\n\t},\r\n\r\n\tbuildLayoutOptions(rawOptions){\r\n\t\treturn rawOptions;\r\n\t},\r\n\r\n\taddModel(model, opts = {}){\t\t\t\t\r\n\t\tif(!model) return;\r\n\t\tthis.model = model;\r\n\t\tlet fetch = opts.fetch || this.getOption('fetchModelOnAdd');\r\n\t\tif(fetch === undefined){\r\n\t\t\tfetch = this.getProperty('fetchDataOnAdd');\r\n\t\t}\r\n\t\tif(fetch === true){\r\n\t\t\tthis.addStartPromise(model.fetch(opts));\r\n\t\t}\r\n\t},\r\n\r\n\taddCollection(collection, opts = {}){\r\n\t\tif(!collection) return;\r\n\t\tthis.collection = collection;\r\n\t\tlet fetch = opts.fetch || this.getOption('fetchCollectionOnAdd');\r\n\t\tif(fetch === undefined){\r\n\t\t\tfetch = this.getProperty('fetchDataOnAdd');\r\n\t\t}\r\n\t\tif(fetch === true){\r\n\t\t\tthis.addStartPromise(collection.fetch(opts));\r\n\t\t}\r\n\t},\r\n\r\n\tgetRouteHash(){\r\n\r\n\t\tlet hashes = [{},this._routeHandler].concat(this.getChildren({startable:false}).map((children) => children.getRouteHash()))\r\n\t\treturn _.extend(...hashes);\r\n\r\n\t},\r\n\r\n\thasRouteHash(){\r\n\t\treturn _.isObject(this.getRouteHash())\r\n\t},\r\n\r\n\tgetLinkModel(level = 0){\r\n\t\tif(!this._canHaveLinkModel()) return;\t\t\r\n\t\tif(this._linkModel) return this._linkModel;\r\n\r\n\t\tlet url = this.getRoute();\r\n\t\tlet label = this.getLabel();\r\n\t\tlet children = this._getSublinks(level);\r\n\t\tthis._linkModel = new LinkModel({ url, label, level, children });\r\n\r\n\t\treturn this._linkModel;\r\n\t},\r\n\t_canHaveLinkModel(){\r\n\t\treturn !((this.getProperty('skipMenu') === true) || (!!this.getProperty('isStartNotAllowed')));\r\n\t},\r\n\t_destroyLinkModel(){\r\n\t\tif(!this._linkModel) return;\r\n\t\tthis._linkModel.destroy();\r\n\t\tdelete this._linkModel;\r\n\t},\r\n\r\n\tgetParentLinkModel(){\r\n\t\tlet parent = this.getParent();\r\n\t\tif(!parent || !parent.getLinkModel) return;\r\n\t\tlet model = parent.getLinkModel();\r\n\t\treturn model;\r\n\t},\r\n\r\n\tgetNeighbourLinks(){\r\n\t\tlet link = this.getLinkModel();\r\n\t\tif(link && link.collection) return link.collection;\r\n\t},\r\n\r\n\tgetChildrenLinks(){\r\n\t\tlet model = this.getLinkModel();\r\n\t\tif(!model) return;\r\n\t\treturn model.get('children');\r\n\t},\r\n\r\n\t_getSublinks(level){\r\n\t\tlet children = this.getChildren();\r\n\t\tif(!children || !children.length) return;\r\n\t\tlet sublinks = _(children).chain()\r\n\t\t\t.filter((child) => child.getProperty(\"skipMenu\") !== true)\r\n\t\t\t.map((child) => child.getLinkModel(level + 1))\r\n\t\t\t.value();\r\n\t\tif(!sublinks.length) return;\r\n\t\tlet col = new Bb.Collection(sublinks);\r\n\t\treturn col;\r\n\t},\r\n\r\n\t_initializeModels(opts = {}){\r\n\t\tthis.addModel(opts.model, opts);\r\n\t\tthis.addCollection(opts.collection, opts);\r\n\t},\r\n\r\n\t_initializeRoute(){\r\n\t\tlet route = this.getRoute({asPattern:true});\r\n\t\tif(route == null) return;\r\n\t\tlet page = this;\r\n\t\tthis._routeHandler = {\r\n\t\t\t[route]:{context: page, action: (...args) => page.start(...args) }\r\n\t\t};\r\n\t},\r\n\r\n\tgetRoute(opts = {asPattern:false}){\r\n\t\tlet relative = this.getProperty('relativeRoute');\r\n\t\tlet route = this.getProperty('route');\r\n\t\tlet parent = this.getParent();\r\n\t\tif(route == null) return;\r\n\t\t\r\n\t\tlet result = route;\r\n\r\n\t\tif(relative && parent && parent.getRoute){\r\n\t\t\tlet parentRoute = parent.getRoute();\r\n\t\t\tresult = parentRoute + '/' + route;\t\t\t\r\n\t\t}\r\n\r\n\t\treturn this._normalizeRoute(result, opts);\r\n\t},\r\n\t_normalizeRoute(route, opts){\t\t\r\n\t\troute = route.replace(/\\/+/gmi,'/').replace(/^\\//,'');\r\n\t\tif(opts.asPattern){\r\n\t\t\treturn route;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tlet res = route.replace(/\\(\\/\\)/gmi,'/').replace(/\\/+/gmi,'/');\r\n\t\t\treturn res;\r\n\t\t}\r\n\t},\r\n\t_tryCreateRouter(){\r\n\t\tlet create = this.getProperty('createRouter') === true;\r\n\t\tif(create){\r\n\t\t\tthis.router = this._createAppRouter();\r\n\t\t}\r\n\t},\r\n\r\n\t_createAppRouter(){\r\n\t\tlet hash = this.getRouteHash();\r\n\t\tif(!_.size(hash)) return;\r\n\t\treturn new Router(hash);\r\n\t},\r\n\r\n\t_proxyEvents(){\r\n\t\tlet proxyContexts = this._getProxyContexts();\r\n\t\tthis._proxyEventsTo(proxyContexts);\r\n\t},\r\n\t_getProxyContexts(){\r\n\t\tlet rdy = [];\r\n\t\tlet manager = this.getProperty('manager');\r\n\t\tif(manager){\r\n\t\t\trdy.push({context:manager})\r\n\t\t}\r\n\t\tlet radio = this.getChannel();\r\n\t\tif(radio){\r\n\t\t\tlet allowed = this.getProperty('proxyEventsToRadio');\r\n\t\t\trdy.push({context:radio, allowed });\r\n\t\t}\r\n\t\treturn rdy;\r\n\t},\r\n\t_proxyEventsTo(contexts){\r\n\t\tlet all = [];\r\n\t\tlet eventsHash = {};\r\n\r\n\t\t_(contexts).each((context) => {\r\n\t\t\tlet events = [];\r\n\t\t\tif(!context.allowed)\r\n\t\t\t\tall.push(context.context);\r\n\t\t\telse {\r\n\t\t\t\t_(context.allowed).each(function(allowed){\r\n\t\t\t\t\teventsHash[allowed] || (eventsHash[allowed] = []);\r\n\t\t\t\t\teventsHash[allowed].push(context.context)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tlet page = this;\r\n\t\tpage.on('all', (eventName, ...args) => {\r\n\t\t\tlet contexts = (eventName in eventsHash) ? eventsHash[eventName] : all;\r\n\t\t\tlet triggerArguments = [page].concat(args);\r\n\t\t\t_(contexts).each((context) => context.triggerMethod(`page:${eventName}`, ...triggerArguments))\r\n\t\t});\r\n\r\n\t},\r\n\r\n\t_buildChildOptions: function(def){\r\n\t\tlet add = {};\r\n\t\tlet manager = this.getProperty('manager');\r\n\t\tif(manager) add.manager = manager;\r\n\t\treturn _.extend(def, this.getProperty('childOptions'), add);\r\n\t},\t\r\n\r\n\t_registerIdentityHandlers(){\r\n\t\tthis.listenTo(identity, 'change', (...args) => {\r\n\t\t\tthis._destroyLinkModel();\r\n\t\t\tthis.triggerMethod('identity:change', ...args);\r\n\t\t});\r\n\t}\r\n\r\n});\r\n","import _ from 'underscore';\r\nimport App from './YatApp';\r\nimport GetNameLabel from './mixins/get-name-label';\r\nimport Router from './YatRouter';\r\nimport mixin from './helpers/mix';\r\nimport identity from './singletons/identity';\r\nimport YatError from './YatError';\r\n\r\nlet Base = mixin(App).with(GetNameLabel);\r\n\r\nlet YatPageManager = Base.extend({\r\n\tconstructor(...args){\r\n\t\tBase.apply(this, args);\r\n\t\tthis._initializeYatPageManager(...args);\r\n\t},\r\n\tthrowChildErrors:true,\r\n\tcreateRouter(){\r\n\t\tlet children = this.getChildren({startable:false});\r\n\t\tlet hash = {};\r\n\t\t_(children).each(function(page){\r\n\t\t\tif(_.isFunction(page.getRouteHash)){\r\n\t\t\t\t_.extend(hash, page.getRouteHash());\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._routesHash = hash;\t\t\r\n\t\tthis.setRouter(Router.create(hash, this));\r\n\t},\r\n\tsetRouter(router){\r\n\t\tthis.router = router;\r\n\t},\r\n\tgetRouter(){\r\n\t\treturn this.router;\r\n\t},\r\n\tgetLinks(){\r\n\t\tlet children = this.getChildren();\r\n\t\tif(!children) return;\r\n\t\treturn _(children).chain()\t\t\t\r\n\t\t\t.map((child) => child.getLinkModel())\r\n\t\t\t.filter((child) => !!child)\r\n\t\t\t.value();\r\n\t},\r\n\texecute(route){\r\n\t\tlet page = this.getPage(route);\r\n\t\tif(!!page) \r\n\t\t\tpage.start({text: error.message});\r\n\t\telse if(route === '*NotFound')\r\n\t\t\tthrow new YatError.NotFound('*NotFound handler is missing');\r\n\t\telse\r\n\t\t\tthis.execute('*NotFound');\r\n\t},\r\n\tnavigate(url, opts = {trigger:true}){\r\n\r\n\t\tlet router = this.getRouter();\r\n\t\tif(router)\r\n\t\t\trouter.navigate(url, opts);\r\n\t\telse\r\n\t\t\tconsole.warn('router not found');\r\n\t},\r\n\r\n\tgetPage(key){\r\n\r\n\t\tlet found = _(this._routesHash)\r\n\t\t\t.find((pageContext, route) => {\r\n\t\t\t\tif(route === key) return true;\r\n\t\t\t\tif(pageContext.context.getName() === key) return true;\r\n\t\t\t});\r\n\t\treturn found && found.context;\r\n\r\n\t},\r\n\r\n\r\n\tnavigateToRoot(){\r\n\t\tlet current = this.getState('currentPage');\r\n\t\tlet rootUrl = this.getProperty('rootUrl');\r\n\t\tif(!rootUrl){\r\n\t\t\tlet children = this.getChildren();\r\n\t\t\tif(children && children.length) {\r\n\t\t\t\tlet root = children.find((child) => child != current);\r\n\t\t\t\trootUrl = root && root.getRoute()\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(rootUrl != null)\r\n\t\t\tthis.navigate(rootUrl);\r\n\t\telse\r\n\t\t\tconsole.warn('root page not found');\r\n\t},\r\n\r\n\t_initializeYatPageManager(opts = {}){\r\n\t\tthis.mergeOptions(opts, ['id','name','label']);\r\n\t\tthis._registerPageHandlers(opts);\r\n\t\tthis._registerIdentityHandlers();\r\n\t\tthis.createRouter();\r\n\t},\r\n\r\n\t_buildChildOptions: function(def){\r\n\t\treturn _.extend(def, this.getProperty('childOptions'), {\r\n\t\t\tmanager: this\r\n\t\t});\r\n\t},\t\r\n\r\n\t_registerPageHandlers(){\r\n\t\tthis.on('page:before:start', this._pageBeforeStart);\r\n\t\tthis.on('page:start', this._pageStart);\r\n\t\tthis.on('page:start:decline', this._pageDecline);\r\n\t},\r\n\r\n\t_pageBeforeStart(page){\r\n\t\tlet current = this.getState('currentPage');\r\n\t\tif(current && current != page){\r\n\t\t\tcurrent.stop();\r\n\t\t}\r\n\t},\r\n\r\n\t_pageStart(page){\r\n\t\tthis.setState('currentPage', page);\r\n\t},\r\n\r\n\t_pageDecline(...args){\r\n\t\t//console.log(\"decline\", args)\r\n\t},\r\n\r\n\t_registerIdentityHandlers(){\r\n\t\tthis.listenTo(identity, 'change', (...args) => {\r\n\t\t\tthis.triggerMethod('identity:change', ...args);\r\n\t\t\tthis._moveToRootIfCurrentPageNotAllowed();\r\n\t\t});\r\n\t},\r\n\t\r\n\t_moveToRootIfCurrentPageNotAllowed(){\r\n\t\tlet current = this.getState('currentPage');\r\n\t\tif(!current || !current.isStartNotAllowed()) return;\r\n\t\t\r\n\t\tthis.navigateToRoot();\r\n\t}\r\n\r\n});\r\n\r\nexport default YatPageManager;\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\nimport mix from './helpers/mix';\r\nimport GlobalTemplateContext from './mixins/global-template-context';\r\nexport default mix(Mn.View).with(GlobalTemplateContext);\r\n","import _ from 'underscore';\r\nimport Mn from 'backbone.marionette';\r\nimport mix from './helpers/mix';\r\nimport GlobalTemplateContext from './mixins/global-template-context';\r\nexport default mix(Mn.NextCollectionView).with(GlobalTemplateContext);\r\n","import {version} from '../package.json';\nimport Functions from './functions/functions';\nimport Helpers from './helpers/Helpers';\nimport Mixins from './mixins/Mixins';\nimport Behaviors from './behaviors/behaviors';\nimport Singletons from './singletons/singletons';\nimport TemplateContext from './singletons/template-context';\nimport identity from './singletons/identity';\nimport YatObject from './YatObject';\nimport YatError from './YatError';\nimport YatApp from './YatApp';\nimport YatRouter from './YatRouter';\nimport YatPage from './YatPage';\nimport YatPageManager from './YatPageManager';\nimport YatView from './YatView';\nimport YatCollectionView from './YatCollectionView';\n\nconst marionetteYat = {\n\tVERSION: version,\n\tFunctions: Functions,\n\tHelpers: Helpers,\n\tMixins: Mixins,\n\tBehaviors: Behaviors,\n\tSingletons: Singletons,\n\tTemplateContext: TemplateContext,\n\tidentity: identity,\n\tObject: YatObject,\n\tError: YatError,\n\tApp: YatApp,\n\tPage : YatPage,\n\tRouter: YatRouter,\n\tPageManager: YatPageManager,\n\tView: YatView,\n\tCollectionView: YatCollectionView\n};\n\nexport default marionetteYat;\n"]}