/**
* @license
* Marionette.Yat extension for Backbone.Marionette
* Yet Another Toolkit
* ----------------------------------
* v0.0.5
*
* Distributed under MIT license
* author: dimtabu
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("underscore"),require("backbone"),require("backbone.marionette")):"function"==typeof define&&define.amd?define(["underscore","backbone","backbone.marionette"],e):t.MarionetteYat=e(t._,t.Backbone,t.Marionette)}(this,function(t,e,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var i=[e.Model,e.Collection,e.View,e.Router,n.Object];function r(e){var n=t.isFunction(e),r=t(i).some(function(t){return e===t||e.prototype instanceof t});return n&&r}function o(e){var i=null;if(t.isFunction(e))i=e;else{if(!t.isObject(e)||null===e)throw new Error("argument should be an object or class definition");var r=function(){};r.extend=n.extend,i=r.extend(e)}i.extend||((i=n.extend.call(e,{})).extend=n.extend);return{with:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.reduce(n,function(e,n){return function(e,n){if(t.isFunction(n))return n(e);if(t.isObject(n))return e.extend(n);throw new YatError("Mixin fail, argument should be an object hash or mixin function")}(e,n)},i)},class:i}}var a={isKnownCtor:r,mix:o};function s(t){return t.extend({getName:function(){return this.getProperty("name")||this.id||this.cid},getLabel:function(){return this.getProperty("label")||this.getName()}})}var u=function(e){return e.extend({getProperty:function(t,e){return this._getOptionOrProperty(this,t,e,this.getOption)},getOption:function(t,e){return this._getOptionOrProperty(this.getProperty("options",{deep:!1}),t,e,this.getProperty)},_getOptionOrProperty:function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments[3];if(void 0!==i.deep||(i.deep=!0),void 0!==i.force||(i.force=!0),i.args||(i.args=[]),null!=n&&null!=e){var a=e[n];if(void 0===a&&i.deep&&t.isFunction(o)){var s=t.extend({},i,{deep:!1,force:!1});a=o.call(this,n,s)}return t.isFunction(a)&&i.force&&!r(a)&&(a=a.apply(this,i.args||[])),void 0===a?i.default:a}}})},l=function(t){return t.extend({constructor:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(this,n);var r=!(!0===this.getProperty("initRadioOnInitialize"));this._initRadio({skip:r})},getChannel:function(){return this._channel||this._initRadio({skip:!1}),this._channel},_initRadio:function(){if(1!=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){if(!this.getProperty("channelName")){var t=this.getProperty("channel");t&&(this.channelName=t.channelName)}n.Object.prototype._initRadio.call(this)}},radioRequest:function(){var t=this.getChannel();t&&t.request.apply(t,arguments)},radioTrigger:function(){var t=this.getChannel();t&&t.trigger.apply(t,arguments)}})},h=function(e){var n=e.extend({constructor:function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];e.apply(this,n),this.initializeStateable()},initializeStateable:function(){this._state={}},getState:function(t){var e=this._state;return t?e[t]:e},setState:function(e,n,i){if(null!=e)if(t.isObject(e)){var r=this;i=n,t(n=e).each(function(t,e){return r.setState(e,t,i)}),this._triggerStateChange(n,i)}else{this.getState()[e]=n,this._triggerStateChange(e,n,i)}},clearState:function(){var e=this.getState(),n=t.extend({},e);t(e).each(function(t,i){n[i]=void 0,delete e[i]}),this._triggerStateChange(n)},_triggerStateChange:function(e,n,i){t.isFunction(this.triggerMethod)&&(t.isObject(e)?(i=n,n=e,this.triggerMethod("state",n,i)):(this.triggerMethod("state:"+e,n,i),!0!==n&&!1!==n||this.triggerMethod("state:"+e+":"+n.toString(),i)))}});return n.Stateable=!0,n},g=n.Error.extend({},{Http400:function(t){return this.Http(400,t)},Http401:function(t){return this.Http(401,t)},Http403:function(t){return this.Http(403,t)},Http404:function(t){return this.Http(404,t)},Http500:function(t){return this.Http(500,t)},Http:function(t,e){var n=new this({message:e,name:"HttpError"});return n.status=t,n},NotFound:function(t){return this.Http404(t)},NotAuthorized:function(t){return this.Http401(t)},Forbidden:function(t){return this.Http403(t)}}),c="initialized",d="starting",f="running",p="stopping",v="waiting",_="destroyed";function m(e,n){var i=this,r=e[n]||[],o=[];return t(r).each(function(e){t.isFunction(e)?o.push(e.call(i)):o.push(e)}),Promise.all(o)}function y(t,e,n){t[e]||(t[e]=[]);t[e].push(n)}var S=function(e){var n=o(e).with(h),i=n.extend({constructor:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];n.apply(this,e),this.initializeStartable()},initializeStartable:function(){this.constructor.Startable&&this.constructor.Stateable&&(this._registerStartableLifecycleListeners(),this._setLifeState(c))},start:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=n[0],o=this._ensureStartableCanBeStarted(),a=null,s=null;if(o&&(s=function(){return t.triggerMethod("start:decline",o)},a=Promise.reject(o)),null==a){var u=this.isStartNotAllowed(r);u&&(s=function(){return t.triggerMethod("start:decline",u)},a=Promise.reject(u))}if(null==a){var l=this._getLifeState();this._tryMergeStartOptions(r),this.triggerMethod.apply(this,["before:start"].concat(n)),a=this._getStartPromise()}return a.then(function(){t.triggerStart(r)},function(e){return t._setLifeState(l),s&&s(),Promise.reject(e)})},triggerStart:function(t){this.triggerMethod("start",t)},stop:function(t){var e=this,n=this._ensureStartableCanBeStopped();if(n)return this.triggerMethod("stop:decline",n),Promise.reject(n);var i=this.isStopNotAllowed(t);if(i)return this.triggerMethod("stop:decline",i),Promise.reject(i);var r=this._getLifeState();this._tryMergeStopOptions(t),this.triggerMethod("before:stop",this,t);return this._getStopPromise().then(function(){e.triggerStop(t)},function(){e._setLifeState(r)})},triggerStop:function(t){this.triggerMethod("stop",t)},isStartNotAllowed:function(){},isStopNotAllowed:function(){},addStartPromise:function(t){y(this,"startPromises",t)},addStopPromise:function(t){y(this,"stopPromises",t)},_setLifeState:function(t){this.setState("life",t)},_getLifeState:function(){return this.getState("life")},_isLifeState:function(t){return this._getLifeState()===t},_isLifeStateIn:function(){for(var e=this,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return t(i).some(function(t){return e._isLifeState(t)})},_isInProcess:function(){return this._isLifeStateIn(d,p)},_registerStartableLifecycleListeners:function(){var t=this;this.on("before:start",function(){return t._setLifeState(d)}),this.on("start",function(){return t._setLifeState(f)}),this.on("before:stop",function(){return t._setLifeState(p)}),this.on("stop",function(){return t._setLifeState(v)}),this.on("destroy",function(){return t._setLifeState(_)})},_tryMergeStartOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStartOptions")||[];this.mergeOptions(t,e)}},_tryMergeStopOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStopOptions")||[];this.mergeOptions(t,e)}},_ensureStartableIsIntact:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new g({name:"StartableLifecycleError",message:"Startable has already been destroyed and cannot be used."}),n=this._isLifeState(_);if(t.throwError&&n)throw e;if(n)return e},_ensureStartableIsIdle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e="Startable is not idle. current state: "+this._getLifeState(),n=new g({name:"StartableLifecycleError",message:e}),i=this._ensureStartableIsIntact(t),r=this._isInProcess();if(t.throwError&&r)throw n;return i||(r?n:void 0)},_ensureStartableCanBeStarted:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new g({name:"StartableLifecycleError",message:"Startable has already been started."}),n=this._ensureStartableIsIdle(t),i=!0===this.getProperty("allowStartWithoutStop");if(n||!i){var r=this._isLifeState(f);if(t.throwError&&r)throw e;return n||(r?e:void 0)}},_ensureStartableCanBeStopped:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new g({name:"StartableLifecycleError",message:"Startable should be in `running` state."}),n=this._ensureStartableIsIdle(t),i=!0===this.getProperty("allowStopWithoutStart");if(n||!i){var r=this._isLifeState(f);if(t.throwError&&!r)throw e;return n||(r?void 0:e)}},_getStartPromise:function(){return Promise.all(this._getStartPromises())},_getStartPromises:function(){var t=[];return t.push(this._getStartUserPromise()),t.push(this._getStartParentPromise()),t},_getStartUserPromise:function(){return m(this,"startPromises")},_getStartParentPromise:function(){var e=t.result(this,"getParent");if(t.isObject(e)&&t.isFunction(e._getStartPromise))return e._getStartPromise()},_getStopPromise:function(){return Promise.all(this._getStopPromises())},_getStopPromises:function(){var t=[];return t.push(this._getStopUserPromise()),t},_getStopUserPromise:function(){return m(this,"stopPromises")},_getStopParentPromise:function(){var e=t.result(this,"getParent");if(t.isObject(e)&&t.isFunction(e._getStopPromise))return e._getStartPromise()}});return i.Startable=!0,i},b=function(e){var n="_children",i=e.extend({constructor:function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];e.apply(this,n),this.initializeChildrenable.apply(this,n)},initializeChildrenable:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._initializeParrent(t),this._initializeChildren(t)},hasChildren:function(){this.getChildren();return this[n].length>0},getChildren:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startable:!0},e=this[n]||[];return t.startable?e.filter(function(t){return!t.getProperty("isStartNotAllowed")}):e},hasParent:function(){var e=this.getParent();return t.isObject(e)},getParent:function(){return this.getProperty("parent",{deep:!1})},_initializeChildren:function(){var e=this,i=this.getProperty("children"),r=[];t(i).each(function(t){var n=e._normalizeChildContext(t),i=e._initializeChild(n);i&&r.push(i)}),this[n]=r},_initializeChild:function(e){if(null!=e&&t.isFunction(e.Child)){var n=e.Child,i=this._normalizeChildOptions(e);return this.buildChild(n,i)}},_normalizeChildContext:function(e){var n={};return t.isFunction(e)&&e.Childrenable?t.extend(n,{Child:e}):t.isFunction(e)?n=this._normalizeChildContext(e.call(this)):t.isObject(e)&&(n=e),n},_normalizeChildOptions:function(e){var n=t.extend({},e);return!0===this.getOption("passToChildren")&&t.extend(n,this.options),n.parent=this,delete n.Child,this._buildChildOptions(n)},_buildChildOptions:function(e){return t.extend(e,this.getProperty("childOptions"))},buildChild:function(t,e){return new t(e)},_initializeParrent:function(t){null==this.parent&&null!=t.parent&&(this.parent=t.parent)}});return i.Childrenable=!0,i},P={GetNameLabel:s,GetOptionProperty:u,Radioable:l,Stateable:h,Startable:S,Childrenable:b},w=new(n.Object.extend({name:"draggable manager",buildDraggableContext:function(e,n,i){var r={id:t.uniqueId("draggable"),state:"pending",$trigger:e,scope:n.getOption("scope")||"default",behavior:n,view:n.view,model:n.view.model,mouse:{startAt:{x:i.pageX,y:i.pageY}},_documentHandlers:{},_triggerHandlers:{},_elementHandlers:{}};return r.mouse.getOffset=function(t){var e={x:t.pageX-this.startAt.x,y:t.pageY-this.startAt.y};return e.absX=Math.abs(e.x),e.absY=Math.abs(e.y),e.distance=Math.round(Math.sqrt(e.absX*e.absX+e.absY*e.absY)),e},r._documentHandlers.mousemove=t.bind(this.__documentMouseMoveHandler,this,e,r),r._documentHandlers.mouseup=t.bind(this.__documentMouseUpHandler,this,e,r),r._documentHandlers.mouseleave=t.bind(this.__documentMouseLeaveHandler,this,e,r),r._documentHandlers.mouseenter=t.bind(this.__documentMouseEnterHandler,this,e,r),r._elementHandlers.dragover=t.bind(this.__dragOverHandler,this,e,r),r},setupDraggable:function(e,i){if(!e.jquery&&"string"!=typeof e)throw new Error("first argument should be jquery element or string selector");if(!(i instanceof n.Behavior))throw new Error("second argument should be marionette behavior instance");var r=e.jquery?e:i.$el,o="string"==typeof e?e:null;r.on("mousedown",o,null,t.bind(this.__triggerMouseDownHandler,this,r,i))},__triggerMouseDownHandler:function(t,e,n){n.preventDefault(),n.stopPropagation();var i=this.buildDraggableContext(t,e,n);return $(document).on("mousemove",null,null,i._documentHandlers.mousemove),$(document).one("mouseup",null,null,i._documentHandlers.mouseup),!1},__documentMouseUpHandler:function(t,e,n){"pending"===e.state||"dragging"===e.state&&(e.state="dropped",e.view.triggerMethod("drag:end",e),$(n.target).trigger("drag:drop",e)),this._clearAllHandlers(t,e)},__documentMouseMoveHandler:function(t,e,n){if("pending"===e.state){var i=e.behavior.getOption("startDragOnDistance")||1;if(e.mouse.getOffset(n).distance<i)return;this._initializeDragging(t,e,n)}"dragging"===e.state&&e.view.triggerMethod("drag",n,e)},_initializeDragging:function(t,e,n){"dragging"!==e.state&&(e.state="dragging",e.view.triggerMethod("drag:start",n,e),$(document).on("mouseleave","*",null,e._documentHandlers.mouseleave),$(document).on("mouseenter","*",null,e._documentHandlers.mouseenter))},__documentMouseLeaveHandler:function(t,e,n){$.contains(e.view.$el.get(0),n.target)||$(n.target).trigger("drag:leave",e)},__documentMouseEnterHandler:function(t,e,n){e.$entered&&e.$entered.off("mousemove",null,e._elementHandlers.dragover);if(!$.contains(e.view.$el.get(0),n.target)){var i=this._createCustomDomEvent("drag:enter",n);e.$entered=$(n.target),e.$entered.trigger(i,e),e.$entered.on("mousemove",null,null,e._elementHandlers.dragover)}},__dragOverHandler:function(t,e,n){var i=this._createCustomDomEvent("drag:over",n);$(n.target).trigger(i,e)},_createCustomDomEvent:function(e,n,i){i||(i=["pageX","pageY","clientX","clientY","offsetX","offsetY"]);var r=jQuery.Event(e);return t(i).each(function(t){r[t]=n[t]}),r},_clearAllHandlers:function(e,n){$doc=$(document),t(n._documentHandlers).each(function(t,e){$doc.off(e,null,t)}),t(n._triggerHandlers).each(function(t,n){e.off(n,null,t)}),n.$entered&&n.$entered.off("mousemove",null,n._elementHandlers.dragover)}})),M=(n.Behavior.extend({events:{"dragged:over":function(t,e,n){t.stopPropagation(),t.preventDefault(),this.wrongScope(n)||(this.view.triggerMethod("dragged:over",e,n,this),this.view.triggerMethod("dragged:over:"+e,n,this))}},onInitialize:function(){this._setup()},getScope:function(){return this.getOption("scope")||"default"},wrongScope:function(t){return this.getScope()!==t.scope},onDragStart:function(t,e){if("clone"==(this.getOption("ghost")||"clone")){var n=this.$ghost=this.$el.clone();n.css({top:t.pageY+"px",left:t.pageX+"px",width:this.$el.width()}),this.getOption("elementClass")&&this.$el.addClass(this.getOption("elementClass")),this.getOption("ghostClass")&&n.addClass(this.getOption("ghostClass"));var i=$("body"),r=this.getOption("ghostContext");i=null==r?$("body"):"parent"==r?this.$el.parent():$(r);n.appendTo(i)}},onDrag:function(t){this.$ghost&&this.$ghost.css({top:t.pageY+"px",left:t.pageX+"px"})},onDragEnd:function(){this.$ghost&&this.$ghost.remove(),this.getOption("elementClass")&&this.$el.removeClass(this.getOption("elementClass"))},startDragOnDistance:50,getDragTrigger:function(){return this.getOption("dragTrigger")?this.getOption("dragTrigger"):this.$el},_setup:function(){w.setupDraggable(this.getDragTrigger(),this)}}),void 0),O=(n.Behavior.extend({events:{"drag:drop":"_dragDrop","drag:over":"_dragOver"},_dragOver:function(t,e){if(!M.wrongScope(e))if(t.stopPropagation(),t.preventDefault(),t.target!==M.$el.get(0)){var n=M.dragOverPosition||"",i=t.pageY,r=t.pageX,o=M.getChildEl(t.target),a="top:left";if(o.length){var s=M._get$elInfo(o),u=r<s.center.x?"left":"right",l=i<s.center.y?"top":"bottom";a=l+":"+u}else console.warn(t.target);var h=M.getOption("dragBy")||"both";if(n!=a){var g=n.split(":"),c=o;"both"==h&&c.trigger("dragged:over",[a,e]),-1!==g.indexOf(u)||"horizontal"!==h&&"both"!==h||c.trigger("dragged:over",[u,e]),-1!=g.indexOf(l)||"vertical"!==h&&"both"!==h||c.trigger("dragged:over",[l,e]),M.dragOverPosition=a}}else M._insert(e)},_dragDrop:function(t,e){if(!this.wrongScope(e))return t.stopPropagation(),t.preventDefault(),this._tryInsertBetween(e),!1},_tryInsertBetween:function(t){var e=t.model,n=t.view;this.view.collection?(n.$el.detach(),n.destroy(),this.removeModelFromCollection(e),this.insertModelAt(e,t.insertAt)):console.warn("collection not defined")},removeModelFromCollection:function(t){var e=t.collection;e&&(e.remove(t),delete t.collection,e.each(function(t,e){t.set("order",e)}))},insertModelAt:function(t,e){var n=this.view.collection;n&&(e<=0&&(e=0),e>=n.length?(t.set("order",n.length),t.collection=n,n.push(t)):(t.set("order",e),t.collection=n,e>0?n.add(t,{at:e}):n.unshift(t),n.each(function(t,e){t.set("order",e)})),this.view.sort())},getScope:function(){return this.getOption("scope")||"default"},wrongScope:function(t){return this.getScope()!==t.scope},getChildEl:function(t){var e=this.getOption("childSelector");return $(t).closest(e)},_get$elInfo:function(t,e){var n=this._$elInfo={size:{width:t.width(),height:t.height()},offset:t.offset()};return n.center={x:n.size.width/2+n.offset.left,y:n.size.height/2+n.offset.top},n},getOrder:function(t){return t.view.model.getOrder()||0},_updateInsert:function(t,e){t.insertAt=e},onChildviewDraggedOverLeft:function(t,e){this._insert(t,"insertBefore",e)},onChildviewDraggedOverTop:function(t,e){this._insert(t,"insertBefore",e)},onChildviewDraggedOverRight:function(t,e){this._insert(t,"insertAfter",e)},onChildviewDraggedOverBottom:function(t,e){this._insert(t,"insertAfter",e)},_insert:function(t,e,n){var i=n?this.getOrder(n):0;e?t.view.$el[e](n.$el):t.view.$el.appendTo(this.$el),this._updateInsert(t,i)}}),o(n.Object).with(u,l)),C=o(O).with(h),x=new(C.extend({constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];C.apply(this,e),this._initializeYatUser()},_initializeYatUser:function(){},channelName:"identity",isAnonym:function(){return!this.getState("id")},isUser:function(){return!this.isAnonym()},isMe:function(t){return t&&this.getState("id")===t},update:function(t){this.setState(t),this.trigger("change")},logIn:function(t){t.id&&(this.update(t),this.trigger("log:in"))},logOut:function(){this.clearState(),this.trigger("change"),this.trigger("log:out")}})),H=o(n.Application).with(u,l,b,S),L=H.extend({initRadioOnInitialize:!0,_initRegion:function(){if(!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){var t=this.getProperty("region");this.region=t,H.prototype._initRegion()}},getRegion:function(){return this._region||this._initRegion({skip:!1}),this._region},addPageManager:function(t){var e=this;this._pageManagers||(this._pageManagers=[]),this._pageManagers.push(t);var n=t.getName();n?this.listenTo(t,"all",function(t){for(var i=arguments.length,r=Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];var a=n+":"+t;e.triggerMethod.apply(e,[a].concat(r))}):console.warn("pageManager prefix not defined")},hasPageManagers:function(){return this._pageManagers&&this._pageManagers.length>0},getMenuTree:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};if(this._menuTree&&!n.rebuild)return this._menuTree;var i=this._pageManagers||[],r=t(i).chain().map(function(t){return t.getLinks()}).flatten().value();return this._menuTree=new e.Collection(r),this._menuTree},getPage:function(e){if(this.hasPageManagers())return t(this._pageManagers).find(function(t){return t.getPage(e)})}}),R=n.AppRouter.extend({},{create:function(e,n){var i=this,r={},o={};return t(e).each(function(t,e){r[e]=e,o[e]=function(){t.action.apply(t,arguments).catch(function(t){var e="error"+(t.status&&":"+t.status);"error"!=e&&n.triggerMethod(e,t,i),n.triggerMethod("error",t,i)})}}),new this({controller:o,appRoutes:r})}}),A=e.Model.extend({}),z=A.extend({defaults:{url:void 0,label:void 0,target:"_self",level:0},destroy:function(){this.id=null,A.prototype.destroy.apply(this,arguments)}});function k(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var D=o(L).with(s),E=D.extend({constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];D.apply(this,e),this.initializeYatPage()},allowStopWithoutStart:!0,allowStartWithoutStop:!0,initializeYatPage:function(t){this.mergeOptions(t,["manager"]),this._initializeModels(t),this._initializeRoute(t),this._proxyEvents(),this._tryCreateRouter(),this._registerIdentityHandlers()},getLayout:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};return(!this._layoutView||t.rebuild||this._layoutView&&this._layoutView.isDestroyed&&this._layoutView.isDestroyed())&&this.buildLayout(),this._layoutView},buildLayout:function(){var e=this.getProperty("Layout");if(null!=e){var n=t.extend({},this.getProperty("layoutOptions"));this.model&&!n.model&&t.extend(n,{model:this.model}),this.collection&&!n.collection&&t.extend(n,{collection:this.collection});var i=this.buildLayoutOptions(n);return i.page=this,this._layoutView=new e(i),this._layoutView}},buildLayoutOptions:function(t){return t},addModel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.model=t;var n=e.fetch||this.getOption("fetchModelOnAdd");void 0===n&&(n=this.getProperty("fetchDataOnAdd")),!0===n&&this.addStartPromise(t.fetch(e))}},addCollection:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.collection=t;var n=e.fetch||this.getOption("fetchCollectionOnAdd");void 0===n&&(n=this.getProperty("fetchDataOnAdd")),!0===n&&this.addStartPromise(t.fetch(e))}},getRouteHash:function(){var e=[{},this._routeHandler].concat(this.getChildren({startable:!1}).map(function(t){return t.getRouteHash()}));return t.extend.apply(t,k(e))},hasRouteHash:function(){return t.isObject(this.getRouteHash())},getLinkModel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._canHaveLinkModel()){if(this._linkModel)return this._linkModel;var e=this.getRoute(),n=this.getLabel(),i=this._getSublinks(t);return this._linkModel=new z({url:e,label:n,level:t,children:i}),this._linkModel}},_canHaveLinkModel:function(){return!(!0===this.getProperty("skipMenu")||this.getProperty("isStartNotAllowed"))},_destroyLinkModel:function(){this._linkModel&&(this._linkModel.destroy(),delete this._linkModel)},getParentLinkModel:function(){var t=this.getParent();if(t&&t.getLinkModel){return t.getLinkModel()}},getNeighbourLinks:function(){var t=this.getLinkModel();if(t&&t.collection)return t.collection},_getSublinks:function(n){var i=this.getChildren();if(i&&i.length){var r=t(i).chain().filter(function(t){return!0!==t.getProperty("skipMenu")}).map(function(t){return t.getLinkModel(n+1)}).value();if(r.length){return new e.Collection(r)}}},_initializeModels:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addModel(t.model,t),this.addCollection(t.collection,t)},_initializeRoute:function(){var t=this.getRoute({asPattern:!0});if(null!=t){var e=this;this._routeHandler=(n={},i=t,r={context:e,action:function(){return e.start.apply(e,arguments)}},i in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,n);var n,i,r}},getRoute:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{asPattern:!1},e=this.getProperty("relativeRoute"),n=this.getProperty("route"),i=this.getParent();if(null!=n){var r=n;if(e&&i&&i.getRoute){r=i.getRoute()+"/"+n}return this._normalizeRoute(r,t)}},_normalizeRoute:function(t,e){if(t=t.replace(/\/+/gim,"/").replace(/^\//,""),e.asPattern)return t;return t.replace(/\(\/\)/gim,"/").replace(/\/+/gim,"/")},_tryCreateRouter:function(){!0===this.getProperty("createRouter")&&(this.router=this._createAppRouter())},_createAppRouter:function(){var e=this.getRouteHash();if(t.size(e))return new R(e)},_proxyEvents:function(){var t=this._getProxyContexts();this._proxyEventsTo(t)},_getProxyContexts:function(){var t=[],e=this.getProperty("manager");e&&t.push({context:e});var n=this.getChannel();if(n){var i=this.getProperty("proxyEventsToRadio");t.push({context:n,allowed:i})}return t},_proxyEventsTo:function(e){var n=[],i={};t(e).each(function(e){e.allowed?t(e.allowed).each(function(t){i[t]||(i[t]=[]),i[t].push(e.context)}):n.push(e.context)});var r=this;r.on("all",function(e){for(var o=arguments.length,a=Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];var u=e in i?i[e]:n,l=[r].concat(a);t(u).each(function(t){return t.triggerMethod.apply(t,["page:"+e].concat(k(l)))})})},_buildChildOptions:function(e){var n={},i=this.getProperty("manager");return i&&(n.manager=i),t.extend(e,this.getProperty("childOptions"),n)},_registerIdentityHandlers:function(){var t=this;this.listenTo(x,"change",function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t._destroyLinkModel(),t.triggerMethod.apply(t,["identity:change"].concat(n))})}}),I=o(L).with(s),j=I.extend({constructor:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];I.apply(this,e),this._initializeYatPageManager.apply(this,e)},createRouter:function(){var e=this.getChildren({startable:!1}),n={};t(e).each(function(e){t.isFunction(e.getRouteHash)&&t.extend(n,e.getRouteHash())}),this._routesHash=n,this.setRouter(R.create(n,this))},setRouter:function(t){this.router=t},getRouter:function(){return this.router},getLinks:function(){var e=this.getChildren();if(e)return t(e).chain().map(function(t){return t.getLinkModel()}).filter(function(t){return!!t}).value()},navigate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{trigger:!0},n=this.getRouter();n?n.navigate(t,e):console.warn("router not found")},getPage:function(e){var n=t(this._routesHash).find(function(t,n){return n===e||(t.context.getName()===e||void 0)});return n&&n.context},navigateToRoot:function(){var t=this.getState("currentPage"),e=this.getProperty("rootUrl");if(!e){var n=this.getChildren();if(n&&n.length){var i=n.find(function(e){return e!=t});e=i&&i.getRoute()}}null!=e?this.navigate(e):console.warn("root page not found")},_initializeYatPageManager:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.mergeOptions(t,["id","name","label"]),this._registerPageHandlers(t),this._registerIdentityHandlers(),this.createRouter()},_buildChildOptions:function(e){return t.extend(e,this.getProperty("childOptions"),{manager:this})},_registerPageHandlers:function(){this.on("page:before:start",this._pageBeforeStart),this.on("page:start",this._pageStart),this.on("page:decline",this._pageDecline)},_pageBeforeStart:function(t){var e=this.getState("currentPage");e&&e!=t&&e.stop()},_pageStart:function(t){this.setState("currentPage",t)},_pageDecline:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];console.log("decline",e)},_registerIdentityHandlers:function(){var t=this;this.listenTo(x,"change",function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t.triggerMethod.apply(t,["identity:change"].concat(n)),t._moveToRootIfCurrentPageNotAllowed()})},_moveToRootIfCurrentPageNotAllowed:function(){var t=this.getState("currentPage");t&&t.isStartNotAllowed()&&this.navigateToRoot()}});return{VERSION:"0.0.5",Helpers:a,Mixins:P,Object:O,Error:g,App:L,Page:E,Router:R,PageManager:j,identity:x}}),this&&this.Marionette&&(this.Marionette.Yat=this.MarionetteYat);
//# sourceMappingURL=marionette.yat.min.js.map