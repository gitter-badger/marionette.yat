/**
* @license
* Marionette.Yat extension for Backbone.Marionette
* Yet Another Toolkit
* ----------------------------------
* v0.0.9
*
* Distributed under MIT license
* author: dimtabu
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("backbone"),require("backbone.marionette"),require("underscore")):"function"==typeof define&&define.amd?define(["backbone","backbone.marionette","underscore"],e):t.MarionetteYat=e(t.Backbone,t.Marionette,t._)}(this,function(t,e,r){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,r=r&&r.hasOwnProperty("default")?r.default:r;var n=function(r){return r instanceof t.Model?r:r instanceof e.View?r.model:void 0},i=function(e){return e instanceof t.View?e:void 0},o=function(t,e,r){return"function"==typeof r&&(t=r.call(t,n(t),i(t)),e=r.call(e,n(e),i(e))),t<e?-1:t>e?1:0},a={view:{compareAB:o,viewComparator:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=[],a=0;return e.length>=2?o.apply(null,e):(1===e.length&&e[0]instanceof Array&&(i=e[0]),r(i).every(function(t){return 0===(a=o.apply(null,t))}),a)}}},s=[t.Model,t.Collection,t.View,t.Router,e.Object];function u(t){var e=r.isFunction(t),n=r(s).some(function(e){return t===e||t.prototype instanceof e});return e&&n}var l=e.Error.extend({},{Http400:function(t){return this.Http(400,t)},Http401:function(t){return this.Http(401,t)},Http403:function(t){return this.Http(403,t)},Http404:function(t){return this.Http(404,t)},Http500:function(t){return this.Http(500,t)},Http:function(t,e){var r=new this({message:e,name:"HttpError"});return r.status=t,r},HttpRedirect:function(t){return this.Http(301,t)},NotFound:function(t){return this.Http404(t)},NotAuthorized:function(t){return this.Http401(t)},Forbidden:function(t){return this.Http403(t)}});function h(t){var n=null;if(r.isFunction(t))n=t;else{if(!r.isObject(t)||null===t)throw new Error("argument should be an object or class definition");var i=function(){};i.extend=e.extend,n=i.extend(t)}n.extend||((n=e.extend.call(t,{})).extend=e.extend);return{with:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return r.reduce(e,function(t,e){return function(t,e){if(r.isFunction(e))return e(t);if(r.isObject(e))return t.extend(e);throw new l("Mixin fail, argument should be an object hash or mixin function")}(t,e)},n)},class:n}}var g={isKnownCtor:u,mix:h};function c(t){return t.extend({getName:function(){return this.getProperty("name")||this.id||this.cid},getLabel:function(){return this.getProperty("label")||this.getName()}})}var d=function(t){return t.extend({getProperty:function(t,e){return this._getOptionOrProperty(this,t,e,this.getOption)},getOption:function(t,e){return this._getOptionOrProperty(this.getProperty("options",{deep:!1}),t,e,this.getProperty)},_getOptionOrProperty:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments[3];if(void 0!==n.deep||(n.deep=!0),void 0!==n.force||(n.force=!0),n.args||(n.args=[]),null!=e&&null!=t){var o=t[e];if(void 0===o&&n.deep&&r.isFunction(i)){var a=r.extend({},n,{deep:!1,force:!1});o=i.call(this,e,a)}return r.isFunction(o)&&n.force&&!u(o)&&(o=o.apply(this,n.args||[])),void 0===o?n.default:o}}})},f=function(t){return t.extend({constructor:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];t.apply(this,r);var i=!(!0===this.getProperty("initRadioOnInitialize"));this._initRadio({skip:i})},getChannel:function(){return this._channel||this._initRadio({skip:!1}),this._channel},_initRadio:function(){if(1!=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){if(!this.getProperty("channelName")){var t=this.getProperty("channel");t&&(this.channelName=t.channelName)}e.Object.prototype._initRadio.call(this)}},radioRequest:function(){var t=this.getChannel();t&&t.request.apply(t,arguments)},radioTrigger:function(){var t=this.getChannel();t&&t.trigger.apply(t,arguments)}})},p=function(t){var e=t.extend({constructor:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];t.apply(this,r),this.initializeStateable()},initializeStateable:function(){this._state={}},getState:function(t){var e=this._state;return t?e[t]:e},setState:function(t,e,n){if(null!=t)if(r.isObject(t)){var i=this;n=e,r(e=t).each(function(t,e){return i.setState(e,t,n)}),this._triggerStateChange(e,n)}else{this.getState()[t]=e,this._triggerStateChange(t,e,n)}},clearState:function(){var t=this.getState(),e=r.extend({},t);r(t).each(function(r,n){e[n]=void 0,delete t[n]}),this._triggerStateChange(e)},_triggerStateChange:function(t,e,n){r.isFunction(this.triggerMethod)&&(r.isObject(t)?(n=e,e=t,this.triggerMethod("state",e,n)):(this.triggerMethod("state:"+t,e,n),!0!==e&&!1!==e||this.triggerMethod("state:"+t+":"+e.toString(),n)))}});return e.Stateable=!0,e},v="initialized",_="starting",m="running",y="stopping",S="waiting",b="destroyed";function P(t,e){var n=this,i=t[e]||[],o=[];return r(i).each(function(t){r.isFunction(t)?o.push(t.call(n)):o.push(t)}),Promise.all(o)}function w(t,e,r){t[e]||(t[e]=[]);t[e].push(r)}var O=function(t){var e=h(t).with(p),n=e.extend({constructor:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];e.apply(this,r),this.initializeStartable()},initializeStartable:function(){this.constructor.Startable&&this.constructor.Stateable&&(this._registerStartableLifecycleListeners(),this._setLifeState(v))},start:function(){for(var t=this,e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r[0],o=this._ensureStartableCanBeStarted(),a=null,s=null;if(o&&(s=function(){return t.triggerMethod("start:decline",o)},a=Promise.reject(o)),null==a){var u=this.isStartNotAllowed(i);u&&(s=function(){return t.triggerMethod("start:decline",u)},a=Promise.reject(u))}if(null==a){var l=this._getLifeState();this._tryMergeStartOptions(i),this.triggerMethod.apply(this,["before:start"].concat(r)),a=this._getStartPromise()}return a.then(function(){t.triggerStart(i)},function(e){return t._setLifeState(l),s&&s(),Promise.reject(e)})},triggerStart:function(t){this.triggerMethod("start",t)},stop:function(t){var e=this,r=this._ensureStartableCanBeStopped();if(r)return this.triggerMethod("stop:decline",r),Promise.reject(r);var n=this.isStopNotAllowed(t);if(n)return this.triggerMethod("stop:decline",n),Promise.reject(n);var i=this._getLifeState();this._tryMergeStopOptions(t),this.triggerMethod("before:stop",this,t);return this._getStopPromise().then(function(){e.triggerStop(t)},function(){e._setLifeState(i)})},triggerStop:function(t){this.triggerMethod("stop",t)},isStartNotAllowed:function(){},isStopNotAllowed:function(){},addStartPromise:function(t){w(this,"startPromises",t)},addStopPromise:function(t){w(this,"stopPromises",t)},_setLifeState:function(t){this.setState("life",t)},_getLifeState:function(){return this.getState("life")},_isLifeState:function(t){return this._getLifeState()===t},_isLifeStateIn:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return r(n).some(function(e){return t._isLifeState(e)})},_isInProcess:function(){return this._isLifeStateIn(_,y)},_registerStartableLifecycleListeners:function(){var t=this;this.on("before:start",function(){return t._setLifeState(_)}),this.on("start",function(){return t._setLifeState(m)}),this.on("before:stop",function(){return t._setLifeState(y)}),this.on("stop",function(){return t._setLifeState(S)}),this.on("destroy",function(){return t._setLifeState(b)})},_tryMergeStartOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStartOptions")||[];this.mergeOptions(t,e)}},_tryMergeStopOptions:function(t){if(this.mergeOptions){var e=this.getProperty("mergeStopOptions")||[];this.mergeOptions(t,e)}},_ensureStartableIsIntact:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new l({name:"StartableLifecycleError",message:"Startable has already been destroyed and cannot be used."}),r=this._isLifeState(b);if(t.throwError&&r)throw e;if(r)return e},_ensureStartableIsIdle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e="Startable is not idle. current state: "+this._getLifeState(),r=new l({name:"StartableLifecycleError",message:e}),n=this._ensureStartableIsIntact(t),i=this._isInProcess();if(t.throwError&&i)throw r;return n||(i?r:void 0)},_ensureStartableCanBeStarted:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new l({name:"StartableLifecycleError",message:"Startable has already been started."}),r=this._ensureStartableIsIdle(t),n=!0===this.getProperty("allowStartWithoutStop");if(r||!n){var i=this._isLifeState(m);if(t.throwError&&i)throw e;return r||(i?e:void 0)}},_ensureStartableCanBeStopped:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throwError:!1},e=new l({name:"StartableLifecycleError",message:"Startable should be in `running` state."}),r=this._ensureStartableIsIdle(t),n=!0===this.getProperty("allowStopWithoutStart");if(r||!n){var i=this._isLifeState(m);if(t.throwError&&!i)throw e;return r||(i?void 0:e)}},_getStartPromise:function(){return Promise.all(this._getStartPromises())},_getStartPromises:function(){var t=[];return t.push(this._getStartUserPromise()),t.push(this._getStartParentPromise()),t},_getStartUserPromise:function(){return P(this,"startPromises")},_getStartParentPromise:function(){var t=r.result(this,"getParent");if(r.isObject(t)&&r.isFunction(t._getStartPromise))return t._getStartPromise()},_getStopPromise:function(){return Promise.all(this._getStopPromises())},_getStopPromises:function(){var t=[];return t.push(this._getStopUserPromise()),t},_getStopUserPromise:function(){return P(this,"stopPromises")},_getStopParentPromise:function(){var t=r.result(this,"getParent");if(r.isObject(t)&&r.isFunction(t._getStopPromise))return t._getStartPromise()}});return n.Startable=!0,n},M=function(t){var e="_children",n=t.extend({constructor:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];t.apply(this,r),this.initializeChildrenable.apply(this,r)},initializeChildrenable:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._initializeParrent(t),this._initializeChildren(t)},hasChildren:function(){this.getChildren();return this[e].length>0},getChildren:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startable:!0},r=this[e]||[];return t.startable?r.filter(function(t){return!t.getProperty("isStartNotAllowed")}):r},hasParent:function(){var t=this.getParent();return r.isObject(t)},getParent:function(){return this.getProperty("parent",{deep:!1})},_initializeChildren:function(){var t=this,n=this.getProperty("children"),i=[];r(n).each(function(e){var r=t._normalizeChildContext(e),n=t._initializeChild(r);n&&i.push(n)}),this[e]=i},_initializeChild:function(t){if(null!=t&&r.isFunction(t.Child)){var e=t.Child,n=this._normalizeChildOptions(t);return this.buildChild(e,n)}},_normalizeChildContext:function(t){var e={};return r.isFunction(t)&&t.Childrenable?r.extend(e,{Child:t}):r.isFunction(t)?e=this._normalizeChildContext(t.call(this)):r.isObject(t)&&(e=t),e},_normalizeChildOptions:function(t){var e=r.extend({},t);return!0===this.getOption("passToChildren")&&r.extend(e,this.options),e.parent=this,delete e.Child,this._buildChildOptions(e)},_buildChildOptions:function(t){return r.extend(t,this.getProperty("childOptions"))},buildChild:function(t,e){return new t(e)},_initializeParrent:function(t){null==this.parent&&null!=t.parent&&(this.parent=t.parent)}});return n.Childrenable=!0,n},C={GetNameLabel:c,GetOptionProperty:d,Radioable:f,Stateable:p,Startable:O,Childrenable:M},x=function(t,e){return t.jquery&&(t=t.get(0)),e.jquery&&(e=e.get(0)),t===e||$.contains(t,e)},H=new(e.Object.extend({name:"draggable manager",buildDraggableContext:function(t,e,n){var i={id:r.uniqueId("draggable"),state:"pending",$trigger:t,scope:e.getOption("scope")||"default",behavior:e,view:e.view,model:e.view.model,mouse:{startAt:{x:n.pageX,y:n.pageY}},_documentHandlers:{},_triggerHandlers:{},_elementHandlers:{}};return i.mouse.getOffset=function(t){var e={x:t.pageX-this.startAt.x,y:t.pageY-this.startAt.y};return e.absX=Math.abs(e.x),e.absY=Math.abs(e.y),e.distance=Math.round(Math.sqrt(e.absX*e.absX+e.absY*e.absY)),e},i._documentHandlers.mousemove=r.bind(this.__documentMouseMoveHandler,this,t,i),i._documentHandlers.mouseup=r.bind(this.__documentMouseUpHandler,this,t,i),i._documentHandlers.mouseleave=r.bind(this.__documentMouseLeaveHandler,this,t,i),i._documentHandlers.mouseenter=r.bind(this.__documentMouseEnterHandler,this,t,i),i._elementHandlers.dragover=r.bind(this.__dragOverHandler,this,t,i),i},setupDraggable:function(t,n){if(!t.jquery&&"string"!=typeof t)throw new Error("first argument should be jquery element or string selector");if(!(n instanceof e.Behavior))throw new Error("second argument should be marionette behavior instance");var i=t.jquery?t:n.$el,o="string"==typeof t?t:null;i.on("mousedown",o,null,r.bind(this.__triggerMouseDownHandler,this,i,n))},__triggerMouseDownHandler:function(t,e,r){r.preventDefault(),r.stopPropagation();var n=this.buildDraggableContext(t,e,r);return $(document).on("mousemove",null,null,n._documentHandlers.mousemove),$(document).one("mouseup",null,null,n._documentHandlers.mouseup),!1},__documentMouseUpHandler:function(t,e,r){"pending"===e.state||"dragging"===e.state&&(e.state="dropped",e.view.triggerMethod("drag:end",e),$(r.target).trigger("drag:drop",e)),this._clearAllHandlers(t,e)},__documentMouseMoveHandler:function(t,e,r){if("pending"===e.state){var n=e.behavior.getOption("startDragOnDistance")||1;if(e.mouse.getOffset(r).distance<n)return;this._initializeDragging(t,e,r)}"dragging"===e.state&&e.view.triggerMethod("drag",r,e)},_initializeDragging:function(t,e,r){"dragging"!==e.state&&(e.state="dragging",e.view.triggerMethod("drag:start",r,e),$(document).on("mouseleave","*",null,e._documentHandlers.mouseleave),$(document).on("mouseenter","*",null,e._documentHandlers.mouseenter))},__documentMouseLeaveHandler:function(t,e,r){x(e.behavior.$el,r.target)||$(r.target).trigger("drag:leave",e)},__documentMouseEnterHandler:function(t,e,r){if(e.$entered&&e.$entered.off("mousemove",null,e._elementHandlers.dragover),!x(e.behavior.$el,r.target)){var n=this._createCustomDomEvent("drag:enter",r);e.$entered=$(r.target),e.$entered.trigger(n,e),e.$entered.on("mousemove",null,null,e._elementHandlers.dragover)}},__dragOverHandler:function(t,e,r){var n=this._createCustomDomEvent("drag:over",r);$(r.target).trigger(n,e)},_createCustomDomEvent:function(t,e,n){n||(n=["pageX","pageY","clientX","clientY","offsetX","offsetY"]);var i=jQuery.Event(t);return r(n).each(function(t){i[t]=e[t]}),i},_clearAllHandlers:function(t,e){var n=$(document);r(e._documentHandlers).each(function(t,e){n.off(e,null,t)}),r(e._triggerHandlers).each(function(e,r){t.off(r,null,e)}),e.$entered&&e.$entered.off("mousemove",null,e._elementHandlers.dragover)}})),L={Draggable:e.Behavior.extend({startDragOnDistance:50,events:{"dragged:over":"_dragOver"},_dragOver:function(t,e,r){t.stopPropagation(),t.preventDefault(),this.wrongScope(r)||(this.view.triggerMethod("dragged:over",e,r,this),this.view.triggerMethod("dragged:over:"+e,r,this))},onInitialize:function(){this._setup()},getScope:function(){return this.getOption("scope")||"default"},wrongScope:function(t){return this.getScope()!==t.scope},onDragStart:function(t,e){if("clone"==(this.getOption("ghost")||"clone")){var r=this.$ghost=this.$el.clone();r.css({top:t.pageY+"px",left:t.pageX+"px",width:this.$el.width()}),this.getOption("elementClass")&&this.$el.addClass(this.getOption("elementClass")),this.getOption("ghostClass")&&r.addClass(this.getOption("ghostClass"));var n=$("body");r.appendTo(n),e.draggingContext=n}},onDrag:function(t){this.$ghost&&this.$ghost.css({top:t.pageY+"px",left:t.pageX+"px"})},onDragEnd:function(){this.$ghost&&this.$ghost.remove(),this.getOption("elementClass")&&this.$el.removeClass(this.getOption("elementClass"))},getDragTrigger:function(){return this.getOption("dragTrigger")?this.getOption("dragTrigger"):this.$el},_setup:function(){H.setupDraggable(this.getDragTrigger(),this)}}),SortByDrag:e.Behavior.extend({events:{"drag:drop":"_dragDrop","drag:over":"_dragOver"},_dragOver:function(t,e){if(!this.wrongScope(e))if(t.stopPropagation(),t.preventDefault(),t.target!==this.$el.get(0)){var r=this.dragOverPosition||"",n=t.pageY,i=t.pageX,o=this.getChildEl(t.target),a="top:left";if(o.length){var s=this._get$elInfo(o),u=i<s.center.x?"left":"right",l=n<s.center.y?"top":"bottom";a=l+":"+u}else console.warn(t.target);var h=this.getOption("dragBy")||"both";if(r!=a){var g=r.split(":"),c=o;"both"==h&&c.trigger("dragged:over",[a,e]),-1!==g.indexOf(u)||"horizontal"!==h&&"both"!==h||c.trigger("dragged:over",[u,e]),-1!=g.indexOf(l)||"vertical"!==h&&"both"!==h||c.trigger("dragged:over",[l,e]),this.dragOverPosition=a}}else this._insert(e)},_dragDrop:function(t,e){if(!this.wrongScope(e))return t.stopPropagation(),t.preventDefault(),this._tryInsertBetween(e),!1},_tryInsertBetween:function(t){var e=t.model,r=t.view;this.view.collection?(r.$el.detach(),r.destroy(),this.removeModelFromCollection(e),this.insertModelAt(e,t.insertAt)):console.warn("collection not defined")},removeModelFromCollection:function(t){var e=t.collection;e&&(e.remove(t),delete t.collection,e.each(function(t,e){t.set("order",e)}))},insertModelAt:function(t,e){var r=this.view.collection;r&&(e<=0&&(e=0),e>=r.length?(t.set("order",r.length),t.collection=r,r.push(t)):(t.set("order",e),e>0?r.add(t,{at:e}):r.unshift(t),r.each(function(t,e){t.set("order",e)})),this.view.sort())},getScope:function(){return this.getOption("scope")||"default"},wrongScope:function(t){return this.getScope()!==t.scope},getChildEl:function(t){var e=this.getOption("childSelector");return $(t).closest(e)},_get$elInfo:function(t,e){var r=this._$elInfo={size:{width:t.width(),height:t.height()},offset:t.offset()};return r.center={x:r.size.width/2+r.offset.left,y:r.size.height/2+r.offset.top},r},getOrder:function(t){return t.view.model.getOrder()||0},_updateInsert:function(t,e){t.insertAt=e},onChildviewDraggedOverLeft:function(t,e){this._insert(t,"insertBefore",e.$el,this.getOrder(e))},onChildviewDraggedOverTop:function(t,e){this._insert(t,"insertBefore",e.$el,this.getOrder(e))},onChildviewDraggedOverRight:function(t,e){this._insert(t,"insertAfter",e.$el,this.getOrder(e)+1)},onChildviewDraggedOverBottom:function(t,e){this._insert(t,"insertAfter",e.$el,this.getOrder(e)+1)},_insert:function(t,e,r,n){n||(n=0),e?t.view.$el[e](r):t.view.$el.appendTo(this.$el),this._updateInsert(t,n)}})},A={dragAndDrop:H},R=h(e.Object).with(d,f),z=h(R).with(p),k=new(z.extend({constructor:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];z.apply(this,e),this._initializeYatUser()},_initializeYatUser:function(){},channelName:"identity",isAnonym:function(){return!this.getState("id")},isUser:function(){return!this.isAnonym()},isMe:function(t){return t&&this.getState("id")===t},update:function(t){this.setState(t),this.trigger("change")},logIn:function(t){t.id&&(this.update(t),this.trigger("log:in"))},logOut:function(){this.clearState(),this.trigger("change"),this.trigger("log:out")}})),D=h(e.Application).with(d,f,M,O),E=D.extend({initRadioOnInitialize:!0,_initRegion:function(){if(!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:!0}).skip){var t=this.getProperty("region");this.region=t,D.prototype._initRegion()}},getRegion:function(){return this._region||this._initRegion({skip:!1}),this._region},addPageManager:function(t){var e=this;this._pageManagers||(this._pageManagers=[]),this._pageManagers.push(t);var r=t.getName();r?this.listenTo(t,"all",function(t){for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var a=r+":"+t;e.triggerMethod.apply(e,[a].concat(i))}):console.warn("pageManager prefix not defined")},hasPageManagers:function(){return this._pageManagers&&this._pageManagers.length>0},getMenuTree:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};if(this._menuTree&&!e.rebuild)return this._menuTree;var n=this._pageManagers||[],i=r(n).chain().map(function(t){return t.getLinks()}).flatten().value();return this._menuTree=new t.Collection(i),this._menuTree},getPage:function(t){if(this.hasPageManagers())return r(this._pageManagers).find(function(e){return e.getPage(t)})}}),I=e.AppRouter.extend({},{create:function(t,e){var n={},i={},o=this;return r(t).each(function(t,r){n[r]=r,i[r]=function(){t.action.apply(t,arguments).catch(function(t){o._catchError(t,e)})}}),new this({controller:i,appRoutes:n})},_catchError:function(t,e){if(!e||!0===e.getProperty("throwChildErrors"))throw t;var r="error"+(t.status?":"+t.status.totring():"");e.triggerMethod("error",t,this),"error"!=r&&e.triggerMethod(r,t,this)}}),j=t.Model.extend({}),N=j.extend({defaults:{url:void 0,label:void 0,target:"_self",level:0},destroy:function(){this.id=null,j.prototype.destroy.apply(this,arguments)}});function T(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}var F=h(E).with(c),Y=F.extend({constructor:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];F.apply(this,e),this.initializeYatPage()},allowStopWithoutStart:!0,allowStartWithoutStop:!0,initializeYatPage:function(t){this.mergeOptions(t,["manager"]),this._initializeModels(t),this._initializeRoute(t),this._proxyEvents(),this._tryCreateRouter(),this._registerIdentityHandlers()},getLayout:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{rebuild:!1};return(!this._layoutView||t.rebuild||this._layoutView&&this._layoutView.isDestroyed&&this._layoutView.isDestroyed())&&this.buildLayout(),this._layoutView},buildLayout:function(){var t=this.getProperty("Layout");if(null!=t){var e=r.extend({},this.getProperty("layoutOptions"));this.model&&!e.model&&r.extend(e,{model:this.model}),this.collection&&!e.collection&&r.extend(e,{collection:this.collection});var n=this.buildLayoutOptions(e);return n.page=this,this._layoutView=new t(n),this._layoutView}},buildLayoutOptions:function(t){return t},addModel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.model=t;var r=e.fetch||this.getOption("fetchModelOnAdd");void 0===r&&(r=this.getProperty("fetchDataOnAdd")),!0===r&&this.addStartPromise(t.fetch(e))}},addCollection:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){this.collection=t;var r=e.fetch||this.getOption("fetchCollectionOnAdd");void 0===r&&(r=this.getProperty("fetchDataOnAdd")),!0===r&&this.addStartPromise(t.fetch(e))}},getRouteHash:function(){var t=[{},this._routeHandler].concat(this.getChildren({startable:!1}).map(function(t){return t.getRouteHash()}));return r.extend.apply(r,T(t))},hasRouteHash:function(){return r.isObject(this.getRouteHash())},getLinkModel:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._canHaveLinkModel()){if(this._linkModel)return this._linkModel;var e=this.getRoute(),r=this.getLabel(),n=this._getSublinks(t);return this._linkModel=new N({url:e,label:r,level:t,children:n}),this._linkModel}},_canHaveLinkModel:function(){return!(!0===this.getProperty("skipMenu")||this.getProperty("isStartNotAllowed"))},_destroyLinkModel:function(){this._linkModel&&(this._linkModel.destroy(),delete this._linkModel)},getParentLinkModel:function(){var t=this.getParent();if(t&&t.getLinkModel){return t.getLinkModel()}},getNeighbourLinks:function(){var t=this.getLinkModel();if(t&&t.collection)return t.collection},getChildrenLinks:function(){var t=this.getLinkModel();if(t)return t.get("children")},_getSublinks:function(e){var n=this.getChildren();if(n&&n.length){var i=r(n).chain().filter(function(t){return!0!==t.getProperty("skipMenu")}).map(function(t){return t.getLinkModel(e+1)}).value();if(i.length){return new t.Collection(i)}}},_initializeModels:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addModel(t.model,t),this.addCollection(t.collection,t)},_initializeRoute:function(){var t=this.getRoute({asPattern:!0});if(null!=t){var e=this;this._routeHandler=(r={},n=t,i={context:e,action:function(){return e.start.apply(e,arguments)}},n in r?Object.defineProperty(r,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[n]=i,r);var r,n,i}},getRoute:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{asPattern:!1},e=this.getProperty("relativeRoute"),r=this.getProperty("route"),n=this.getParent();if(null!=r){var i=r;if(e&&n&&n.getRoute){i=n.getRoute()+"/"+r}return this._normalizeRoute(i,t)}},_normalizeRoute:function(t,e){if(t=t.replace(/\/+/gim,"/").replace(/^\//,""),e.asPattern)return t;return t.replace(/\(\/\)/gim,"/").replace(/\/+/gim,"/")},_tryCreateRouter:function(){!0===this.getProperty("createRouter")&&(this.router=this._createAppRouter())},_createAppRouter:function(){var t=this.getRouteHash();if(r.size(t))return new I(t)},_proxyEvents:function(){var t=this._getProxyContexts();this._proxyEventsTo(t)},_getProxyContexts:function(){var t=[],e=this.getProperty("manager");e&&t.push({context:e});var r=this.getChannel();if(r){var n=this.getProperty("proxyEventsToRadio");t.push({context:r,allowed:n})}return t},_proxyEventsTo:function(t){var e=[],n={};r(t).each(function(t){t.allowed?r(t.allowed).each(function(e){n[e]||(n[e]=[]),n[e].push(t.context)}):e.push(t.context)});var i=this;i.on("all",function(t){for(var o=arguments.length,a=Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];var u=t in n?n[t]:e,l=[i].concat(a);r(u).each(function(e){return e.triggerMethod.apply(e,["page:"+t].concat(T(l)))})})},_buildChildOptions:function(t){var e={},n=this.getProperty("manager");return n&&(e.manager=n),r.extend(t,this.getProperty("childOptions"),e)},_registerIdentityHandlers:function(){var t=this;this.listenTo(k,"change",function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];t._destroyLinkModel(),t.triggerMethod.apply(t,["identity:change"].concat(r))})}}),B=h(E).with(c),q=B.extend({constructor:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];B.apply(this,e),this._initializeYatPageManager.apply(this,e)},createRouter:function(){var t=this.getChildren({startable:!1}),e={};r(t).each(function(t){r.isFunction(t.getRouteHash)&&r.extend(e,t.getRouteHash())}),this._routesHash=e,this.setRouter(I.create(e,this))},setRouter:function(t){this.router=t},getRouter:function(){return this.router},getLinks:function(){var t=this.getChildren();if(t)return r(t).chain().map(function(t){return t.getLinkModel()}).filter(function(t){return!!t}).value()},execute:function(t){var e=this.getPage(t);if(e)e.start({text:error.message});else{if("*NotFound"===t)throw new l.NotFound("*NotFound handler is missing");this.execute("*NotFound")}},navigate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{trigger:!0},r=this.getRouter();r?r.navigate(t,e):console.warn("router not found")},getPage:function(t){var e=r(this._routesHash).find(function(e,r){return r===t||(e.context.getName()===t||void 0)});return e&&e.context},navigateToRoot:function(){var t=this.getState("currentPage"),e=this.getProperty("rootUrl");if(!e){var r=this.getChildren();if(r&&r.length){var n=r.find(function(e){return e!=t});e=n&&n.getRoute()}}null!=e?this.navigate(e):console.warn("root page not found")},_initializeYatPageManager:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.mergeOptions(t,["id","name","label"]),this._registerPageHandlers(t),this._registerIdentityHandlers(),this.createRouter()},_buildChildOptions:function(t){return r.extend(t,this.getProperty("childOptions"),{manager:this})},_registerPageHandlers:function(){this.on("page:before:start",this._pageBeforeStart),this.on("page:start",this._pageStart),this.on("page:start:decline",this._pageDecline)},_pageBeforeStart:function(t){var e=this.getState("currentPage");e&&e!=t&&e.stop()},_pageStart:function(t){this.setState("currentPage",t)},_pageDecline:function(){},_registerIdentityHandlers:function(){var t=this;this.listenTo(k,"change",function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];t.triggerMethod.apply(t,["identity:change"].concat(r)),t._moveToRootIfCurrentPageNotAllowed()})},_moveToRootIfCurrentPageNotAllowed:function(){var t=this.getState("currentPage");t&&t.isStartNotAllowed()&&this.navigateToRoot()}});return{VERSION:"0.0.9",Functions:a,Helpers:g,Mixins:C,Behaviors:L,Singletons:A,Object:R,Error:l,App:E,Page:Y,Router:I,PageManager:q,identity:k}}),this&&this.Marionette&&(this.Marionette.Yat=this.MarionetteYat);
//# sourceMappingURL=marionette.yat.min.js.map